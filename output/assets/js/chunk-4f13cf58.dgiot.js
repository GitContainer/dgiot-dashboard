/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年06月10日17时30分07秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f13cf58"],{"0226":function(e,t,i){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},"074c":function(e,t,i){"use strict";i("e701")},"1db3":function(e,t,i){"use strict";i("0226")},"47e6":function(e,t,i){"use strict";i("efed")},"497b":function(e,t,i){},5580:function(e,t,i){"use strict";i("497b")},5887:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"devproduct"},[i("div",{staticClass:"prosecond"},[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"small"}},[i("el-form-item",[i("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("product.searchproductname")},model:{value:e.formInline.productname,callback:function(t){e.$set(e.formInline,"productname",t)},expression:"formInline.productname"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.searchProduct(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")])],1),i("el-form-item",{staticStyle:{float:"right","text-align":"right"}},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:""!=e.projectid,expression:"projectid != ''"}],attrs:{type:"primary"},on:{click:e.addproduct}},[e._v(" "+e._s(e.$translateTitle("product.createproduct"))+" ")]),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addgroup.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")])],1)],1),i("div",{staticClass:"protable"},[i("el-table",{key:e.total,staticStyle:{width:"100%"},attrs:{"cell-style":{"text-align":"center"},data:e.groupData,"header-cell-style":{"text-align":"center"}}},[i("el-table-column",{attrs:{label:"ProductID",prop:"objectId"}}),i("el-table-column",{attrs:{label:e.$translateTitle("product.productname")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.name))])]}}])}),i("el-table-column",{attrs:{label:e.$translateTitle("product.productgrouping")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.devType))])]}}])}),i("el-table-column",{attrs:{label:e.$translateTitle("product.nodetype")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[1==s.nodeType?i("span",[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]):e._e(),0==s.nodeType?i("span",[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]):e._e(),2==s.nodeType?i("span",[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")]):e._e()]}}])}),i("el-table-column",{attrs:{label:e.$translateTitle("product.classification")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.category?s.category.name:""))])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("product.addingtime"),prop:"row.createdAt","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{fixed:"right",label:e.$translateTitle("developer.operation"),width:"420"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,a=t.$index;return[i("el-button",{attrs:{size:"mini",type:"primary",underline:!1},on:{click:function(t){return e.deviceToDetail(s)}}},[e._v(" "+e._s(e.$translateTitle("product.config"))+" ")]),i("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.goKonva(s.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),i("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.GoTodevices(s)}}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),i("el-popover",{ref:"popover-"+a,staticStyle:{"margin-left":"10px"},attrs:{placement:"top"}},[i("p",[e._v(" "+e._s(e.$translateTitle("product.qdsczg"))+e._s(s.name)+e._s(e.$translateTitle("equipment.cpm"))+" ")]),i("div",{staticStyle:{margin:"0","text-align":"right"}},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){s._self.$refs["popover-"+a].doClose()}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.makeSure(s)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1),i("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)]}}])})],1)],1),i("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[i("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.length,"page-sizes":[10,20,30,50],total:e.total},on:{"current-change":e.productCurrentChange,"size-change":e.productSizeChange}})],1)],1),i("div",{staticClass:"prodialog"},[i("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.createproduct"),top:"5vh",visible:e.dialogFormVisible,width:"50%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("div",{staticClass:"content"},[i("div",{staticClass:"contentone"},[i("div",{staticStyle:{display:"flex"}},[i("span",[e._v(e._s(e.$translateTitle("product.productinformation")))]),i("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),i("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"name"}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("product.productgrouping"),prop:"devType"}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.devType,callback:function(t){e.$set(e.form,"devType",t)},expression:"form.devType"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("product.classification")}},[i("el-cascader",{attrs:{options:e.categoryListOptions},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("application.applicationtype"),rules:[{required:!0,message:"请选择所属应用",trigger:"blur"}]}},[i("el-select",{attrs:{disabled:""},on:{change:e.selectApp},model:{value:e.form.relationApp,callback:function(t){e.$set(e.form,"relationApp",t)},expression:"form.relationApp"}},e._l(e.allApps,(function(e,t){return i("el-option",{key:t,attrs:{label:e.title,value:e.title}})})),1)],1)],1)],1),i("div",{staticClass:"contenttwo",staticStyle:{"margin-top":"20px"}},[i("div",{staticStyle:{display:"flex"}},[i("span",[e._v(e._s(e.$translateTitle("product.nodetype")))]),i("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),i("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:e.$translateTitle("product.nodetype"),prop:"nodeType"}},[i("el-radio-group",{on:{change:e.changeNode},model:{value:e.form.nodeType,callback:function(t){e.$set(e.form,"nodeType",t)},expression:"form.nodeType"}},[i("el-radio",{attrs:{label:0}},[e._v(" "+e._s(e.$translateTitle("product.equipment"))+" ")]),i("el-radio",{attrs:{label:1}},[e._v(" "+e._s(e.$translateTitle("product.gateway"))+" ")]),i("el-radio",{attrs:{label:2}},[e._v(" "+e._s(e.$translateTitle("product.grouping"))+" ")])],1)],1)],1)],1),i("div",{staticClass:"contentthird",staticStyle:{"margin-top":"20px"}},[i("div",{staticStyle:{display:"flex"}},[i("span",[e._v(" "+e._s(e.$translateTitle("product.networkinganddescription"))+" ")]),i("p",{staticStyle:{"flex-grow":"2",width:"auto",height:"1px",margin:"10px","border-top":"1px dashed #dddddd"}})]),i("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:e.$translateTitle("product.networking")+"(共"+e.channel.length+"项)",prop:"netType"}},[i("el-select",{attrs:{placeholder:e.$translateTitle("product.selectgateway")},model:{value:e.form.netType,callback:function(t){e.$set(e.form,"netType",t)},expression:"form.netType"}},e._l(e.channel,(function(e,t){return i("el-option",{key:t,attrs:{label:t+1+":"+e.label,title:"当前第"+(t+1)+"项",value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:e.$translateTitle("product.productmodel")}},[e.imageUrl?i("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):i("i",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"el-icon-plus avatar-uploader-icon"}),i("form",{ref:"uploadform",staticStyle:{position:"absolute"},attrs:{enctype:"multipart/form-data",method:"POST"}},[i("input",{staticStyle:{position:"relative",top:"-100px","z-index":"5",width:"100px",height:"100px",cursor:"pointer",opacity:"0"},attrs:{type:"file"},on:{change:function(t){return e.upload(t)}}})]),e.imageUrl?i("el-button",{staticStyle:{"vertical-align":"text-bottom"},attrs:{size:"mini",type:"danger"},on:{click:e.deleteImgsrc}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]):e._e()],1),i("el-form-item",{attrs:{label:e.$translateTitle("developer.describe"),prop:"desc"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1)],1)]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1),i("div",{staticClass:"add-group"},[i("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("developer.newvirtualgroup"),visible:e.groupform,width:"30%"},on:{"update:visible":function(t){e.groupform=t}}},[i("el-form",{ref:"addGroup",staticClass:"demo-ruleForm",attrs:{"label-width":"80px",model:e.addGroup}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("el-form-item",{attrs:{label:e.$translateTitle("developer.groupname"),prop:"name",rules:[{required:!0,message:e.$translateTitle("developer.cannotbeempty")}]}})],1),i("el-col",{attrs:{span:18}},[i("el-input",{attrs:{autocomplete:"off",type:"text"},model:{value:e.addGroup.name,callback:function(t){e.$set(e.addGroup,"name",t)},expression:"addGroup.name"}})],1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addDeviceGroup()}}},[e._v(" "+e._s(e.$translateTitle("product.newlyadded"))+" ")]),i("el-button",{on:{click:function(t){return e.resetForm()}}},[e._v(" "+e._s(e.$translateTitle("zetadevices.reset"))+" ")])],1)],1)],1),i("div",{staticClass:"import-dialog"},[i("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("product.importpro"),visible:e.importDialogShow,width:"25%"},on:{"update:visible":function(t){e.importDialogShow=t}}},[i("el-form",{ref:"uploadProForm",attrs:{model:e.formPro}},[i("el-upload",{ref:"fileUpload",staticClass:"upload-demo",attrs:{accept:".xls, .xlsx, .zip",action:e.uploadAction,"auto-upload":!1,data:e.uploadData,"file-list":e.fileList,headers:e.uploadHeaders,"on-change":e.handleChange,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"with-credentials":!0}},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v(" "+e._s(e.$translateTitle("application.selectfiles"))+" ")])],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"btn-left",attrs:{size:"small",type:"primary"},on:{click:e.submitUpload}},[e._v(" "+e._s(e.$translateTitle("application.upload"))+" ")]),i("el-button",{staticClass:"btn-right",attrs:{size:"small"},on:{click:function(t){e.importDialogShow=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1)],1)])},a=[],r=i("7212"),o=i("5da9"),n=i("1285"),l=i("7497"),d=i("e0e9"),c=i("d0fd"),u=i("be65"),h=i.n(u),p=i("5638"),m=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),g={data(){return{category:[],hashkey:"",addGroup:{name:""},groupform:!1,length:10,total:0,start:0,activeName:"first",formInline:{productname:""},uploadHeaders:{sessionToken:h.a.get("access_token")},uploadAction:"",uploadData:{},fileList:[],productIdentifier:"",groupData:[],formLabelWidth:"80px",dialogFormVisible:!1,importDialogShow:!1,form:{name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},formPro:{name:"",url:""},rules:{roles:[{required:!0,message:"请选择所属应用",trigger:"blur"}],name:[{required:!0,message:"请输入产品",trigger:"blur"}],devType:[{required:!0,message:"请输入产品标识，用于区分不同设备",trigger:"blur"}],category:[{required:!0,message:"请选择所属分类",trigger:"change"}],nodeType:[{required:!0,message:"请选择节点类型",trigger:"change"}],netType:[{required:!0,message:"请选择联网方式",trigger:"change"}],relationApp:[{required:!0,message:"请选择产品可见角色",trigger:"change"}]},option:[],ruleoptions:[],channel:[{label:"蜂窝(2G/3G/4G)(直连)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道(直连)",value:"5G"},{label:"WIFI通道(直连)",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"Modbus",value:"Modbus"},{label:"LoRa(WAN)(直连)",value:"LoRaWAN"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接(直连)",value:"网线连接"},{label:"自定义",value:"OTHER"}],imageUrl:"",productid:"",loading:!1,allApps:[],categoryList:[],categoryListOptions:[],fileServer:"",access_token:"",projectid:"",projectName:"",allTableDate:[]}},computed:{},mounted(){this.Industry(),this.searchProduct(0)},beforeDestroy(){this.projectName=""},methods:{addDeviceGroup(){this.$refs["addGroup"].validate(e=>{if(!e)return!1;Object(p["addGroup"])(this.addGroup.name).then(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组成功",type:"success"}),this.searchProduct(),this.groupform=!1}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:"新建设备分组失败"+e.computed,type:"error"}),this.groupform=!1})})},resetForm(){this.$refs["addGroup"].resetFields()},changeNode(e,t){0!=t&&(this.form.netType=""),this.channel=0==e?[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"BLE(低功耗蓝牙)",value:"Bluetooth"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"ZigBee通道",value:"ZigBee"},{label:"LoRa(WAN)",value:"LoRaWAN"},{label:"Modbus",value:"Modbus"},{label:"OPC UA",value:" OPC UA"},{label:"ZETA通道",value:"ZETA"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]:[{label:"蜂窝(2G/3G/4G)",value:"CELLULAR"},{label:"5G通道",value:"5G"},{label:"WIFI通道",value:"WIFI"},{label:"NB-IOT通道",value:"NB-IOT"},{label:"LoRaWAN",value:"LoRaWAN"},{label:"网线连接",value:"网线连接"},{label:"自定义",value:"OTHER"}]},selectApp(e){e&&Object(o["getRole"])(e).then(e=>{e&&(this.fileServer=e.file,this.access_token=e.access_token)})},treeData(e){const t=JSON.parse(JSON.stringify(e));return t.filter(e=>{const i=t.filter(t=>e.id==t.parentid);return i.length>0&&(e.children=i),0==e.parentid})},deleteImgsrc(){event.stopPropagation(),this.imageUrl=""},upload(e){if(this.loading=!0,e){var t=e.target.files[0],i=t.name,s=e.target.files[0].type,a=(t.type.split("/")[0],"image/jpeg"===s||"image/JPEG"===s||"image/png"===s||"image/PNG"===s||"image/bpm"===s||"image/BPM"===s);if(!a)return this.$message({showClose:!0,duration:2e3,message:"请上传图片",type:"error"}),!1;var r=new FileReader;r.readAsDataURL(t);var o=this;r.onloadend=function(){var e=r.result,t=o.dataURItoBlob(e);o.uploadFile(t,i)}}},dataURItoBlob(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(t.length),a=new Uint8Array(s),r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return new Blob([s],{type:i})},uploadFile(e,t){var i=new FormData;i.append("file",e,t),i.append("output","json"),i.append("path",this.form.relationApp),i.append("auth_token",this.access_token);this.$http.post(this.fileServer,i).then(e=>{e&&(this.imageUrl=e.body.url,this.loading=!1)}).catch(e=>{this.loading=!1,this.$message(e.bodyText)})},submitUpload(){this.uploadAction="/product",this.$nextTick(()=>{this.uploadData.appid=h.a.get("appids"),this.$refs.fileUpload.submit()})},handleUploadSuccess(e,t,i){this.$message({type:"success",showClose:!0,duration:2e3,message:"产品导入成功"}),this.importDialogShow=!1,this.$refs["uploadProForm"].resetFields(),this.searchProduct()},handleUploadError(e,t,i){this.$message({showClose:!0,duration:2e3,message:e})},handleChange(e,t){t.length>0&&(this.fileList=[t[t.length-1]])},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getDict(e,t){return m(this,null,(function*(){const e={limit:1e3,where:{"data.key":"category"}},{results:t}=yield Object(d["queryDict"])(e)}))},searchProduct(e){return m(this,null,(function*(){0==e&&(this.start=0);const t={order:"-updatedAt",skip:this.start,limit:this.length,include:"category",where:{nodeType:"2"}};this.formInline.productname&&(t.where.name={$regex:this.formInline.productname});const{results:i}=yield Object(r["queryProduct"])(t);dgiotlogger.log("results",i),this.groupData=i,this.total=this.groupData.length;const s=yield Object(o["queryRole"])({limit:100});this.allApps=s.results}))},handleClose(){this.dialogFormVisible=!1},addproduct(){this.dialogFormVisible=!0},addgroup(){this.groupform=!0},getParent(e,t,i){return t.map(s=>{e==s.id?(i.unshift(s.value),this.getParent(s.parentid,t,i)):0==s.parentid&&s.id==e&&i.unshift(s.value)}),this.form.category=i,i},getIndustryParent(e,t){t.map(i=>{i.value==e&&this.getParent(i.id,t,[])})},editorProduct(e){for(var t in this.form.relationApp="",this.dialogFormVisible=!0,this.productid=e.id,this.getIndustryParent(e.attributes.category,this.categoryList),this.form.desc=e.attributes.desc,this.form.name=e.attributes.name,this.form.nodeType=e.attributes.nodeType,this.form.netType=e.attributes.netType,this.form.devType=e.attributes.devType,this.form.productSecret=e.attributes.productSecret,this.changeNode(e.attributes.nodeType,0),e.attributes.icon&&(this.imageUrl=e.attributes.icon),e.attributes.ACL.permissionsById)this.form.relationApp=t?t.substr(5):"";this.selectApp(this.form.relationApp)},Industry(){return m(this,null,(function*(){this.categoryList=[];const e={limit:1e3,where:{"data.key":"category"}},{results:t}=yield Object(d["queryDict"])(e);t.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.categoryList.push(t)}),this.categoryListOptions=this.treeData(this.categoryList)}))},submitForm(e){},resetProductForm(){this.form={name:"",category:[],nodeType:0,desc:"",netType:"",devType:"",productSecret:"",roles:[],relationApp:""},this.imageUrl=""},deviceToDetail(e){this.$router.push({path:"/roles/detailproduct",query:{id:e.objectId}})},goKonva(e){this.$router.push({path:"/Topo?productid",query:{productid:e}})},GoTodevices(e){this.$router.push({path:"/roles/thing",query:{productid:e.objectId}})},makeSure(e){const t={count:"objectId",skip:0,limit:1,where:{product:e.objectId}};Object(n["queryDevice"])(t).then(t=>{t.count>0?this.$message("请先删除该产品下设备"):Object(r["getProduct"])(e.objectId).then(t=>{Object(r["delProduct"])(e.objectId).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"}),this.searchProduct())}).catch(e=>{dgiotlog.log("delProduct ",e.error)})}).catch(e=>{dgiotlog.log("getProduct ",e.error)})}).catch(e=>{dgiotlog.log("queryDevice ",e.error)})},productSizeChange(e){this.length=e,this.searchProduct()},productCurrentChange(e){this.start=(e-1)*this.length,this.searchProduct()},blackDict(e,t){return m(this,null,(function*(){const i={data:t,key:e,type:"Product"},s=yield Object(d["postDict"])(i);s?this.$message({showClose:!0,duration:2e3,type:"success",message:"备份成功"}):this.$message({showClose:!0,duration:2e3,type:"error",message:"备份失败"})}))},CloneData(e){return m(this,null,(function*(){const t={category:e.attributes.category,devType:e.attributes.devType,name:e.attributes.name,thing:e.attributes.thing},{objectId:i,code:s}=yield Object(l["getHashClass"])("Product",t);200==s&&this.blackDict(i,t)}))},proudctClone(e){return m(this,null,(function*(){e.attributes.config.cloneState=!0;const t=e,i=Object(r["putProduct"])(e.id,t);i&&this.CloneData(e)}))},proudctEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:i}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022年06月10日17时30分07秒",VUE_APP_VERSION:"4.5.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==i?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var s=`${t}/#?drawProudctid=${e.objectId}&proudctid=${e.objectId}`;localStorage.setItem("rowId",e.objectId),window.open(s,"__blank")},proudctView(e){var t=window.location.origin+"/spa";const{NODE_ENV:i}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022年06月10日17时30分07秒",VUE_APP_VERSION:"4.5.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==i?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var s=`${t}/#/views/${e.objectId}`;window.open(s,"__blank")},exportpro(){this.allTableDate?Object(c["export_txt_to_zip"])(JSON.stringify(this.allTableDate),"Dict","Dict"):this.$message({type:"warning",showClose:!0,duration:2e3,message:"数据为空,无法导出"})}}},b=g,v=(i("5580"),i("a73e"),i("2877")),y=Object(v["a"])(b,s,a,!1,null,"f9a47bc6",null);t["default"]=y.exports},"68d7":function(e,t,i){"use strict";var s=i("c4e6"),a=i("59ef"),r=i("b217"),o=i("c26a"),n=i("5880"),l=i("1285"),d=i("7dd9"),c=i("8ba7"),u=i("662c"),h=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,y=(e,t,i)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t)=>{for(var i in t||(t={}))b.call(t,i)&&y(e,i,t[i]);if(g)for(var i of g(t))v.call(t,i)&&y(e,i,t[i]);return e},$=(e,t)=>p(e,m(t)),T=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())});const w=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];var C={components:{Instruct:d["default"],info:s["default"],deviceLog:o["default"],SceneLog:a["default"],"device-task":r["default"],runningState:u["default"]},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{commandInfo:{dialog:!1,data:{}},amisTable:"0_j",bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:w,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"$dg/user/${deviceid}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:f({},Object(n["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:$(f({subRealtimedata(){return T(this,null,(function*(){try{yield this.$subscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payloadString)),console.log(JSON.parse(Base64.decode(e.payloadString)).data),console.log("Base64.decode(payload):",Base64.decode(e.payloadString)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payloadString));this.renderCard(t),t||this.CardDevice()})}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))}},Object(n["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){console.log("Unbscribe all topic");const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.subtopic=`$dg/user/trace/${this.$route.query.deviceid}/realtimecard/report`,this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return T(this,null,(function*(){var t;try{var i=yield Object(l["getDevice"])(e);const{location:s={longitude:"116.404",latitude:"39.915"}}=i;let a={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(s.longitude),lat:Number(s.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(a={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});t=i.product.objectId;i.devaddr;let r=[{topic:`$dg/thing/${e}/post`,type:"pub",desc:"设备上报",isdef:!0},{topic:`$dg/thing/${e}/`,type:"sub",desc:"消息下发",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(r):r,console.log(i,"resultes"),this.deviceInfo=i,this.mapLabel=a,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return T(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:r,_function:o,startTime:n,endTime:d}=this.params;let c={starttime:moment(n).valueOf(),endtime:moment(d).valueOf(),interval:a+t,keys:i,limit:s,function:o,style:r};yield Object(l["getDabDevice"])(e,c).then(e=>{if(console.log(e,"res charts"),null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}console.log("this.chartData",this.chartData),this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){return T(this,null,(function*(){switch(localStorage.removeItem("parse_objectid"),localStorage.setItem("parse_objectid",this.deviceid),yield this.$unSubscribe(this.subtopic),e.name){case"ninth":yield this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":yield this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":yield this.queryChart();break;case"right":yield this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":yield this.$refs.SceneLog.get_topic();break;case"view":const{results:e=[]}=yield Object(c["queryView"])({where:{class:"Product",type:{$ne:"topo"},title:{$ne:null},key:this.productId,objectId:{$ne:null}}});if(_.isEmpty(e))return!1;this.commandInfo.data=e,localStorage.setItem("parse_objectid",this.deviceid);break;case"devicetask":yield this.$refs["device-task"].featchData();break;case"first1":yield this.subRealtimedata(),yield this.CardDevice();break}}))},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){var e=this;e.loading=!0,Object(l["getCardDevice"])(e.$route.query.deviceid).then(t=>{(null==t?void 0:t.data)&&e.renderCard(t.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{e.loading=!1},800)},renderCard(e){var t=this;let i=[];e.forEach(e=>{e.devicetype=""===e.devicetype?"default":e.devicetype,e.devicetype&&i.push(e.devicetype)}),i=_.uniqBy(i);let s={};i.forEach(t=>{let i=[];e.forEach(e=>{e.module="card",t==e.devicetype&&i.push(e)}),s[t]=i}),t.machinelist=s,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return T(this,null,(function*(){console.log("row",e);const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false",productid:this.productId};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(t.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=t.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){this.$confirm("此操作将解除设备间的关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=JSON.parse(JSON.stringify(e.route)),i=this.deviceInfo.devaddr;delete t[i];const s={parentId:{__type:"Pointer",className:"Device",objectId:0},route:t};this.$putDevice(e.objectId,s).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"解除关联成功"}),this.getDevices())})}).catch(()=>{})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})}})};t["a"]=C},7030:function(e,t,i){"use strict";i.r(t);var s=i("c4e6"),a=i("59ef"),r=i("b217"),o=i("c26a"),n=i("5880"),l=i("1285"),d=i("7dd9"),c=i("8ba7"),u=i("662c"),h=Object.defineProperty,p=Object.defineProperties,m=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,y=(e,t,i)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t)=>{for(var i in t||(t={}))b.call(t,i)&&y(e,i,t[i]);if(g)for(var i of g(t))v.call(t,i)&&y(e,i,t[i]);return e},$=(e,t)=>p(e,m(t)),T=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())});const w=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];t["default"]={components:{Instruct:d["default"],info:s["default"],deviceLog:o["default"],SceneLog:a["default"],"device-task":r["default"],runningState:u["default"]},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{commandInfo:{dialog:!1,data:{}},amisTable:"0_j",bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:w,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"$dg/user/${deviceid}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:f({},Object(n["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:$(f({subRealtimedata(){return T(this,null,(function*(){try{yield this.$subscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payloadString)),console.log(JSON.parse(Base64.decode(e.payloadString)).data),console.log("Base64.decode(payload):",Base64.decode(e.payloadString)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payloadString));this.renderCard(t),t||this.CardDevice()})}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))}},Object(n["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){console.log("Unbscribe all topic");const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.subtopic=`$dg/user/trace/${this.$route.query.deviceid}/realtimecard/report`,this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return T(this,null,(function*(){var t;try{var i=yield Object(l["getDevice"])(e);const{location:s={longitude:"116.404",latitude:"39.915"}}=i;let a={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(s.longitude),lat:Number(s.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(a={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});t=i.product.objectId;i.devaddr;let r=[{topic:`$dg/thing/${e}/post`,type:"pub",desc:"设备上报",isdef:!0},{topic:`$dg/thing/${e}/`,type:"sub",desc:"消息下发",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(r):r,console.log(i,"resultes"),this.deviceInfo=i,this.mapLabel=a,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return T(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:r,_function:o,startTime:n,endTime:d}=this.params;let c={starttime:moment(n).valueOf(),endtime:moment(d).valueOf(),interval:a+t,keys:i,limit:s,function:o,style:r};yield Object(l["getDabDevice"])(e,c).then(e=>{if(console.log(e,"res charts"),null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}console.log("this.chartData",this.chartData),this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){return T(this,null,(function*(){switch(localStorage.removeItem("parse_objectid"),localStorage.setItem("parse_objectid",this.deviceid),yield this.$unSubscribe(this.subtopic),e.name){case"ninth":yield this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":yield this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":yield this.queryChart();break;case"right":yield this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":yield this.$refs.SceneLog.get_topic();break;case"view":const{results:e=[]}=yield Object(c["queryView"])({where:{class:"Product",type:{$ne:"topo"},title:{$ne:null},key:this.productId,objectId:{$ne:null}}});if(_.isEmpty(e))return!1;this.commandInfo.data=e,localStorage.setItem("parse_objectid",this.deviceid);break;case"devicetask":yield this.$refs["device-task"].featchData();break;case"first1":yield this.subRealtimedata(),yield this.CardDevice();break}}))},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){var e=this;e.loading=!0,Object(l["getCardDevice"])(e.$route.query.deviceid).then(t=>{(null==t?void 0:t.data)&&e.renderCard(t.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{e.loading=!1},800)},renderCard(e){var t=this;let i=[];e.forEach(e=>{e.devicetype=""===e.devicetype?"default":e.devicetype,e.devicetype&&i.push(e.devicetype)}),i=_.uniqBy(i);let s={};i.forEach(t=>{let i=[];e.forEach(e=>{e.module="card",t==e.devicetype&&i.push(e)}),s[t]=i}),t.machinelist=s,t.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return T(this,null,(function*(){console.log("row",e);const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false",productid:this.productId};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(t.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=t.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){this.$confirm("此操作将解除设备间的关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=JSON.parse(JSON.stringify(e.route)),i=this.deviceInfo.devaddr;delete t[i];const s={parentId:{__type:"Pointer",className:"Device",objectId:0},route:t};this.$putDevice(e.objectId,s).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"解除关联成功"}),this.getDevices())})}).catch(()=>{})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})}})}},7574:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"dgiot-fullscreen":e.isFullscreen}},[s("input",{ref:"uploader",staticStyle:{display:"none"},attrs:{accept:"zip",type:"file"},on:{change:function(t){return e.doUpload(t)}}}),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[s("el-image",{staticClass:"dgiot-data-empty",attrs:{src:i("c2ad")}})]},proxy:!0}])},[s("el-table-column",{attrs:{align:"center",label:"className",prop:"className","show-overflow-tooltip":"",sortable:""}}),s("el-table-column",{attrs:{align:"center",label:"fields","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[s("el-popover",{attrs:{placement:"top",trigger:"hover"}},[i.fields?s("dgiot-json-editor",{attrs:{lang:"zh",mode:"code"},model:{value:i.fields,callback:function(t){e.$set(i,"fields",t)},expression:"row.fields"}}):e._e(),s("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[s("el-tag",{attrs:{size:"medium"}},[e._v("fields")])],1)],1)]}}])}),s("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[s("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleExport("export",i)}}},[e._v(" "+e._s(e.$translateTitle("product.export"))+" ")]),s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleExport("import",i)}}},[e._v(" "+e._s(e.$translateTitle("product.import"))+" ")])]}}])})],1)],1)},a=[],r=i("ed07"),o=i("0af3"),n=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),l={name:"Parse",components:{},data(){return{isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+100,stripe:!1,lineHeight:"medium",list:[],listLoading:!0,parseFile:"",parseClass:""}},computed:{},mounted(){this.fetchData()},created(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{handleExport(e,t){return n(this,null,(function*(){const{className:i}=t;if(this.parseClass=i,"export"==e){const e=this.$baseColorfullLoading(2);try{const t=yield Object(o["ExportParse"])(this.parseClass,{});e.close(),this.$convertRes2Blob(t)}catch(error){e.close(),this.$baseMessage(error,"error","dgiot-hey-message-error")}e.close()}else this.$refs.uploader.click();dgiotlog.log(e,t)}))},doUpload(e){return n(this,null,(function*(){this.parseFile=e.target.files[0];const t=this.$baseColorfullLoading(3);try{const e=yield Object(o["ImportParse"])(this.parseClass,this.parseFile);t.close(),dgiotlog.log("eresresrror",e),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("user.update completed"),type:"success"})}catch(error){t.close(),dgiotlog.log("error",error),this.$baseMessage(error,"error","dgiot-hey-message-error")}}))},fetchData(){return n(this,null,(function*(){this.listLoading=!0;const{results:e=[]}=yield Object(r["getTable"])();this.list=e,this.listLoading=!1}))}}},d=l,c=i("2877"),u=Object(c["a"])(d,s,a,!1,null,null,null);t["default"]=u.exports},"835f":function(e,t,i){},"8d51":function(e,t,i){"use strict";i.r(t);var s=i("c4e6"),a=i("5880"),r=i("1285"),o=i("7dd9"),n=i("662c"),l=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,i)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,g=(e,t)=>{for(var i in t||(t={}))h.call(t,i)&&m(e,i,t[i]);if(u)for(var i of u(t))p.call(t,i)&&m(e,i,t[i]);return e},b=(e,t)=>d(e,c(t)),v=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())});const y=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];t["default"]={components:{Instruct:o["default"],info:s["default"],runningState:n["default"]},filters:{filterVal(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:y,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:g({},Object(a["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:b(g({subRealtimedata(){return v(this,null,(function*(){try{yield this.$subscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payload)),console.log(JSON.parse(Base64.decode(e.payload)).data),console.log("Base64.decode(payload):",Base64.decode(e.payload)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payload));t?this.renderCard(t):this.CardDevice()})}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))}},Object(a["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return v(this,null,(function*(){var t;try{var i=yield Object(r["getDevice"])(e);const{location:a={longitude:"116.404",latitude:"39.915"}}=i;let o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(a.longitude),lat:Number(a.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});var s=null!=(t=i.product.objectId)?t:"";const n=i.devaddr;let l=[{topic:`thing/${s}/${n}/post`,type:"pub",desc:"设备上报",isdef:!0},{topic:`thing/${s}/${n}`,type:"sub",desc:"消息下发",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(l):l,console.log(i,"resultes"),this.deviceInfo=i,this.mapLabel=o,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return v(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:o,_function:n,startTime:l,endTime:d}=this.params;let c={starttime:moment(l).valueOf(),endtime:moment(d).valueOf(),interval:a+t,keys:i,limit:s,function:n,style:o};yield Object(r["getDabDevice"])(e,c).then(e=>{if(console.log(e,"res charts"),null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}console.log("this.chartData",this.chartData),this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){switch(this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic),e.name){case"ninth":this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":this.queryChart();break;case"right":this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":this.$refs.SceneLog.get_topic();break;case"first1":this.subRealtimedata(),this.CardDevice();break}},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){this.loading=!0,Object(r["getCardDevice"])(this.deviceid).then(e=>{(null==e?void 0:e.data)&&this.renderCard(e.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{this.loading=!1},800)},renderCard(e){let t=[];e.forEach(e=>{e.devicetype&&t.push(e.devicetype)}),t=_.uniqBy(t);let i={};t.forEach(t=>{let s=[];e.forEach(e=>{e.module="card",t==e.devicetype&&s.push(e)}),i[t]=s}),this.machinelist=i,this.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return v(this,null,(function*(){console.log("row",e);const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.deviceid=deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){const i=JSON.parse(JSON.stringify(e.route)),s=this.deviceInfo.devaddr;delete i[s];const a={parentId:{__type:"Pointer",className:"Device",objectId:0},route:i};this.$putDevice(e.objectId,a).then(e=>{e&&(this.$message({type:"success",showClose:!0,duration:2e3,message:"解除关联成功"}),this.getDevices())})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({type:"info",showClose:!0,duration:2e3,message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})}})}},"9b1b":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"equipment equipment-container"},[i("div",{staticClass:"dialog"},[i("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[i("div",{staticClass:"deviceTree"},[i("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),i("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,a=t.data;return i("div",{staticClass:"custom-tree-node"},[i("span",{class:{selected:a.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(a)}}},[e._v(" "+e._s(s.label)+" ")])])}}])})],1)]),i("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.mapDialog,width:"80vh"},on:{"update:visible":function(t){e.mapDialog=t}}},[i("baidu-map",{staticStyle:{height:"80vh"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[i("bm-marker",{attrs:{animation:"BMAP_ANIMATION_BOUNCE",dragging:!0,position:e.center}},[i("bm-label",{attrs:{content:e.deviceId,"label-style":{color:"red",fontSize:"12px"},offset:{width:-25,height:30}}})],1),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}})],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,title:e.devicedetail.name,top:"5vh",visible:e.InfoDialog,width:"80%"},on:{"update:visible":function(t){e.InfoDialog=t}}},[i("el-tabs",{attrs:{size:"mini",type:"border-card"},on:{"tab-click":e.handleTabClick},model:{value:e.activeparseTbas,callback:function(t){e.activeparseTbas=t},expression:"activeparseTbas"}},e._l(e.parseTbas,(function(t){return i("el-tab-pane",{key:t.name,attrs:{label:t.name,name:t.name}},[i("ele-form",e._b({attrs:{"request-fn":e.handleSubmit},on:{"request-success":function(i){return e.handleSuccess(t)}},model:{value:t.config,callback:function(i){e.$set(t,"config",i)},expression:"item.config"}},"ele-form",t.config,!1))],1)})),1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.InfoDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.CloseState,title:e.stateDialog.name,top:"5vh",visible:e.stateDialog,width:"80%"},on:{"update:visible":function(t){e.stateDialog=t}}},[i("deviceState",{attrs:{devicedetail:e.stateDetail},on:{ParserSave:e.ParserSave}}),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){e.stateDialog=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])],1)],1)],1),i("div",{staticClass:"equtabs"},[i("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("div",{staticClass:"equdevices"},[i("dgiot-query-form",[i("dgiot-query-form-top-panel",[i("el-form",{attrs:{inline:!0,"label-width":"100px",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.Products")}},[i("el-select",{attrs:{clearable:"",disabled:!e.productenable},on:{change:e.selectProdChange},model:{value:e.equvalue,callback:function(t){e.equvalue=t},expression:"equvalue"}},e._l(e.proTableData,(function(e,t){return i("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.device status")}},[i("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},on:{change:function(t){return e.getDevices()}},model:{value:e.onlinedevices,callback:function(t){e.onlinedevices=t},expression:"onlinedevices"}},[i("el-option",{attrs:{value:e.$translateTitle("zetadevices.online")}}),i("el-option",{attrs:{value:e.$translateTitle("zetadevices.offline")}})],1)],1),i("el-form-item",{attrs:{label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit")}},[i("el-select",{staticStyle:{width:"100px"},attrs:{clearable:""},on:{change:function(t){return e.getDevices()}},model:{value:e.statusdevices,callback:function(t){e.statusdevices=t},expression:"statusdevices"}},[i("el-option",{attrs:{label:e.$translateTitle("developer.enable"),value:"true"}}),i("el-option",{attrs:{label:e.$translateTitle("developer.prohibit"),value:"false"}})],1)],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.condition")}},[e.selectdevice==e.$translateTitle("equipment.devicename")?i("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterproductname")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[i("el-select",{staticStyle:{width:"140px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[i("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),i("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),i("i",{staticClass:"el-icon-search",staticStyle:{"line-height":"32px",color:"#606266",cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){return e.getDevices({start:0})}},slot:"suffix"})],1):i("el-input",{attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber")},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[i("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),i("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),i("el-button",{attrs:{slot:"append",icon:"el-icon-search",size:"mini"},on:{click:function(t){return e.getDevices({start:0})}},slot:"append"})],1)],1),i("el-form-item",[i("el-button",{staticClass:"el-icon-plus",attrs:{size:"small",title:e.$translateTitle("equipment.adddevice"),type:"primary"},on:{click:e.addDeviceForm}}),i("el-button",{staticClass:"el-icon-delete",attrs:{disabled:!e.selectedList.length,size:"small",title:e.$translateTitle("aintenance.batch deletion"),type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}})],1),i("el-form-item",{staticStyle:{display:"none"}},[i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")]),i("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")])],1)],1)],1)],1)],1),i("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.list"),name:"first"}},[i("div",{staticClass:"tabstable"},[i("el-table",{directives:[{name:"show",rawName:"v-show",value:e.isALL,expression:"isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticClass:"tab_wrap_1",staticStyle:{"margin-top":"20px","text-align":"center"},attrs:{border:e.border,data:e.tableData,"row-style":e.rowClass,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.changeBox}},[i("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"100"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return["ONLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==s.status?i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==s.status?i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=s.status&&"ONLINE"!=s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),prop:"Company","show-overflow-tooltip":"",sortable:"",width:"auto"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"isEnable","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,a=t.$index;return[i("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,s,a)}},model:{value:s.isEnable,callback:function(t){e.$set(s,"isEnable",t)},expression:"row.isEnable"}})]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),"min-width":"220",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(s)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),i("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editorDevice(s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),i("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),i("el-dropdown",{staticStyle:{margin:"0 10px"}},[i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(s,s.objectId,s.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",s.objectId)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],1),i("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.isALL,expression:"!isALL"},{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.changeBox}},[i("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",sortable:"",type:"selection",width:"55"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"auto"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:"",width:"auto"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),"show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return["ONLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==s.status?i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisonline"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==s.status?i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.thedeviceisoffline"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=s.status&&"ONLINE"!=s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.unregistered"))+" ")]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[s.product&&s.product.name?i("span",[e._v(" "+e._s(s.product.name)+" ")]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.Company"),"show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(" "+e._s(s.Company)+" ")])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),"show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,a=t.$index;return[i("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,s,a)}},model:{value:s.isEnable,callback:function(t){e.$set(s,"isEnable",t)},expression:"row.isEnable"}})]}}])}),e._l(e.dialogtempconfig,(function(t,s){return["bool"==t.type&&t.isshow?i("el-table-column",{key:s,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(s){var a=s.row;return[a[t.default]?i("span",[e._v(" "+e._s(e.$translateTitle("product.yes"))+" ")]):i("span",[e._v(" "+e._s(e.$translateTitle("product.no"))+" ")])]}}],null,!0)}):"enum"==t.type&&t.isshow?i("el-table-column",{key:s,attrs:{align:"center",label:t.name},scopedSlots:e._u([{key:"default",fn:function(s){var a=s.row;return[i("span",[e._v(" "+e._s(t.struct[a[t.identifier]])+" ")])]}}],null,!0)}):t.isshow?i("el-table-column",{key:s,attrs:{align:"center",label:t.name,prop:t.identifier},scopedSlots:e._u([{key:"default",fn:function(s){var a=s.row;return[i("span",[e._v(e._s(a[t.identifier])+" "+e._s(t.unit))])]}}],null,!0)}):e._e()]})),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.createdAt"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.deviceToDetail(s)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),i("el-button",{staticStyle:{"text-align":"center"},attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.editorDevice(s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.edit"))+" ")]),i("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.konvaDevice(s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),i("el-dropdown",{staticStyle:{margin:"0 10px"}},[i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){e.isFullscreen=!e.isFullscreen}}},[e._v(" "+e._s(e.$translateTitle("concentrator.more"))+" ")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showTree(s,s.objectId,s.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")])],1),i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.goLink("video",s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.video"))+" ")])],1),i("el-dropdown-item",[i("el-link",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])],1)],1)],1)]}}])})],2),i("div",{staticClass:"elpagination"},[i("el-pagination",e._b({attrs:{background:e.ination.background,"current-page":e.ination.currentPage,layout:e.ination.layout,"page-size":e.ination.pageSize,"page-sizes":e.ination.pageSizes,total:e.ination.total},on:{"update:currentPage":function(t){return e.$set(e.ination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.ination,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.ination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.ination,"pageSize",t)},"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}},"el-pagination",e.$attrs,!1))],1)],1)]),i("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.map"),name:"second"}},[i("baidu-map",{staticClass:"map",staticStyle:{height:"67vh"},attrs:{ak:e.secret.baidu.map,center:{lng:116.404,lat:39.915},"scroll-wheel-zoom":!0,zoom:e.sizeZoom}},[i("bm-control",[i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=19}}},[e._v(" 缩放至最大 ")]),i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=10}}},[e._v("还原")]),i("el-button",{attrs:{size:"mini"},on:{click:function(t){e.sizeZoom=3}}},[e._v(" 缩放至最小 ")]),i("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:460,height:0}}}),i("bm-overview-map",{attrs:{"is-open":!0}}),i("bm-scale",{attrs:{offset:{width:200,height:0}}}),i("bm-city-list",{attrs:{offset:{width:280,height:0}}}),i("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_HYBRID_MAP","BMAP_NORMAL_MAP"],offset:{width:360,height:0}}})],1),e._l(e.tableData,(function(t){return i("bm-marker",{key:t.objectId,attrs:{animation:"BMAP_ANIMATION_BOUNCE",content:t.name,dragging:!0,position:{lng:t.location.longitude,lat:t.location.latitude}}},[i("bm-label",{attrs:{content:t.name,"label-style":{color:"red",fontSize:"24px"},offset:{width:-35,height:30}},on:{click:function(i){return e.deviceToDetail(t)}}})],1)})),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),i("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}})],2)],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.$translateTitle("product.edit")+e.equipmentEditor,visible:e.devicedialogVisible,width:"70%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[i("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),i("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1)]),i("div",{staticClass:"devicecontent"},[i("el-tabs",{model:{value:e.imeideviceName,callback:function(t){e.imeideviceName=t},expression:"imeideviceName"}},[i("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.commdevice"),name:"first"}},[i("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[i("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[i("el-input",{attrs:{disabled:"编辑"==e.equipmentEditor},model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"编辑"==e.equipmentEditor,placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}},e._l(e.proTableData1,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[i("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[i("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[i("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[i("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoSrc")}},[i("el-input",{model:{value:e.deviceform.videoSrc,callback:function(t){e.$set(e.deviceform,"videoSrc",t)},expression:"deviceform.videoSrc"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.videoType")}},[i("el-select",{staticStyle:{width:"100%"},model:{value:e.deviceform.videoType,callback:function(t){e.$set(e.deviceform,"videoType",t)},expression:"deviceform.videoType"}},e._l(e.videoOptions,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),e._l(e.arrlist,(function(t,s){return i("el-col",{key:s,attrs:{span:12}},[i("el-form-item",{attrs:{label:t.name,prop:t.identifier,required:t.required}},["bool"==t.type?i("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(i){e.$set(e.deviceform,t.identifier,i)},expression:"deviceform[item.identifier]"}},[i("el-option",{attrs:{label:e.$translateTitle("product.yes"),value:!0}}),i("el-option",{attrs:{label:e.$translateTitle("product.no"),value:!1}})],1):"enum"==t.type?i("el-select",{staticClass:"notauto",staticStyle:{width:"100%"},attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(i){e.$set(e.deviceform,t.identifier,i)},expression:"deviceform[item.identifier]"}},e._l(t.specs,(function(e,t){return i("el-option",{key:t,attrs:{label:e.attributevalue,value:e.attribute?e.attribute:""}})})),1):"switch"==t.type?i("el-switch",{attrs:{"active-color":"#13ce66","active-value":t.activevalue,"inactive-color":"#ff4949","inactive-value":t.inactivevalue},model:{value:e.deviceform[t.identifier],callback:function(i){e.$set(e.deviceform,t.identifier,i)},expression:"deviceform[item.identifier]"}}):t.readonly?i("el-input",{attrs:{disabled:t.readonly,value:e.deviceform[t.identifier]?e.deviceform[t.identifier]:""}},[i("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1):i("el-input",{attrs:{disabled:t.readonly},model:{value:e.deviceform[t.identifier],callback:function(i){e.$set(e.deviceform,t.identifier,i)},expression:"deviceform[item.identifier]"}},[i("el-button",{attrs:{slot:"append"},slot:"append"},[e._v(" "+e._s(t.unit?t.unit:"")+" ")])],1)],1)],1)})),i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[i("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],2)],1),i("div",{staticStyle:{"text-align":"right"}},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),i("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1),"编辑"!=e.equipmentEditor?i("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.imeidevice"),name:"second"}},[i("el-form",{ref:"imeiform",attrs:{"label-width":"150px",model:e.imeiform,rules:e.rules}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"IMEI",prop:"devimei"}},[i("el-input",{model:{value:e.imeiform.devimei,callback:function(t){e.$set(e.imeiform,"devimei",t)},expression:"imeiform.devimei"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("equipment.entername")},on:{change:e.selectChange},model:{value:e.imeiform.productName,callback:function(t){e.$set(e.imeiform,"productName",t)},expression:"imeiform.productName"}},e._l(e.proTableData1,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1)],1)],1),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[i("el-input",{on:{focus:e.updateLocation},model:{value:e.imeiform.address,callback:function(t){e.$set(e.imeiform,"address",t)},expression:"imeiform.address"}})],1)],1)],1)],1),i("div",{staticStyle:{"text-align":"right"}},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitimeiForm("imeiform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),i("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)],1):e._e()],1)],1)]),i("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:e.$translateTitle("developer.equipmentinstallationaddress"),visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[i("div",[i("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[i("el-form-item",{attrs:{label:e.$translateTitle("developer.addressname")}},[i("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("developer.selectaddress")}},[i("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),i("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[i("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),i("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),i("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("product.preservation"))+" ")]),i("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)])],1)])},a=[],r=i("2db0"),o=i("5880"),n=i("dcc6"),l=i("4be7"),d=i("7212"),c=i("cb88"),u=i("926a"),h=i("1285"),p=i("bc35"),m=i("14ba"),g=Object.defineProperty,b=Object.defineProperties,v=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,w=(e,t,i)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,C=(e,t)=>{for(var i in t||(t={}))f.call(t,i)&&w(e,i,t[i]);if(y)for(var i of y(t))T.call(t,i)&&w(e,i,t[i]);return e},I=(e,t)=>b(e,v(t)),D=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),j={components:{BmScale:c["BmScale"],BmMapType:c["BmMapType"],BmOverviewMap:c["BmOverviewMap"],BmPanorama:c["BmPanorama"],BmControl:c["BmControl"],BmLabel:c["BmLabel"],BaiduMap:c["BaiduMap"],BmLocalSearch:c["BmLocalSearch"],BmNavigation:c["BmNavigation"],BmGeolocation:c["BmGeolocation"],BmCityList:c["BmCityList"],BmMarker:c["BmMarker"],deviceState:r["default"]},data(){let e=/^[0-9]{15}$/,t=(t,i,s)=>{if(!e.test(i))return s(new Error("请输入15位IMEI"));s()};this.chartSettings={radius:[5,40],offsetY:70},this.chartExtend={yAxisType:["percent"],tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"}};const i=function(e,t,i){var s=/[0-9A-Za-z]$/;""==t?i(new Error("安装位置不能为空")):s.test(t)?i():i(new Error("安装位置必须为大小写字母数字"))};return{queryPayloads:{where:{},include:"",order:"-updatedAt",limit:10,skip:0,count:"objectId"},pagination:{pageSizes:[5,10,20,50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",background:!0,hidden:!1,small:!1,pageSize:10,total:0,pageCount:0,pagerCount:7,currentPage:1,popperClass:"",prevText:"",nextText:"",disabled:!1,hideOnSinglePage:!1},deviceInfo:{},paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"data",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},secret:m["secret"],productDetail:{},addACL:{},videoOptions:["m3u8","mp4","flv","mp3"],queryInfo:{},isFullscreen:!1,border:!0,stripe:!0,lineHeight:"medium",aclObj:{},editRow:{},selectedList:[],formData:{},topicData:[],InfoDialog:!1,devicedetail:{},stateDialog:!1,stateDetail:{},chartOnlone:{columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]},chartwaring:{},parseTbas:[],activeparseTbas:"",chartProduct:{},queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20,workGroupName:"",workGroupTreeShow:!1,statusFlag:!1,status:"",number:"",product:"",type:"",limit:20,skip:0,order:"-createdAt",keys:"count(*)"},treeDataValue:"",isALL:!0,sizeZoom:10,activeName:"first",imeideviceName:"first",mapDialog:!1,dialogtempconfig:[],arrlist:[],deviceId:"",deciceCompany:"",gutter:24,leftRow:3,rightRow:21,popoverVisible:!1,dgioticon:"ancient-gate-fill",Company:sessionStorage.getItem("title")||"",curDepartmentId:"",roleProps:{children:"children",label:"name"},listLoading:!1,productimg:"",bmapdialogVisible:!1,onlineall:0,activeall:0,userId:"",batchid:"",pcdialogVisible:!0,devicedialogVisible:!1,equvalue:"",cities:[],selectdevice:"",onlinedevices:"",statusdevices:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,imeiform:{devimei:"",productName:"",address:""},deviceform:{videoSrc:"",videoType:"m3u8",name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:""},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:i}],devimei:[{required:!0,message:"请输入设备IMEI",trigger:"blur"},{validator:t}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],options:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:C({query:function(){return _.merge(this.queryPayload,this.queryPayloads)},ination:function(){return _.merge(this.pagination,this.paginations)}},Object(o["mapGetters"])({_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role",currentDepartment:"user/currentDepartment"})),watch:{multipleTable(e){this.selectRow=[],e.length>0&&e.forEach((e,t)=>{this.selectRow.push(this.tableData.indexOf(e))})}},mounted(){this.onlinedevices="dev_online"==this.$route.query.deciceType?"在线":"dev_unline"==this.$route.query.deciceType?"离线":"",this.selectdevice="zh"==this.language?"设备名称":"devicename",this.queryProduct(),this.getDevices(),this.aclObj=this.$aclObj(this._role),dgiotlog.log("this.aclObj",this.aclObj)},methods:I(C({handleSizeChange(e){console.log(this.$route);let t=this.query;t.limit=e,this.queryPayloads.limit=e,this.queryPayload.limit=e,this.queryForm.limit=e,this.paginationQuery(t),this.getDevices(t)},handleCurrentChange(e){console.log(this.$route.path);let t=this.query;t.skip=(e-1)*this.ination.pageSize,this.queryPayloads.skip=(e-1)*this.ination.pageSize,this.queryPayload.skip=(e-1)*this.ination.pageSize,this.queryForm.skip=(e-1)*this.ination.pageSize,this.paginationQuery(t),this.getDevices(t)},paginationQuery(e){return D(this,null,(function*(){this.queryPayload=e}))},goLink(e,t){return D(this,null,(function*(){var e;const{basedata:i={}}=yield Object(h["getDevice"])(t);if(console.error(t,i),!(null==(e=null==i?void 0:i.videoSrc)?void 0:e.length))return this.$baseMessage(this.$translateTitle("equipment.The device is not bound to the video address yet"),"info","dgiot-hey-message-error"),!1;this.$router.push({path:"/Tools/player",query:{type:i.videoType||"m3u8",url:i.videoSrc}})}))},handleTabClick(e,t){dgiotlog.log(this.activeparseTbas),dgiotlog.log(this.parseTbas)},updateParse(e,t,i,s){return D(this,arguments,(function*(e,t,i,s,a={}){console.clear(),dgiotlog.log("字段",t),a[""+t]={};let r=[],o=[];dgiotlog.log(this.queryInfo),dgiotlog.log("frender ",s);for(let c in s.config)this.queryInfo[""+c]?(dgiotlog.log(s.config[""+c],c),a[""+t][""+c]=s.config[""+c]):(dgiotlog.log(s.config[""+c],"字段不存在"),o.push[s.config[""+c]]);dgiotlog.log("isField",r),dgiotlog.log("noField",o),dgiotlog.log("params",a.field);let n={};n[""+t]=this.queryInfo;const l=_.merge(n,a);dgiotlog.log(l,"合并后的數據"),dgiotlog.log({field:l[""+t]});try{const t=yield this.$update_object(e,i,l);dgiotlog.log(t),this.$message({showClose:!0,message:this.$translateTitle("user.update completed"),type:"success"})}catch(d){dgiotlog.log(d),this.$baseMessage(d,"error","dgiot-hey-message-error")}}))}},Object(o["mapMutations"])({set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{handleSubmit(e){return dgiotlog.log("data",e),l["Promise"].resolve()},handleSuccess(e){e.table&&e.field&&e.config.order?this.$get_object(e.table,this.deviceId).then(t=>{dgiotlog.log(t),this.queryInfo=t[""+e.field],this.queryInfo?this.updateParse(e.table,e.field,this.deviceId,e):this.$baseMessage(`${e.table} no field ${e.field}`,"error","dgiot-hey-message-error")}):this.$baseMessage(`${e.table} no field ${e.field}`,"error","dgiot-hey-message-error")},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},handleDelete(e,t){let i=[];2==t?i.push({method:"DELETE",path:"/classes/Device/"+e.objectId,body:{}}):e.forEach(e=>{i.push({method:"DELETE",path:"/classes/Device/"+e.objectId,body:{}})}),dgiotlog.log(i,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>D(this,null,(function*(){yield Object(n["batch"])(i);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.getDevices({start:0})},1500)})))},ParserSave(e){dgiotlog.log("如果监听到有修改,则更新vuex 并 存入到数据库 "+JSON.stringify(e))},queryProduct(){return D(this,null,(function*(){this.proTableData=[],this.proTableData1=[];const{results:e=[]}=yield Object(d["queryProduct"])({count:"objectId",order:"-updatedAt",where:{}});this.proTableData=e,dgiotlog.log(this.proTableData,"  this.proTableData"),this.$route.query.product&&this.proTableData.forEach((e,t)=>{e.objectId==this.$route.query.product&&(this.equvalue=this.proTableData[t].objectId,this.productenable=!0,this.queryForm.access_token=this.token,this.$nextTick(()=>{this.selectProdChange(this.$route.query.product)}))}),this.proTableData1=e.filter(e=>"0"!=e.objectId),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.productenable=!1),dgiotlog.log("this.equvalue",this.equvalue)}))},change(e){dgiotlog.log(e),e&&$(".el-tree").css({height:"120px",display:"block"})},selectProdChange(e){return D(this,null,(function*(){if(e){if(this.listLoading=!0,"0"==e)this.isALL=!0;else{yield Object(d["getProduct"])(e).then(e=>{this.listLoading=!1;const{config:t={basedate:{}}}=e,{basedate:i={params:[]}}=t;dgiotlog.log(e,i),this.dialogtempconfig=[],"undefined"!=i.params&&(this.dialogtempconfig=i.params,dgiotlog.log("this.dialogtempconfig",this.dialogtempconfig))}),this.isALL=!1,this.tableData=[];const t={limit:this.devicelength,skip:this.devicestart,order:"-createdAt",count:"objectId",include:"product,name",where:{name:{$ne:null,$exists:!0}}};""!=this.deviceinput&&("设备名称"==this.selectdevice?t.where.name=this.deviceinput:t.where.devaddr=this.deviceinput),""!=this.onlinedevices&&("在线"==this.onlinedevices?t.where.status="ONLINE":t.where.status="OFFLINE"),""!=this.statusdevices&&(t.where.isEnable=this.statusdevices),""!=this.devicenumber&&(t.where.devaddr=this.devicenumber),t.where.product=e,this.devicestart=0;const{results:i=[],count:s=0}=yield Object(h["querycompanyDevice"])(t,this.queryForm.access_token);i.forEach(e=>{if(_.isEmpty(e.location)&&(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company="";if(e.profile)for(var t in e.profile)e[t]=e.profile[t]}),dgiotlog.log(i),this.tableData=i,this.devicetotal=s,this.pagination.total=s,this.chartOnlone.rows[1]["数量"]=this.devicetotal,dgiotlog.log("tableData",this.tableData)}this.listLoading=!1}}))},showTree(e,t,i){this.deviceInfo=e,this.deviceId=t,this.deciceCompany=i,this.popoverVisible=!this.popoverVisible},CloseState(){this.stateDialog=!1},showMap(e,t){this.deviceId=t;const{latitude:i=0,longitude:s=0}=e;Number(i)&&Number(s)?(this.mapDialog=!0,this.center.lng=s,this.center.lat=i):this.$baseMessage("位置信息获取失败","error","dgiot-hey-message-error")},transferAcl(e){const t="role:"+e.name,i={};i[t]={read:!0,write:!0},this.deviceInfo.detail["factory"]=e.depname;const s={ACL:i,detail:this.deviceInfo.detail};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>D(this,null,(function*(){yield Object(h["putDevice"])(this.deviceId,s).then(e=>{e.updatedAt?(this.popoverVisible=!1,this.$message({type:"success",message:this.$translateTitle("迁移成功")})):this.$message({type:"success",message:this.$translateTitle("迁移成功")})})}))).catch(e=>{dgiotlog.log(e)}),dgiotlog.log(e.name)},handleNodeClick(e,t){return D(this,null,(function*(){const i=this._role.map(e=>e.name);$(".el-tree").css({height:"0px",display:"none","overflow-x":"auto"}),$(".el-select-dropdown").css({display:"none"}),this.queryForm.workGroupName=e.label;const{name:s,objectId:a}=e;if(this.curDepartmentId=a,i.includes(e.name))this.queryForm.access_token=this.token;else if(1!=t.level){const{access_token:t=""}=yield Object(p["getToken"])(e.name);this.queryForm.access_token=t}else this.queryForm.access_token=this.token;this.getDevices({start:0})}))},rolesSelect(e){return D(this,null,(function*(){this.productroleslist=[];const{results:t}=yield this.$get_object("Product",e)}))},goEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:i}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022年06月10日17时30分07秒",VUE_APP_VERSION:"4.5.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==i?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var s=`${t}/#?devaddr=${e.devaddr}&proudctid=${e.productid}`;window.open(s,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword,this.imeiform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler({BMap:e,map:t}){this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick(e){this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.bmapform.address=e.address,this.deviceform.address=e.address,this.imeiform.address=e.address})},updateLocation(){this.bmapdialogVisible=!0},handleClosebmap(){this.bmapdialogVisible=!1},getOnlineDevices(){return D(this,null,(function*(){this.chartOnlone={columns:["状态","数量"],rows:[{"状态":"在线","数量":0},{"状态":"离线","数量":0}]};var e={limit:1,count:"objectId",include:"product,name",keys:"name",where:{status:"ONLINE",name:{$ne:null,$exists:!0}}};""!=this.deviceinput&&("设备名称"==this.selectdevice?e.where.name={$regex:this.deviceinput}:e.where.devaddr={$regex:this.deviceinput}),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&this.selectProdChange(this.equvalue);try{const{count:t=0}=yield Object(h["querycompanyDevice"])(e,this.queryForm.access_token);this.chartOnlone.rows[1]["数量"]=this.devicetotal-t,this.chartOnlone.rows[0]["数量"]=t}catch(t){dgiotlog.log(t),this.$baseMessage(t,"error","dgiot-hey-message-error")}}))},getDevices(){return D(this,arguments,(function*(e={}){this.listLoading=!0,this.tableData=[],this.queryPayload.excludeKeys="channel,children,config,thing,decoder,data,basedata,content",this.queryPayload.include="product.name,name",this.queryPayload.where={name:"设备名称"===this.selectdevice&&this.deviceinput?{$regex:this.deviceinput}:{$ne:null,$exists:!0},devaddr:"设备编号"===this.selectdevice&&this.deviceinput?{$regex:this.deviceinput}:{$ne:null},status:"在线"==this.onlinedevices?"ONLINE":"离线"==this.onlinedevices?"OFFLINE":{$ne:null},isEnable:this.statusdevices?this.statusdevices:{$ne:null}},0!=this.equvalue&&(this.devicestart=e.skip,this.selectProdChange(this.equvalue)),0==e.start&&(this.devicestart=0),delete this.queryPayload.productid;try{const{results:e=[],count:t=0}=yield Object(h["querycompanyDevice"])(this.queryPayload,this.queryForm.access_token);if(this.listLoading=!1,!(null==e?void 0:e.length))return;e.forEach(e=>{if(e.location||(e.location={longitude:0,latitude:0}),e.ACL)for(var t in e.ACL)e.Company=t.substr(5);else e.Company=""}),this.tableData=e,this.devicetotal=t,this.pagination.total=t}catch(t){dgiotlog.log(t),this.listLoading=!1,this.tableData=[],this.devicetotal=0,this.$baseMessage(t,"error","dgiot-hey-message-error")}}))},handelUpdate(e,t,i){return D(this,null,(function*(){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.tableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>D(this,null,(function*(){console.log("row",t);var i=yield this.$update_object("Device",t.objectId,{isEnable:e});void 0!=i?(this.$message({type:"success",message:"状态修改成功"}),this.getDevices()):(dgiotlog.log("Device error",error),Object(u["returnLogin"])(error))}))).catch(()=>D(this,null,(function*(){this.$message({type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.tableData[i]=e})))}))},timestampToTime(e){var t=new Date(1200*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag(e,t){return t.tag===e},deleteDevcie(e){return D(this,null,(function*(){this.multipleTable.map(e=>D(this,null,(function*(){yield this.$del_object("Device",e.objectId)}))),this.$message({message:"删除成功",type:"success"}),this.getDevices()}))},editDevice(){return D(this,null,(function*(){const e=yield this.$update_object("Device",item.objectId,params);e.updatedAt?this.initQuery("设备修改成功","success"):this.$message({type:"error",message:e.error})}))},unactiveDevice(e){return D(this,null,(function*(){const t=[],i=[];this.multipleTable.map(e=>{t.push(e.objectId)});const s={isEnable:e},a=yield Object(n["Batchdelete"])("PUT","Device",t,s);a&&(a.forEach((e,s)=>{e.objectId=t[s],e.sortIndex=s+1,"success"==Object.keys(a[s])[0]?(e.msg="edit success",e.dangerouslyUseHTMLString=!1):(e.msg=`<ol>\n            edit error <br>\n            message: ${e.error.error} <br>\n            code: ${e.error.code} <ol>`,e.dangerouslyUseHTMLString=!0),i.push({type:Object.keys(a[s])[0],message:e.msg,dangerouslyUseHTMLString:e.dangerouslyUseHTMLString})}),i.forEach((e,i)=>{this.$baseNotify(e.message,""+t[i],e.type,"top-right",5e3*e.sortIndex,e.dangerouslyUseHTMLString)}),this.getDevices())}))},rowClass({row:e,rowIndex:t}){if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},deviceSizeChange(e){this.devicelength=e,this.getDevices()},deviceCurrentChange(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",videoSrc:"",productName:"",status:"",isEnable:"",brand:"",auth:"",yysId:""},this.$refs["deviceform"].resetFields(),this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm(){this.devicedialogVisible=!0,this.arrlist=[],this.equipmentEditor="添加",this.$route.query.productid?this.deviceform.productName=this.$route.query.productid:0!=this.equvalue?(this.changeproduct=!1,this.deviceform.productName=this.equvalue,this.selectChange(this.equvalue,"add")):this.deviceform.productName=""},handleClose1(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure(e,t){return D(this,null,(function*(){const i=yield this.$del_object("Device",row.objectId);i.error?this.$message({type:"error",message:"删除失败"}):(this.$message({type:"success",message:"删除成功"}),this.getDevices()),e._self.$refs["popover-"+t].doClose()}))},editorDevice(e){return D(this,null,(function*(){for(var t in this.editRow={},this.selectChange(e.product.objectId,"edit"),this.deviceform={},dgiotlog.log("row",e),this.editRow=e,this.deviceid=e.objectId,this.devicedialogVisible=!0,this.imeideviceName="first",this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:e.detail.assetNum||"",devModel:e.detail.devModel||"",desc:e.detail.desc||"",productid:e.product.objectId,brand:e.detail.brand||"",productName:e.product.objectId,status:e.status,isEnable:e.isEnable,videoType:e.detail.videoType||"",videoSrc:e.detail.videoSrc||"",address:e.detail.address||""},dgiotlog.log("this.deviceform12131",this.deviceform),dgiotlog.log("row.basedata",e.basedata),e.basedata)this.$set(this.deviceform,t,e.basedata[t]);dgiotlog.log("this.deviceform",this.deviceform),this.bmapform={address:e.detail.address},this.center={lat:location.latitude,lng:location.longitude},this.addresspointer=void 0==e.detail||void 0==location||location.latitude+e.detail==void 0?"":location.longitude,this.equipmentEditor="编辑"}))},initQuery(e,t){this.$message({type:t||"info",message:e}),this.dialogFormVisible=!1,this.getDevices({start:0})},updateDevice(e){return D(this,null,(function*(){const t=yield Object(h["getDevice"])(this.deviceid),{content:i={},detail:s={},profile:a={},basedata:r={}}=t,o=_.merge({content:i,detail:s,profile:a,basedata:r},e);console.log("params",e),console.log("deviceInfo",t),console.log("mergeParams",o);const n=yield Object(h["putDevice"])(this.deviceid,e);n.updatedAt||n.devaddr?this.initQuery("设备更新成功","success"):this.$message({type:"error",message:n.error})}))},createDevice(e){return D(this,null,(function*(){const t=yield this.$create_object("Device",e);t.objectId?(this.deviceform={},this.handleClose(),this.initQuery("设备创建成功","success")):this.$message({type:"error",message:t})}))},selectChange(e,t="add"){this.arrlist=[],Object(d["getProduct"])(e).then(e=>{const{config:i={basedate:{}},ACL:s}=e;this.productDetail=e,i.basedate&&i.basedate.params.length>0&&(this.arrlist=i.basedate.params,"add"==t&&this.arrlist.map(e=>{var t,i,s,a,r;"bool"==e.type?this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(t=e.default)?void 0:t.length)?e.default:""):"enum"==e.type?this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(a=null==(s=null==(i=e.specs)?void 0:i[0])?void 0:s.attribute)?void 0:a.length)?e.specs[0].attribute:""):this.$set(this.deviceform,e.identifier?e.identifier:"",(null==(r=e.default)?void 0:r.length)?e.default:""),e.required&&("bool"==e.type?this.rules[e.identifier]=[{required:!0,message:"请选择"+e.name,trigger:"change"}]:this.rules[e.identifier]=[{required:!0,message:"请输入"+e.name,trigger:"blur"}])}),dgiotlog.log("afd",this.arrlist),dgiotlog.log("deviceform",this.deviceform),dgiotlog.log("rules",this.rules))})},submitForm(e){return D(this,null,(function*(){this.$refs[e].validate(e=>D(this,null,(function*(){if(!e)return this.$message({type:"error",message:"请按照要求填写参数"}),!1;var t={__type:"GeoPoint",latitude:this.center.lat?this.center.lat:0,longitude:this.center.lng?this.center.lng:0},i={assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.bmapform.address,desc:this.deviceform.desc,videoType:this.deviceform.videoType,videoSrc:this.deviceform.videoSrc},s={};for(var a in this.deviceform)s[a]=this.deviceform[a];if(this.$delete(s,"address"),this.$delete(s,"assetNum"),this.$delete(s,"batchId"),this.$delete(s,"brand"),this.$delete(s,"desc"),this.$delete(s,"devModel"),this.$delete(s,"devType"),this.$delete(s,"devaddr"),this.$delete(s,"isEnable"),this.$delete(s,"name"),this.$delete(s,"netType"),this.$delete(s,"nodeType"),this.$delete(s,"productName"),this.$delete(s,"status"),this.$delete(s,"productid"),""!=this.deviceid){var r={name:this.deviceform.name,devaddr:this.deviceform.devaddr,product:{__type:"Pointer",className:"Product",objectId:this.editRow.product.objectId},detail:i,location:t,basedata:s,profile:s};this.updateDevice(r),this.handleClose(),this.getDevices({start:0})}else{var o={count:"objectId",where:{name:{$in:[this.deviceform.name]},devaddr:{$in:[this.deviceform.devaddr]}}};this.$query_object("Device",o).then(e=>{if(e.count>0)this.$message("此设备已被创建");else{const e="role:"+this.currentDepartment.name,r={};r[e]={read:!0,write:!0};var a={product:{__type:"Pointer",className:"Product",objectId:this.deviceform.productName},status:"OFFLINE",isEnable:!1,ACL:r,name:this.deviceform.name,devaddr:this.deviceform.devaddr,objectId:this.deviceform.devaddr,lastOnlineTime:0,detail:i,location:t,basedata:s};a.detail.devType=this.productDetail.devType,a.detail.category=this.productDetail.category.objectId,console.log("createDevice params\n ",a),this.createDevice(a)}})}})))}))},submitimeiForm(e){return D(this,null,(function*(){this.$refs[e].validate(e=>D(this,null,(function*(){if(!e)return this.$message({type:"error",message:"请按照要求填写参数"}),!1;var t={productid:this.imeiform.productName,devaddr:this.imeiform.devimei,latitude:this.center.lat?this.center.lat:0,longitude:this.center.lng?this.center.lng:0};Object(h["addimeidevice"])(t).then(e=>{e.objectId?(this.deviceform={},this.handleClose(),this.initQuery("设备创建成功","success")):this.$message({type:"error",message:e})})})))}))},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})}})},F=j,S=(i("47e6"),i("2877")),A=Object(S["a"])(F,s,a,!1,null,"60c04d1a",null);t["default"]=A.exports},a73e:function(e,t,i){"use strict";i("d007")},a858:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"comprehensive-table-container"},[i("div",{staticClass:"dialog"},[i("el-dialog",{staticClass:"map_dialog",attrs:{"append-to-body":"","before-close":e.closeMap,title:"安装位置",visible:e.dialog_device,width:"60%"},on:{"update:visible":function(t){e.dialog_device=t}}},[i("el-card",[i("label",[e._v(" 关键词： "),i("el-input",{model:{value:e.map.keyword,callback:function(t){e.$set(e.map,"keyword",t)},expression:"map.keyword"}},[i("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),i("label",[e._v(" 安装位置： "),i("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[i("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.map.innerVisible=!e.map.innerVisible}},slot:"suffix"})])],1),i("baidu-map",{staticStyle:{height:"300px"},style:{height:e.mapHeight,width:e.mapWidth},attrs:{ak:e.$dgiot.secret.baidu.map,center:{lng:116.404,lat:39.915},"map-click":!1,"scroll-wheel-zoom":!0,zoom:15},on:{click:e.mapClick}},[i("bm-view",{staticClass:"map"}),i("bm-local-search",{attrs:{"auto-viewport":!0,keyword:e.map.keyword,location:e.map.location}}),i("bm-control",[i("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:500,height:0}}}),i("bm-overview-map",{attrs:{"is-open":!0}}),i("bm-scale",{attrs:{offset:{width:260,height:0}}}),i("bm-city-list",{attrs:{offset:{width:330,height:0}}}),i("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],offset:{width:400,height:0}}})],1),i("bml-marker-clusterer",[i("bm-marker",[e._v("1")]),i("bm-label",[e._v("1")])],1),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),i("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0,"show-zoom-info":!0}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialog_device=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.editMap}},[e._v("确 定")])],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,top:"5vh",visible:e.popoverVisible,width:"40vh"},on:{"update:visible":function(t){e.popoverVisible=t}}},[i("div",{staticClass:"deviceTree"},[i("p",{staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.$translateTitle("developer.Company"))+" : "+e._s(e.deciceCompany)+" ")]),i("el-tree",{attrs:{data:e.roleTree,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,a=t.data;return i("div",{staticClass:"custom-tree-node"},[i("span",{class:{selected:a.objectId==e.curDepartmentId},on:{click:function(t){return e.transferAcl(a)}}},[e._v(" "+e._s(s.label)+" ")])])}}])})],1)]),i("dgiot-dialog",{attrs:{show:e.form.sync,title:"add"==e.form.type?"添加设备":"修改设备："+e.form.name,width:"60%"},on:{"update:show":function(t){return e.$set(e.form,"sync",t)},beforeClose:e.handleClose}},[i("dgiot-dialog",{attrs:{"append-to-body":"",show:e.map.innerVisible,width:"55%"},on:{"update:show":function(t){return e.$set(e.map,"innerVisible",t)}}},[i("label",[e._v(" 关键词： "),i("el-input",{model:{value:e.map.keyword,callback:function(t){e.$set(e.map,"keyword",t)},expression:"map.keyword"}},[i("i",{staticClass:"el-input__icon el-icon-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),i("label",[e._v(" 安装位置： "),i("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[i("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(t){e.map.innerVisible=!e.map.innerVisible}},slot:"suffix"})])],1),e.map.innerVisible?i("baidu-map",{staticStyle:{height:"300px"},style:{height:e.mapHeight,width:e.mapWidth},attrs:{ak:e.$dgiot.secret.baidu.map,center:{lng:116.404,lat:39.915},"map-click":!1,"scroll-wheel-zoom":!0,zoom:15},on:{click:e.mapClick}},[i("bml-marker-clusterer",[i("bm-marker"),i("bm-label")],1),i("bm-view",{staticClass:"map"}),i("bm-local-search",{attrs:{"auto-viewport":!0,keyword:e.map.keyword,location:e.map.location}}),i("bm-control",[i("bm-panorama",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT",offset:{width:500,height:0}}}),i("bm-overview-map",{attrs:{"is-open":!0}}),i("bm-scale",{attrs:{offset:{width:260,height:0}}}),i("bm-city-list",{attrs:{offset:{width:330,height:0}}}),i("bm-map-type",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT","map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],offset:{width:400,height:0}}})],1),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),i("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0,"show-zoom-info":!0}})],1):e._e()],1),i("el-form",{ref:"form",staticClass:"demo-form",attrs:{"label-width":"100px",model:e.form,rules:e.rules}},[i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.form.type,expression:"form.type == 'add'"}],attrs:{label:"所属厂家"}},[i("el-input",{attrs:{disabled:"",readonly:""},model:{value:e.currentDepartment.name,callback:function(t){e.$set(e.currentDepartment,"name",t)},expression:"currentDepartment.name"}})],1),i("el-form-item",{attrs:{label:"所属产品",prop:"product"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",disabled:"edit"==e.form.type,placeholder:"请选择产品"},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.product,(function(e){return i("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),i("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"设备地址",prop:"devaddr"}},[i("el-input",{attrs:{disabled:"edit"==e.form.type,placeholder:"请输入设备地址"},model:{value:e.form.devaddr,callback:function(t){e.$set(e.form,"devaddr",t)},expression:"form.devaddr"}})],1),i("el-form-item",{attrs:{label:"资产编号",prop:"detail.assetNum"}},[i("el-input",{attrs:{placeholder:"请输入资产编号"},model:{value:e.form.detail.assetNum,callback:function(t){e.$set(e.form.detail,"assetNum",t)},expression:"form.detail.assetNum"}})],1),i("el-form-item",{attrs:{label:"安装位置",prop:"address"}},[i("el-input",{attrs:{placeholder:"请选择安装位置"},on:{focus:function(t){e.map.innerVisible=!e.map.innerVisible}},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}},[i("i",{staticClass:"el-icon-s-promotion",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),i("el-form-item",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form",e.form.type)}}},[e._v(" "+e._s("add"==e.form.type?"新建":"修改")+" ")]),i("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v("重置")])],1)],1)],1)],1),i("dgiot-query-form",[i("dgiot-query-form-top-panel",[i("el-form",{ref:"form",attrs:{inline:!0,"label-width":"75px",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"产品名称"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择产品"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.product,(function(e){return i("el-option",{key:e.objectId,attrs:{label:e.name,value:e.objectId}})})),1)],1),i("el-form-item",{attrs:{label:"设备名称"}},[i("el-input",{attrs:{clearable:"",placeholder:"请输入设备名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"设备地址"}},[i("el-input",{attrs:{clearable:"",placeholder:"请输入设备地址"},model:{value:e.queryForm.devaddr,callback:function(t){e.$set(e.queryForm,"devaddr",t)},expression:"queryForm.devaddr"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"设备状态"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择设备状态"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},[i("el-option",{attrs:{label:"在线",value:"ONLINE"}}),i("el-option",{attrs:{label:"离线",value:"OFFLINE"}})],1)],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}],attrs:{label:"启用状态"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择启用状态"},on:{change:function(t){return e.handleQuery()}},model:{value:e.queryForm.isEnable,callback:function(t){e.$set(e.queryForm,"isEnable",t)},expression:"queryForm.isEnable"}},[i("el-option",{attrs:{label:"启用",value:"true"}}),i("el-option",{attrs:{label:"禁用",value:"false"}})],1)],1),i("el-form-item",[i("el-button",{attrs:{type:"text"},on:{click:function(t){e.fold=!e.fold}}},[e.fold?i("span",[e._v("展开")]):i("span",[e._v("合并")]),i("dgiot-icon",{staticClass:"dgiot-dropdown",class:{"dgiot-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1),i("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),i("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.form.sync=!0}}},[e._v(" 新增 ")])],1)],1)],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),gutter:20},scopedSlots:e._u([{key:"empty",fn:function(){return[i("el-image",{staticClass:"dgiot-data-empty"})]},proxy:!0}])},[i("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[e._v(" "+e._s(i+1)+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"设备名称",prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-form",{attrs:{model:s}},[i("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{size:"mini"}},[s.isEdit?i("el-input",{directives:[{name:"focus",rawName:"v-focus"}],staticStyle:{margin:"0 auto"},attrs:{size:"mini"},on:{blur:function(t){return e.blurEvent(s)},focus:function(e){s.oldName=s.name}},model:{value:s.name,callback:function(t){e.$set(s,"name",t)},expression:"row.name"}}):i("p",{staticStyle:{float:"left",height:"8px"},domProps:{innerHTML:e._s(s.name)},on:{click:function(e){s.isEdit=!s.isEdit}}})],1)],1)]}}])},[i("template",{slot:"header"},[i("span",[e._v("设备名称")]),i("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[i("i",{staticClass:"el-icon-edit-outline"}),i("div",{staticClass:"tooltip-content",attrs:{slot:"content"},slot:"content"},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击修改设备名称")])])])],1)],2),i("el-table-column",{attrs:{align:"center",label:"设备地址",prop:"devaddr","show-overflow-tooltip":"",sortable:"",width:"120"}}),i("el-table-column",{attrs:{align:"center",label:"安装位置",prop:"address","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",{key:s.address,staticStyle:{color:"#67c23a"},attrs:{type:"success"},on:{click:function(t){return e.showAdddress(s)}}},[e._v(" "+e._s(s.address||s.detail.address||"---")+" ")])]}}])},[i("template",{slot:"header"},[i("span",[e._v("安装位置")]),i("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[i("i",{staticClass:"el-icon-edit-outline"}),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v("点击修改安装位置")])])])],1)],2),i("el-table-column",{attrs:{align:"center",label:"所属产品",prop:"product.objectId","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" "+e._s(e.getProductName(i.product.objectId))+" ")]}}])}),i("el-table-column",{attrs:{align:"center",label:"所属部门",prop:"ACL","show-overflow-tooltip":"",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return e._l(e.getAcl(s.ACL),(function(t){return i("el-tag",{key:t,attrs:{effect:"plain",type:t}},[e._v(" "+e._s(t)+" ")])}))}}])}),i("el-table-column",{attrs:{align:"center",label:"状态",prop:"status","show-overflow-tooltip":"",sortable:"",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;t.$index;return[i("el-tag",{attrs:{type:s.isEnable?"info":"danger"}},[e._v(" "+e._s(1==s.isEnable?"开机":"关机")+" ")]),i("el-tag",{attrs:{type:"ONLINE"==s.status?"success":"warning"}},[e._v(" "+e._s("ONLINE"==s.status?"在线":"离线")+" ")])]}}])},[i("template",{slot:"header"},[i("span",[e._v("状态")]),i("el-tooltip",{attrs:{placement:"top","popper-class":"tooltip"}},[i("i",{staticClass:"el-icon-warning-outline"}),i("div",{staticClass:"tooltip-content",attrs:{slot:"content"},slot:"content"},[i("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 1. 开机关机属于网关子设备 "),i("br"),e._v(" 2. 在线离线属于网关网络状态 ")])])])],1)],2),i("el-table-column",{attrs:{align:"center",label:"离线时间","show-overflow-tooltip":"",sortable:"",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" "+e._s(i.lastOnlineTime?e.$moment.unix(i.lastOnlineTime).format("YYYY-MM-DD HH:mm:ss"):"")+" ")]}}])}),i("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation")},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.konvaDevice(s)}}},[e._v(" "+e._s(e.$translateTitle("concentrator.konva"))+" ")]),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deviceToDetail(s)}}},[e._v(" "+e._s(e.$translateTitle("product.details"))+" ")]),i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.showTree(s,s.objectId,s.Company)}}},[e._v(" "+e._s(e.$translateTitle("equipment.move"))+" ")]),i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleDelete(s.objectId,2)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")])]}}])})],1),i("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),i("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},a=[],r=i("1285"),o=i("5880"),n=i("3248"),l=i("7212"),d=i("cb88"),c=Object.defineProperty,u=Object.defineProperties,h=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,i)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,v=(e,t)=>{for(var i in t||(t={}))m.call(t,i)&&b(e,i,t[i]);if(p)for(var i of p(t))g.call(t,i)&&b(e,i,t[i]);return e},y=(e,t)=>u(e,h(t)),f=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),$={name:"ComprehensiveTable",components:{TableEdit:n["default"],BmLocalSearch:d["BmLocalSearch"],BmPointCollection:d["BmPointCollection"],BmInfoWindow:d["BmInfoWindow"],BmScale:d["BmScale"],BmMapType:d["BmMapType"],BmView:d["BmView"],BmOverviewMap:d["BmOverviewMap"],BmPanorama:d["BmPanorama"],BmControl:d["BmControl"],BmLabel:d["BmLabel"],BaiduMap:d["BaiduMap"],BmNavigation:d["BmNavigation"],BmGeolocation:d["BmGeolocation"],BmCityList:d["BmCityList"],BmMarker:d["BmMarker"],BmlMarkerClusterer:d["BmlMarkerClusterer"]},data(){return{dialog_device:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},bmLabel:!1,popoverVisible:!1,deciceCompany:"",roleProps:{children:"children",label:"name"},curDepartmentId:"",mapHeight:"300px",mapWidth:"100%",map:{innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},form:{sync:!1,type:"add",product:"",name:"",devaddr:"",address:"",location:{__type:"GeoPoint",latitude:"120.161324",longitude:"30.262441"},detail:{assetNum:""}},rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],product:[{required:!0,message:"请选择所属产品",trigger:"change"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"change"}],address:[{required:!1,message:"请选择设备安装位置",trigger:"change"}],"detail.assetNum":[{required:!0,message:"请输入资产编号",trigger:"blur"}]},product:[],editRow:{},fold:!1,height:this.$baseTableHeight(0),imgShow:!0,list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{excludeKeys:"channel,children,config,thing,decoder,data,basedata,content",include:"product",product:this.$route.query.product?this.$route.query.product:"",title:"",name:"",isEnable:this.$route.query.isEnable?this.$route.query.isEnable:"",devaddr:"",status:this.$route.query.status?this.$route.query.status:"",skip:0,limit:10}}},computed:v({},Object(o["mapGetters"])({routes:"routes/routes",_tableDict:"global/_tableDict",token:"user/token",roleTree:"user/roleTree",language:"settings/language",_product:"user/_Product",_role:"acl/role",currentDepartment:"user/currentDepartment"})),created(){this.fetchProduct(),this.fetchData()},methods:y(v({},Object(o["mapActions"])({addVisitedRoute:"tabs/addVisitedRoute",changeTabsMeta:"tabs/changeTabsMeta",set_tableDict:"global/set_tableDict",set_tableParser:"global/set_tableParser"})),{blurEvent(e){return f(this,null,(function*(){e.isEdit=!e.isEdit,e.name!==e.oldName&&(yield Object(r["putDevice"])(e.objectId,{name:e.name}),this.$message({message:"设备名称修改成功",type:"success",showClose:!0,duration:1500}))}))},editMap(){return f(this,null,(function*(){const e={location:this.location,address:this.form.address};yield Object(r["putDevice"])(this.editRow.objectId,e),this.dialog_device=!1,this.$message({message:"设备位置更新成功",showClose:!0,type:"success"}),this.fetchData()}))},closeMap(){this.dialog_device=!1,this.map={innerVisible:!1,keyword:"余杭区良渚平高创业城c1座",location:"杭州"},this.mapLabel={content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"}},showAdddress(e){this.editRow=e,this.map.keyword=(null==e?void 0:e.address)?e.address:this.map.keyword,this.form.address=(null==e?void 0:e.address)?e.address:this.form.keyword;const t={lng:Number(e.location.longitude),lat:Number(e.location.latitude)};this.mapLabel={content:e.name,style:{color:"red",fontSize:"12px"},position:t,title:e.address},this.bmLabel=!0,this.dialog_device=!0},transferAcl(e){const t="role:"+e.name,i={};i[t]={read:!0,write:!0};const s={ACL:i};this.$confirm(this.$translateTitle("确定要将设备迁移到"+e.name+"吗"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,(function*(){yield Object(r["putDevice"])(this.editRow.objectId,s),this.$message({showClose:!0,type:"success",message:this.$translateTitle("迁移成功")}),this.popoverVisible=!1,this.fetchData()}))),dgiotlog.log(e.name)},showTree(e,t,i){this.editRow=e,this.deciceCompany=i,this.popoverVisible=!this.popoverVisible},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>f(this,null,(function*(){yield Object(r["delDevice"])(e),this.$baseMessage("设备已成功删除","success","dgiot-hey-message-success"),yield this.fetchData()})))},handler({BMap:e,map:t}){this.map=t},mapClick(e){console.log(e),this.location={__type:"GeoPoint",latitude:e.point.lat,longitude:e.point.lng};const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.form.address=e.address}),this.editRow.objectId&&(this.editRow.location=this.location,this.editRow.address=this.form.address)},getProductName(e){let t="";return this.product.forEach(i=>{i.objectId===e&&(t=i.name)}),t},submitForm(e,t){this.$refs[e].validate(i=>f(this,null,(function*(){if(!i)return console.log("error submit!!"),!1;if("add"==t){const t="role:"+this.currentDepartment.name,i={};i[t]={read:!0,write:!0};const s={name:this.form.name,devaddr:this.form.devaddr,address:this.form.address,location:this.location,detail:this.form.detail,ACL:i,product:{__type:"Pointer",className:"Product",objectId:this.form.product},profile:{},route:{},isEnable:!0,status:"OFFLINE"},{error:a="",objectId:o=""}=yield Object(r["postDevice"])(s);if(a)return this.$message({type:"error",message:a,showClose:!0,duration:2e3}),!1;this.$message({type:"success",message:"设备添加成功",showClose:!0,duration:2e3}),this.form.sync=!1,this.resetForm(e),this.fetchData()}else{const t={name:this.form.name,devaddr:this.form.devaddr,address:this.form.address,location:this.location,detail:this.form.detail},{error:i=""}=yield Object(r["putDevice"])(this.editRow.objectId,t);if(i)return this.$message({type:"error",message:i,showClose:!0,duration:2e3}),!1;this.$message({type:"success",message:"设备信息修改成功",showClose:!0,duration:2e3}),this.form.sync=!1,this.resetForm(e),this.fetchData()}})))},resetForm(e){this.$refs[e].resetFields()},handleClose(e){this.form={sync:!1,type:"add",product:"",name:"",devaddr:"",address:"",location:{__type:"GeoPoint",latitude:"120.161324",longitude:"30.262441"},detail:{assetNum:""}}},getAcl(e){let t=[];for(let i in e)"*"==i?delete e[i]:i.split(":")[1]&&t.push(i.split(":")[1]);return t},handelUpdate(e,t,i){return f(this,null,(function*(){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.list[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>f(this,null,(function*(){yield this.$update_object("Device",t.objectId,{isEnable:e}),this.$message({duration:2e3,showClose:!0,type:"info",message:"设备状态修改成功修改"}),this.fetchData()}))).catch(()=>f(this,null,(function*(){this.$message({duration:2e3,showClose:!0,type:"info",message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.list[i]=e})))}))},fetchProduct(){return f(this,null,(function*(){try{const{results:e=[]}=yield Object(l["queryProduct"])({excludeKeys:"children,thing,decoder,topics,productSecret,desc,view,category,producttemplet"});this.product=e}catch(error){console.log(error)}}))},editorDevice(e){this.editRow=e,console.log(e),this.form={sync:!0,type:"edit",product:e.product.objectId,name:e.name,devaddr:e.devaddr,address:e.address,location:e.detail,detail:e.detail},this.map={innerVisible:!1,keyword:e.address?e.address:"余杭区良渚平高创业城c1座",location:"杭州"}},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,productid:e.product.objectId,ischildren:"false"}})},konvaDevice(e){this.$router.push({path:"/Topo",query:{productid:e.product.objectId,devaddr:e.devaddr,deviceid:e.objectId,type:"device"}})},handleAdd(){this.$refs["edit"].showEdit()},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDetail(e){},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=20,this.fetchData()},fetchData(){return f(this,null,(function*(){console.log(this.queryForm),this.listLoading=!0;let e={skip:this.queryForm.skip,limit:this.queryForm.limit,excludeKeys:this.queryForm.excludeKeys,order:"-createdAt",count:"objectId",where:{}};console.log(this.$route.query),this.queryForm.name&&(e.where.name={$regex:this.queryForm.name}),this.queryForm.product&&(e.where.product=this.queryForm.product),this.queryForm.devaddr&&(e.where.devaddr={$regex:this.queryForm.devaddr}),this.queryForm.status&&(e.where.status=this.queryForm.status),this.queryForm.isEnable&&(e.where.isEnable="true"==this.queryForm.isEnable);const{results:t=[],count:i=0}=yield Object(r["querycompanyDevice"])(e,this.token);t.forEach(e=>{var t;e.address=""==e.address?"---":e.address,e.detail=(null==e?void 0:e.detail)?e.detail:{},e.detail.address=(null==e?void 0:e.detail)&&(null==(t=null==e?void 0:e.detail)?void 0:t.address)?e.detail.address:"---",e.isEdit=!1,e.oldName=e.name}),this.list=t,this.total=i,this.listLoading=!1}))}})},T=$,w=(i("1db3"),i("2877")),C=Object(w["a"])(T,s,a,!1,null,null,null);t["default"]=C.exports},bf0f:function(e,t,i){"use strict";var s=i("c4e6"),a=i("5880"),r=i("1285"),o=i("7dd9"),n=i("662c"),l=Object.defineProperty,d=Object.defineProperties,c=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,i)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,g=(e,t)=>{for(var i in t||(t={}))h.call(t,i)&&m(e,i,t[i]);if(u)for(var i of u(t))p.call(t,i)&&m(e,i,t[i]);return e},b=(e,t)=>d(e,c(t)),v=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())});const y=[{title:"图片",width:120,dataIndex:"imgurl",fixed:"left",key:"imgurl",scopedSlots:{customRender:"imgurl"}},{title:"时间",dataIndex:"time",key:"time"},{title:"名称",dataIndex:"name",key:"name"},{title:"值",dataIndex:"number",key:"number"},{title:"单位",dataIndex:"unit",key:"unit"}];var f={components:{Instruct:o["default"],info:s["default"],runningState:n["default"]},filters:{filterVal(e){return e||0==e?e:"--"}},directives:{"el-select-loadmore":{bind(e,t){const i=e.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.addEventListener("scroll",(function(){const e=this.scrollHeight-this.scrollTop<=this.clientHeight;e&&t.value()}))}}},data(){return this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40}},this.toolbox={orient:"vertical",right:-5,feature:{dataZoom:{yAxisIndex:"none"},magicType:{type:["line","bar","histogram","pie","ring","waterfall","funnel","radar","heatmap","scatter","candle","stack"]},dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0},restore:{show:!0}}},{bmLabel:!1,mapLabel:{content:"我爱北京天安门",style:{color:"red",fontSize:"24px"},position:{lng:116.404,lat:39.915},title:"我爱北京天安门"},router:"",chartKey:moment(new Date).valueOf(),machinelist:{},thirdtbKey:moment(new Date).valueOf(),deviceInfo:{},columns:y,productId:this.$route.query.productid,activeNames:["1"],queryForm:{account:"",searchDate:"",pageNo:1,pageSize:20},buttonactive:1,loading:!0,xl:6,xs:24,sm:24,md:12,dataEmpty:!0,chartDataZoom:[{type:"slider"}],pickerOptions:{shortcuts:[{text:this.$translateTitle("developer.LastWeek"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastMonth"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:this.$translateTitle("developer.LastThreeMonths"),onClick(e){const t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]},pickerOptionsDay:{shortcuts:[{text:this.$translateTitle("developer.today"),onClick(e){e.$emit("pick",new Date)}},{text:this.$translateTitle("developer.yesterday"),onClick(e){const t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:this.$translateTitle("developer.A week ago"),onClick(e){const t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},chartData:{identifier:[],columns:[],rows:[]},params:{_function:"last",style:"",number:1,interval:"h",datetimerange:"",keys:"*",limit:100,endTime:(new Date).getTime(),startTime:(new Date).getTime()-6048e5},interval:[{type:"y",name:"年"},{type:"n",name:"月"},{type:"w",name:"周"},{type:"d",name:"日"},{type:"h",name:"时"},{type:"m",name:"分"},{type:"s",name:"秒"},{type:"a",name:"毫秒"},{type:"u",name:"微秒"}],functionarr:["count","avg","sum","stddev","min","max","first","last"],disabledChart:["map","sankey","wordcloud","liquidfill","tree","gauge"],options:[{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}],value:"",chartSettings:{},queryFlag:!0,width:0,lineChartData:"",datafordetail:[],datadialogVisible:!1,childDialog:!1,ninthform:{product:"",devices:""},wmxform:{product:"",devices:""},tableData:[],activeName:"first",text:"1111111",deviceid:"",topicData:[],thirdstart:1,thirdlength:10,thirdtotal:0,topic:[{topic:"thing/${ProductId}/${DevAddr}/post",type:"pub",desc:"设备上报",isdef:!0},{topic:"thing/${ProductId}/${DevAddr}",type:"sub",desc:"消息下发",isdef:!0}],thirdData:[],thirdDatas:[],ispushdata:!0,timer:null,isshowtable:!1,childrendevices:{devicesname:""},multipleTable:[],devicesTableData:[],childrenDeviceLength:10,childrenDeviceStart:0,childrenDeviceTotal:0,childrenForm:{product:"",device:"",route:""},isshowchild:!1,allProudct:[],productDevices:[],ischange:!1,ischildren:!1,productid:"",dataDeviceTotal:0,dataDeviceLength:10,dataDeviceStart:1,devicedevaddr:"",dirstart:1,dirlength:20,selectproduct:"",watchNum:0}},computed:g({},Object(a["mapGetters"])({Device:"settings/device",chartType:"product/chartType"})),watch:{sm(e){this.$nextTick(e=>{this.resizeTheChart(),setTimeout(()=>{this.loading=!1},2e3)})}},mounted(){this.getDeviceInfo(this.$route.query.deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.topicKey=this.$dgiotBus.topicKey(this.router,this.subtopic),this.deviceid=this.$route.query.deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart)},destroyed:function(){this.Unbscribe()},beforeDestroy(){window.removeEventListener("resize",this.resizeTheChart),this.Unbscribe()},methods:b(g({subRealtimedata(){return v(this,null,(function*(){try{yield this.$subscribe(this.subtopic),console.log(this.$mqttInfo),console.groupCollapsed("%c mqtt 订阅日志","color:#009a61; font-size: 28px; font-weight: 300"),console.log("topic:",this.subtopic),console.log("router:",this.router),console.groupEnd(),this.$dgiotBus.$off(this.$mqttInfo.topicKey),this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{console.groupCollapsed("%c mqttMsg消息回调","color:#009a61; font-size: 28px; font-weight: 300"),console.log(e),console.log(Base64.decode(e.payload)),console.log(JSON.parse(Base64.decode(e.payload)).data),console.log("Base64.decode(payload):",Base64.decode(e.payload)),console.groupEnd();const{data:t=[]}=JSON.parse(Base64.decode(e.payload));t?this.renderCard(t):this.CardDevice()})}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))}},Object(a["mapActions"])({setTreeFlag:"settings/setTreeFlag",delVisitedRoute:"tabs/delVisitedRoute",addVisitedRoute:"tabs/addVisitedRoute"})),{Unbscribe(){const e="$dg/user/trace/"+this.deviceInfo.objectId+"/#",t=this.$dgiotBus.topicKey(this.router,e);this.$dgiotBus.$emit("MqttUnbscribe",t,e),this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic)},getDeviceInfo(e){return v(this,null,(function*(){var t;try{var i=yield Object(r["getDevice"])(e);const{location:a={longitude:"116.404",latitude:"39.915"}}=i;let o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(a.longitude),lat:Number(a.latitude)},title:i.name};i.basedata&&i.basedata.baiduaddr&&i.basedata.baiduaddr.formatted_address&&(o={content:i.name,style:{color:"red",fontSize:"24px"},position:{lng:Number(i.basedata.baiduaddr.location.lng),lat:Number(i.basedata.baiduaddr.location.lat)},title:i.name});var s=null!=(t=i.product.objectId)?t:"";const n=i.devaddr;let l=[{topic:`thing/${s}/${n}/post`,type:"pub",desc:"设备上报",isdef:!0},{topic:`thing/${s}/${n}`,type:"sub",desc:"消息下发",isdef:!0}];i.topicData=i.product.topics?i.product.topics.concat(l):l,console.log(i,"resultes"),this.deviceInfo=i,this.mapLabel=o,this.$refs["map"]&&(this.$refs["map"].baiduCenter=this.mapLabel.position),this.bmLabel=!0,console.info("vm.mapLabel\n",this.mapLabel),console.info("vm.mapLabel\n",this.$refs["map"])}catch(error){console.log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},toggleChart(e){this.chartKey=moment(new Date).valueOf(),this.loading=!1,console.log(e),this.chartExtend={},this.chartDataZoom=[];let t=["funnel","radar","radar"];-1!=t.indexOf(e)?(this.chartExtend={},this.chartDataZoom=[]):(this.chartExtend={series:{barMaxWidth:35},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],left:"9%",bottom:-5,start:10,end:90}],grid:{right:40},yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}]},this.chartDataZoom=[{type:"slider"}]),this.resizeTheChart()},resizeTheChart(){let e=this.$refs["charts"];e instanceof Array?(e.forEach(e=>{e.$children[0].resize()}),console.log("重绘完成",e)):e.$children[0].resize()},toggleCardRow(e,t,i,s,a){this.sm=24==i?12:24,this.md=12==s?24:12,this.xl=6==a?12:6,this.loading=!0},afterConfig(e){return e.tooltip.showDelay=500,e},initChart(){const e=new Date,t=new Date;t.setTime(t.getTime()-6048e5),this.params.datetimerange=[t,e],this.queryFlag=!1,this.$queryProduct({}).then(e=>{this.allProudct=e.results})},queryChart(){return v(this,null,(function*(){if(this.loading=!0,dgiotlogger.log("queryChart",this.params),this.chartData={identifier:[],columns:[],rows:[]},this.params.startTime&&this.params.endTime){let e=this.$route.query.deviceid;const{interval:t,keys:i,limit:s,number:a,style:o,_function:n,startTime:l,endTime:d}=this.params;let c={starttime:moment(l).valueOf(),endtime:moment(d).valueOf(),interval:a+t,keys:i,limit:s,function:n,style:o};yield Object(r["getDabDevice"])(e,c).then(e=>{if(console.log(e,"res charts"),null==e?void 0:e.chartData){const{chartData:t={}}=e;this.chartData=t,this.$nextTick(()=>{setTimeout(()=>{this.loading=!0,this.toggleChart("line")},1e3)})}console.log("this.chartData",this.chartData),this.loading=!1,this.dataEmpty=!1}).catch(e=>{console.log(e),this.loading=!1})}}))},print(e){console.log(e)},tabHandleClick(e){switch(this.$dgiotBus.$emit("MqttUnbscribe",this.topicKey,this.subtopic),e.name){case"ninth":this.$router.push({path:"/roles/onlinetest",query:{deviceid:this.devicedevaddr,productid:this.productid}});break;case"children":this.getDevices(),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"instruct":this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"third":this.queryChart();break;case"right":this.toggleClass("rightrow"),this.loading=!0,setTimeout(()=>{this.loading=!1},300);break;case"task":this.$refs.SceneLog.get_topic();break;case"first1":this.subRealtimedata(),this.CardDevice();break}},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},getDevices(e){0==e&&(this.childrenDeviceStart=0),this.devicesTableData=[];const t={limit:this.childrenDeviceLength,skip:this.childrenDeviceStart,count:"objectId",include:"product",where:{parentId:this.deviceInfo.objectId}};""!=this.childrendevices.devicesname&&(t.where.devaddr=this.childrendevices.devicesname),console.log("this.params",t),this.$queryDevice(t).then(e=>{this.childrenDeviceTotal=e.count,e.results&&e.results.map(e=>{var t={};t.objectId=e.objectId,t.name=e.name,t.status=e.status,t.originstatus=e.status,t.nodeType=e.product.nodeType,t.productName=e.product.name,t.devaddr=e.devaddr,t.isEnable=e.isEnable,t.route=e.route,this.devicesTableData.push(t)})}).catch(e=>{console.log(e),this.$baseMessage("请求出错11",e.error,3e3)})},CardDevice(){this.loading=!0,Object(r["getCardDevice"])(this.deviceid).then(e=>{(null==e?void 0:e.data)&&this.renderCard(e.data)}).catch(e=>{console.log("update error 清除timer",e)}),setTimeout(()=>{this.loading=!1},800)},renderCard(e){let t=[];e.forEach(e=>{e.devicetype&&t.push(e.devicetype)}),t=_.uniqBy(t);let i={};t.forEach(t=>{let s=[];e.forEach(e=>{e.module="card",t==e.devicetype&&s.push(e)}),i[t]=s}),this.machinelist=i,this.thirdtbKey=moment(new Date).valueOf()},dataDeviceSizeChange(e){this.dataDeviceStart=1},dataDeviceCurrentChange(e){this.dataDeviceStart=e},handleSizeChange1(e){this.thirdstart=1,this.thirdlength=e},handleCurrentChange1(e){this.thirdstart=e},DevicesSelectionChange(e){this.multipleTable=e},childrenDeviceCurrentChange(e){this.childrenDeviceStart=(e-1)*this.childrenDeviceLength,this.getDevices()},childrenDeviceSizeChange(e){this.childrenDeviceLength=e,this.getDevices()},checkProduct(e){this.ischange=!0,this.selectproduct=e;const t={limit:this.dirlength,skip:(this.dirstart-1)*this.dirlength,count:"objectId",where:{product:e}};this.$queryDevice(t).then(e=>{e.results&&e.results.length>0?this.productDevices=e.results:this.productDevices=[],this.childrenForm.device=""})},deviceToDetail(e){return v(this,null,(function*(){console.log("row",e);const t={deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"};yield this.delVisitedRoute(this.$route.path),this.activeName="first",this.$router.push({path:this.$route.path,query:t}),this.getDeviceInfo(deviceid),this.setTreeFlag(!1),this.params.style=this.chartType[0].type,console.log(" this.params.style",this.params.style),this.subtopic=`$dg/user/realtimecard/${this.$route.query.deviceid}/report`,this.router=this.$dgiotBus.router(location.href+this.$route.fullPath),this.deviceid=deviceid,this.subRealtimedata(),this.initChart(),window.addEventListener("resize",this.resizeTheChart),this.CardDevice()}))},loadmore(){this.dirstart++,this.checkProduct(this.selectproduct)},submitDevice(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;var t={};t[this.deviceInfo.devaddr]=this.childrenForm.route;var i={parentId:{__type:"Pointer",className:"Device",objectId:this.deviceid},route:t};this.$putDevice(this.childrenForm.device,i).then(e=>{e&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.childDialog=!1,this.getDevices(),this.$refs["childrenForm"].resetFields())})})},deleteDevcie(e){Promise.all([this.multipleTable.map(e=>{const t={parentId:null};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"解除关联成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"解除关联失败",type:"error"})}).catch(e=>{console.log(e)})},unactiveDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!1};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"禁用成功",type:"success"}),this.getDevices()):this.$message({message:"禁用失败",type:"error"})}).catch(e=>{console.log(e)})},activeDevice(e){Promise.all([this.multipleTable.map(e=>{const t={isEnable:!0};this.$putDevice(e.objectId,t).then(e=>{})})]).then(e=>{e&&0!=e.length?(this.$message({showClose:!0,duration:2e3,message:"启用成功",type:"success"}),this.getDevices()):this.$message({showClose:!0,duration:2e3,message:"启用失败",type:"error"})}).catch(e=>{console.log(e)})},makeSure(e,t){const i=JSON.parse(JSON.stringify(e.route)),s=this.deviceInfo.devaddr;delete i[s];const a={parentId:{__type:"Pointer",className:"Device",objectId:0},route:i};this.$putDevice(e.objectId,a).then(e=>{e&&(this.$message({type:"success",showClose:!0,duration:2e3,message:"解除关联成功"}),this.getDevices())})},handelUpdate(e,t,i){var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.devicesTableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;const s={isEnable:e.isEnable};this.$putDevice(t.objectId,s).then(e=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"状态修改成功"})}),this.getDevices()}).catch(()=>{this.$message({type:"info",showClose:!0,duration:2e3,message:"已取消修改"});const e=t;e.isEnable=1!=e.isEnable,this.devicesTableData[i]=e})}})};t["a"]=f},c4dbe:function(e,t,i){"use strict";i.r(t);var s,a,r,o,n,l,d=i("4351"),c=i("40d1"),u=i("22f9"),h=i("5880"),p=i("1285"),m=i("7212"),g=i("89e8"),b=i("1267"),v=i("e0e9"),y=i("1b07"),f=i("ef68"),$=i("bb22"),T=i("5118"),w=i("aed5"),C=i("30b0"),I=i("4013"),D=i("8ba7"),j=i("0c3c"),F=i("62b6"),S=Object.defineProperty,A=Object.defineProperties,k=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,P=(e,t,i)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,L=(e,t)=>{for(var i in t||(t={}))q.call(t,i)&&P(e,i,t[i]);if(x)for(var i of x(t))O.call(t,i)&&P(e,i,t[i]);return e},E=(e,t)=>A(e,k(t)),N=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),G={};const z=i("f43e").Base64;var B="",M="";t["default"]={components:{mqttLog:d["default"],dgiotViews:j["default"],"dgiot-wmx":w["default"],"dgiot-profile":C["default"],"thing-form":c["default"]},data(){const e=(e,t,i)=>{const s=/[0-9a-zA-Z]/;s.test(t)?i():i(new Error("协议名称由数字和字母组合"))},t=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.sizeForm.endnumber&&(t>=this.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.sizeForm.startnumber&&(t<=this.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},s=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.sizeForm.endnumber-this.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},a=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.structform.endnumber&&(t>=this.structform.endnumber?i(new Error("最小值小于最大值")):i())},r=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.structform.startnumber&&(t<=this.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},o=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.structform.endnumber-this.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{viewForm:{showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]},dlinkUnit:[],dlinkTopic:{basic:[],thing:[]},mergeObj:{basic:[],thing:[]},tabsChild:"properties",modules:{data:{properties:[],events:[],services:[],tags:[]},type:"events",disabled:!1,visible:!1,events:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],types:[{required:!0,message:"请选择调用方式",trigger:"change"}],output:[{type:"array",required:!0,message:"请至少选择一个输出参数",trigger:"blur"}]},visible:!1,data:{outputParams:[],name:"",identifier:"",types:"info",output:[],describe:""}},services:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:40,message:"长度在 1 到 40 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],transfer:[{required:!0,message:"请选择调用方式",trigger:"change"}]},visible:!1,data:{name:"",identifier:"",enter:[],transfer:"sync",output:[],describe:""}}},moduletype:"properties",amisproductInfo:[],upKey:moment.now(),codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[],events:[],services:[],tags:[]},config:{parser:[],profile:[],basedate:{params:[]}}},productObj:{thing:{properties:[],events:[],services:[],tags:[]}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{profile:"",topic:"",type:"",desc:"",value:"",info:"basic",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{info:[{required:!0,message:"请选择topic所属类型",trigger:"change"}],topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:s}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:t,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:o}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:r,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0,data:{}},ProductSecret:"",dynamicReg:!1,productId:"",productName:"",productdetail:{thing:{properties:[],events:[],services:[],tags:[]}},topicData:[],topicDefault:{},topic:[{topic:"$dg/user/${deviceid}/post",type:"sub",desc:"设备属性上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"pub",desc:"消息下发",isdef:!0}],isshow:!0,isaccumulate:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:e,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,eventsStart:1,eventsPageSize:10,servicesStart:1,servicesPageSize:10,tagsStart:1,tagsPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],topicKey:"",refreshFlag:"99",msgList:[],submessage:"",mqtt:{router:"",subtopic:"",pubtopic:""},warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,channelid:"",channelInfo:[],textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1,atbas:{visible:!1,childrenDrawer:!1},editIndex:-1,eventType:"add",formType:"output",thingType:"events",eventForm:{},ruleForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},amisShow:!0,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]}}},computed:L({treeData(){const e=JSON.parse(JSON.stringify(this.option));return e.filter(t=>{const i=e.filter(e=>t.id==e.parentid);return i.length>0&&(t.children=i),0==t.parentid})},showNewItem(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(h["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler(e){this.subtimer=window.setInterval(()=>{this.subAce("formInline",!1)},5e3)}}},mounted(){this.query_notification(),this.getAllunit(),this.getDefaultTopic(),this.$nextTick(()=>{this.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",this.mqtt.router=this.$dgiotBus.router(this.$route.fullPath)}),this.Industry(),this.getAllunit(),r=ace.edit("editor2"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/monokai"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.activeName&&(this.activeName=this.$route.query.activeName),this.$route.query.id&&this.queryProductInfo(this.$route.query.id)},beforeDestroy(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:E(L({toggleSwitch(e){e.isshow=!e.isshow,this.preserve("isshow")},thingParameters(e,t,i){this.editIndex=t,console.log("thingParameters",e,this.modules,this.modules.data[this.modules[i]]),this.modules.data[i].data.output.push(e),this.atbas.childrenDrawer=!1},editParameters(e,t){console.log("thingParameters",e),this.modules[t].data.output[this.editIndex]=e,this.atbas.childrenDrawer=!1},showDrawer(){this.atbas.visible=!0},onClose(){this.atbas.visible=!1},showChildrenDrawer(){this.eventForm={name:"",unit:"/",isread:"rw",dataType:"int32",identifier:"",min:"",max:"",step:""},this.eventType="add",this.atbas.childrenDrawer=!0},onChildrenDrawerClose(){this.atbas.childrenDrawer=!1,console.log("清空子组件的规则校验和表单数据")},basicMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},thingMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},editEvent(e,t,i){return N(this,null,(function*(){this.editIndex=t,yield console.log("editEvent",e),this.atbas.childrenDrawer=!0,this.eventForm=e,this.eventType="edit",this.formType=i}))},getDefaultTopic(){return N(this,null,(function*(){const e=yield Object(u["getDlinkJson"])("Topic"),{UnifyUnitSpecsDTO:t=[]}=yield Object(u["getDlinkJson"])("Unit");for(var i in this.dlinkUnit=t,this.dlinkUnit.unshift({Symbol:"/",Name:"无"}),this.dlinkTopic=e,this.dlinkTopic)yield this.mergeTable(i,this.dlinkTopic[i]);dgiotlogger.error("mergeObj",this.mergeObj)}))},topicChange(e){return N(this,null,(function*(){"user"==e&&(yield this.getTopic())}))},mergeTable(e,t){return N(this,null,(function*(){let i=0;for(let s in t[0])this.mergeObj[e][s]=[],t.forEach((a,r)=>{0===r?this.mergeObj[e][s].push(1):a[s]===t[r-1][s]?(this.mergeObj[e][s][i]+=1,this.mergeObj[e][s].push(0)):(i=r,this.mergeObj[e][s].push(1))})}))},clearfix(e){this.$refs[e].clearValidate(),"services"==e?this.$refs.services.resetFields():this.$refs.events.resetFields(),this.modules.events.data.types="info",this.modules.services.data.transfer="sync"},editModus(e){this.modules[""+e.type].data=e,this.modules.type=e.type,this.modules.visible=!0,this.modules.disabled=!0,dgiotlogger.info("editModus",e,this.modules[""+e.type])},deleteModus(e,t,i){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>N(this,null,(function*(){t.splice(e,1),yield this.saveExpand(this.productObj.thing)})))},handleClose(){"events"==this.modules.type&&(this.$refs.events.clearValidate()&&this.$refs.events.resetFields()),"services"==this.modules.type&&(this.$refs.services.clearValidate()&&this.$refs.services.resetFields()),this.modules.events.data.types="info",this.modules.services.data.transfer="sync",this.modules.visible=!1,this.modules.disabled&&this.saveExpand(this.productObj.thing)},saveExpand(e){return N(this,null,(function*(){const t=yield Object(m["putProduct"])(this.productObj.objectId,{thing:e});t.updatedAt?this.$message({type:"success",message:"更新成功",showClose:!0,duration:2e3}):this.$message({type:"warning",message:"更新失败"+t.msg,showClose:!0,duration:2e3})}))},queryProductInfo(e){return N(this,null,(function*(){const t=yield Object(m["getProduct"])(e),{thing:i={properties:[],events:[],services:[],tags:[]}}=t;_.merge({properties:[],events:[],services:[],tags:[]},i);const s=_.merge({properties:[],events:[],services:[],tags:[]},i);dgiotlogger.log("thing",s),this.productObj=t,this.modules.data=s,this.productdetail.thing=s}))},submitModules(e,t){return N(this,null,(function*(){t.data.outputParams=[],console.log(t.data.output,"form.data.output"),console.log(t.data,"form.data"),t.data.output.forEach((e,i)=>{t.data.outputParams.push({identifier:e.identifier,index:i})});const i=E(L({},t.data),{devicetype:t.data.name,required:!1,isshow:!0,isaccumulate:!1,dataForm:{order:moment(new Date).format("x")},dataType:{type:e},moduleType:e,updateAt:moment(new Date).format("x")});return console.log("_item",i),window._item=i,yield this.submitForm(i),this.atbas.visible=!1,yield this.queryProductInfo(this.$route.query.id),!1}))},feateditorParser1(e,t,i){let s=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:i,productInfo:s})}},Object(h["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{tableRowClassName({row:e,rowIndex:t}){return 1===t?"warning-row":3===t?"success-row":""},selectStruct(e){},toggleList(){this.showList=!this.showList},getFormOrginalData(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,isaccumulate:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%s",control:"%d",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"}},changeValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},changeStructValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},getRowClass(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleChildClick(e){return N(this,null,(function*(){yield this.queryProductInfo(this.$route.query.id);const{properties:t=[],events:i=[],services:s=[],tags:a=[]}=this.productObj.thing;switch(console.log(this.tabsChild,e),console.log(e.name,this.productObj.thing,this.productObj.thing[e.name]),e.name){case"properties":this.modules.data.properties=t||[];break;case"events":this.modules.data.events=i||[];break;case"services":this.modules.data.services=s||[];break;case"tags":this.modules.data.tags=a||[];break;default:break}dgiotlogger.info(this.modules.data)}))},handleClick(e){switch(e.name){case"view":this.viewForm={class:"Product",type:"amis",key:this.$route.query.id||"",title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:[]};break;case"first":this.viewForm={showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]};break;case"fiveth":this.getProductChannel();break;case"second":this.getTopic();break;case"seven":this.getResourceChannel();break;case"sixeth":this.orginRule();break;case"eighth":this.isreload++;break;default:window.clearInterval(this.subtimer),this.subtimer=null;break}},getAllunit(){return N(this,null,(function*(){this.allunit=[];const{UnifyUnitSpecsDTO:e=[]}=yield Object(u["getDlinkJson"])("Unit");this.allunit=e}))},getTopic(){return N(this,null,(function*(){this.topicData=[],this.topicDefault={};const{topics:e={}}=yield Object(m["getProduct"])(this.productId);this.topicDefault=e;for(let t in e){let i={};for(let e in this.dlinkTopic.basic)this.dlinkTopic.basic[e].info="basic",this.dlinkTopic.basic[e].id===t&&(i=this.dlinkTopic.basic[e]);for(let e in this.dlinkTopic.thing)this.dlinkTopic.thing[e].info="thing",this.dlinkTopic.thing[e].id===t&&(i=this.dlinkTopic.thing[e]);i.name=t,i.value=e[t],this.topicData.push(i)}console.log(this.topicData)}))},exportProduct(e){return N(this,null,(function*(){try{const t={name:e},i=this.$baseColorfullLoading(),s=yield Object(b["downBinary"])("iotapi/product",t);I["dgiotlog"].log(s),this.$baseMessage(this.$translateTitle("alert.Data request successfully"),"success","dgiot-hey-message-success"),i.close(),this.$downBinary(s)}catch(error){I["dgiotlog"].log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},seeDecoder(e){return N(this,null,(function*(){try{this.ace_editor=z.decode(e.code)}catch(error){I["dgiotlog"].log(error)}}))},setTemplate(e){return N(this,null,(function*(){const t=this.$baseColorfullLoading(),{category:i="IotHub",config:s={konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}},decoder:a={code:""},desc:r="",icon:o="",name:n="",netType:l="Modbus",nodeType:d=0,thing:c={properties:[]}}=e;try{const e={"*":{read:!0,write:!0}},u={ACL:e,category:i,config:s,decoder:a,desc:r,icon:o,name:n,netType:l,nodeType:d,thing:c},h=yield Object(f["postProductTemplet"])(u);I["dgiotlog"].log(h),h?this.$baseMessage(this.$translateTitle("user.Save the template successfully"),"success","dgiot-hey-message-success"):this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error"),t.close()}catch(error){I["dgiotlog"].log(error),t.close(),this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error")}}))},updatesubdialog(){return N(this,null,(function*(){this.protoldialog=!0;const e="1",t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.protolchannel=e.results,this.$refs.multipleTable.toggleAllSelection()}).catch(e=>{I["dgiotlog"].log(e),this.$baseMessage("请求出错",e.error,3e3)})}))},handleSelectionChange(e){this.multipleSelection=e},updateAllChannel(){if(0==this.multipleSelection.length)this.protoldialog=!1;else{var e=[];this.multipleSelection.map(t=>{e.push(new Promise((e,i)=>Object($["subupadte"])(t.objectId,"update").then(t=>{t&&e(t)}).catch(e=>{i(e)})))}),Promise.all(e).then(e=>{this.$message({showClose:!0,duration:2e3,message:"热加载成功",type:"success"}),e.length==this.multipleSelection.length&&(this.protoldialog=!1)}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:e,type:"error"})})}},showAllChannel(e=""){I["dgiotlog"].log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;const t={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(""!=e?this.allChannellength:this.channellength,""!=e?this.allChannelstart:this.channelstart,i,t).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},getProductChannel(){const e={$in:["1","3"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.channeltotal=e.count,this.channelData=e.results,0==e.results.length}).catch(e=>{I["dgiotlog"].log(e)})},resourceShowAllChannel(){this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;const e={$in:["2"]},t={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},getResourceChannel(){const e={$in:["2"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.resourcetotal=e.count,this.resourcechannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},addProductChannel(e){return N(this,null,(function*(){const t={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}},i=yield Object(g["saveChanne"])(e,t);i&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),1==this.channeltype?(this.showAllChannel(),this.getProductChannel()):(this.resourceShowAllChannel(),this.getResourceChannel()))}))},deleteRelation(e){const t={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(g["saveChanne"])(e.objectId,t).then(e=>{e&&this.$message({showClose:!0,duration:2e3,type:"success",message:"移除成功"}),this.getProductChannel(),this.getResourceChannel()})},channelSizeChange(e){this.channellength=e,this.getProductChannel()},channelCurrentChange(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize(e){this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,G=JSON.parse(JSON.stringify(e.config)),Object(T["setTimeout"])(()=>{o=ace.edit("editormodel"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/twilight"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setReadOnly(!0),o.setValue(JSON.stringify(this.productdetail.thing,null,4)),n=ace.edit("editorcreate"),n.session.setMode("ace/mode/mysql"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?n.setValue(e.config.datamodel):n.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')})},questionModel(){Object(T["setTimeout"])(()=>{l=ace.edit("editorinsert"),l.session.setMode("ace/mode/mysql"),l.setTheme("ace/theme/gob"),l.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),l.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')})},addData(){return N(this,null,(function*(){G.datamodel=n.getValue();const e={config:G};yield Object(g["putChannel"])(this.rproductdetailesourcechannelid,e),this.$message("添加成功")}))},closeWuDialog(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1(){this.structform.specs.push({value:"",name:""})},submitForm(e){I["dgiotlog"].log("obj",e);let t={item:e,productid:this.productId};"新增"==this.wmxSituation?Object(m["postThing"])(t).then(e=>{I["dgiotlog"].log("新增",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"新增成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}):"编辑"==this.wmxSituation&&Object(m["putThing"])(t).then(e=>{I["dgiotlog"].log("编辑",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}),this.wmxdialogVisible=!1,this.queryProductInfo(this.$route.query.id)},createThing(e){switch(this.modules.disabled=!1,this.moduletype=e,this.wmxSituation="新增",this.setSizeForm(this.getFormOrginalData()),e){case"properties":this.wmxdialogVisible=!0;break;case"services":this.atbas.visible=!0,this.modules.type="services";break;case"events":this.atbas.visible=!0,this.modules.type="events";break;case"tags":this.wmxdialogVisible=!0;break}this.$nextTick(()=>{this.$refs[e]&&this.$refs[e].clearValidate(),this.$refs[e]&&this.$refs[e].resetFields()})},wmxDataFill(e,t,i){return N(this,null,(function*(){if(this.$nextTick(()=>{this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol()}),this.moduletype=i,this.modules.type=i,this.wmxSituation="编辑",this.thingType=i,this.eventType="edit",this.modules[i]&&(this.modules[i].data=e),"events"===i||"services"===i)return this.atbas.visible=!0,dgiotlogger.log(this.modules.type,this.modules[i].data),!1;this.modifyIndex=t,this.wmxdialogVisible=!0;var s={},a=[];if(e.dataType.das.forEach(e=>{a.push({addr:e})}),-1!=["float","double","int","long"].indexOf(e.dataType.type))s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:a,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0},e.dataForm&&(s.collection=e.dataForm.collection,s.control=e.dataForm.control,s.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var r=[];for(const t in e.dataType.specs)r.push({attribute:t,attributevalue:e.dataType.specs[t]});s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:r,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0});I["dgiotlog"].log("editrowData",e),s.protocol=e.dataForm.protocol,s.profile=e.profile,this.setSizeForm(s),this.$nextTick(()=>N(this,null,(function*(){this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol(),this.$refs["sizeForm"].resource.value=e.dataForm.protocol,this.$refs["sizeForm"].resource.disabled=!!e.dataForm.protocol.length,this.$refs["sizeForm"].resource.arrlist=e.dataSource;yield Object(F["getProtocol"])();this.$nextTick(()=>{this.$refs["sizeForm"].resource.data.forEach((t,i)=>{if(this.$refs["sizeForm"].resource.value===t.cType){for(var s in console.info(t,"物模型回显事件"),t.arr.forEach(t=>{t.allowCreate&&this.$refs["sizeForm"].dynamicTable(t,"回显",e.dataSource[t.showname])}),console.info(e.dataSource,"rowData.dataSource"),e.dataSource)for(var a in t.obj)s===a&&(t.obj[s]=e.dataSource[a]);console.info(t.obj,"set resource.obj"),this.$refs["sizeForm"].resource.addchannel=t.obj}this.$refs["sizeForm"].resource.changeData=e.dataSource,t.cType==e.dataForm.protocol&&console.log(t,"success")})}),console.log("refs sizeForm",this.$refs["sizeForm"])})))}))},submitStruct(e){this.$refs[e].validate(t=>{if(t){var i={};if("float"==this.structform.type||"double"==this.structform.type||"int"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{max:this.structform.endnumber,min:this.structform.startnumber,step:this.structform.step,unit:""==this.structform.unit?"":this.structform.unit}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("bool"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{0:this.structform.false,1:this.structform.true}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!1,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("enum"==this.structform.type){var s={};this.structform.struct.map(e=>{var t=e["attribute"];s[t]=e["attributevalue"]}),i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),struct:this.structform.struct,specs:s},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}}else"text"==this.structform.type?i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),size:this.structform.string},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}:"date"==this.structform.type&&(i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase()},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier});-1==this.isupdatedstruct?this.sizeForm.struct.push(i):(this.sizeForm.struct.splice(this.isupdatedstruct,1,i),this.isupdatedstruct=-1),this.$refs[e].resetFields(),this.structdialog=!1}})},addStruct(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct(e,t){if(I["dgiotlog"].log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((t,s)=>{i.attribute=t,i.attributevalue=e.dataType.specs[t],this.structform.specs.push(i)})}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct(e){this.sizeForm.struct.splice(e,1)},preserve(e){return N(this,null,(function*(){const t="json"===e?"物模型修改成功":"物模型状态更新成功",i="json"===e?{thing:JSON.parse(a.getValue())}:{thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,i),Object(T["setTimeout"])(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:t}),"json"===e&&(this.schemadialogVisible=!1,this.handleChildClick(this.tabsChild),this.getProDetail())},1e3)}))},Industry(){return N(this,null,(function*(){this.option=[];const{results:e}=yield this.$getIndustry("category",100);e.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.option.push(t)}),this.getProDetail()}))},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData(e){0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;const t={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(t.where.type=this.category[this.category.length-1]),Object(v["getDictCount"])(t).then(e=>{this.producttotal=e.count,this.PropData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},productSizeChange(e){this.productlength=e,this.getPropData()},productCurrentChange(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest(){this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(T["setTimeout"])(()=>{this.editorList.push(ace.edit(this.wmxData[0].identifier)),this.editorList[0].session.setMode("ace/mode/erlang"),this.editorList[0].setTheme("ace/theme/monokai"),this.editorList[0].setHighlightActiveLine(!0),this.editorList[0].setFontSize(20),this.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.ed3isShow=!0,this.editorList[0].setValue(void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection)},1)},handleRightTopTabClick(e,t){this.activeIndex=e.label},menuTabClick(e,t){this.activeIndex=e.identifier;const i=this.editableTabs;let s=!1,a=0;i.forEach((t,i)=>{t.name===e.identifier&&(s=!0,a=i)}),0==s?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(T["setTimeout"])(()=>{this.editorList.push(ace.edit(e.identifier)),this.editorList[this.editorList.length-1].session.setMode("ace/mode/erlang"),this.editorList[this.editorList.length-1].setTheme("ace/theme/monokai"),this.editorList[this.editorList.length-1].setHighlightActiveLine(!0),this.editorList[this.editorList.length-1].setFontSize(20),this.editorList[this.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.editorList[this.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)},1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[a].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab(e){const t=this.editableTabs;let i=this.editableTabsValue;i===e&&t.forEach((s,a)=>{if(s.name===e){const e=t[a+1]||t[a-1];e&&(i=e.name)}}),this.editableTabsValue=i,this.activeIndex=i,this.editableTabs=t.filter(t=>t.name!==e)},onSaveTap(e){return N(this,null,(function*(){const t=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[t].dataForm.collection=this.editorList[e].getValue();const i={thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}))},handleCloseCollecttion(e){this.$confirm("确认关闭？").then(t=>{e()}).catch(e=>{})},onReductionTap(e){const t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema(){this.schemadialogVisible=!0,Object(T["setTimeout"])(()=>{a=ace.edit("editor1"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.setValue(JSON.stringify(this.productdetail.thing,null,4))},1)},query_notification(){return N(this,null,(function*(){let e={count:"objectId",where:{key:{$regex:this.$route.query.id},type:{$regex:"notification"}}};this.$route.query.id&&(e.where.key={$regex:this.$route.query.id});const{results:t,count:i=0}=yield Object(D["queryView"])(e);this.amisShow=i>0,this.amisproductInfo=t}))},getProDetail(){this.query_notification(),s=ace.edit("editor"),s.session.setMode("ace/mode/erlang"),s.setTheme("ace/theme/monokai"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.FromMachine=[{name:"ALL"}],this.$get_object("Product",this.productId).then(e=>{if(I["dgiotlog"].log("response",e),e){for(var t in this.productInfo=_.merge(e,{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}}),this.productName=e.name,e)this.productdetail[t]=e[t];this.option.map(e=>{this.productdetail.category==e.value&&(this.productdetail.category=e.label)}),this.productdetail.createdAt=this.utc2beijing(e.createdAt),this.productdetail.id=e.id,this.dynamicReg=e.dynamicReg,this.productdetail.isshow=0,this.productdetail.category&&this.$get_object("Category",this.productdetail.category.objectId).then(e=>{I["dgiotlog"].log("catcat",e),this.$set(this.productdetail,"categoryname",e.name)}),this.form.Productname=e.name,this.ProductSecret=e.productSecret,this.form.Productkey=this.productId,this.productimg=e.icon,e.decoder?(B=e.decoder.code,this.formInline.name=e.decoder.name,this.formInline.version=e.decoder.version,this.formInline.desc=e.decoder.desc):B="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=this.productdetail.thing&&"{}"!=JSON.stringify(this.productdetail.thing)||(this.productdetail.thing={properties:[]}),I["dgiotlog"].log("=====",this.wmxData),this.wmxData=[],this.wmxDataBk=[],this.wmxData=this.productdetail.thing.properties.filter((e,t)=>(e.index=t,e.name&&e.dataType)),this.wmxDataBk=this.productdetail.thing.properties,I["dgiotlog"].log("=====",this.wmxData),this.wmxDataBk.forEach(e=>{if(e.devicetype){let t={name:e.devicetype};this.FromMachine.push(t)}}),this.FromMachine=_.uniqBy(this.FromMachine,"name"),s.setValue(z.decode(B)),s.gotoLine(s.session.getLength())}}).catch(e=>{I["dgiotlog"].log("err",e),this.$baseMessage("请求出错",e.error,3e3)})},queryDeviceCount(e){return N(this,null,(function*(){this.form.ProductAll=yield Object(p["getDeviceCountByProduct"])(e)}))},handelUpdate(e,t){return N(this,null,(function*(){var t;t=1!=e,this.dynamicReg=t;const i={dynamicReg:!t};yield Object(m["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"修改成功"}),this.dynamicReg=!t}))},wmxhandleClose(e){return N(this,null,(function*(){this.wmxSituation="新增",e?(this.wmxdialogVisible=!1,this.$refs["sizeForm"].$refs["sizeForm"].resetFields(),this.$refs["sizeForm"].$refs["sizeForm"].clearValidate(),this.setSizeForm(this.getFormOrginalData()),this.$refs["sizeForm"].resource.disabled=!1,yield this.handleChildClick(this.tabsChild),this.$refs["sizeForm"]&&(yield this.$refs["sizeForm"].queryResource())):this.wmxdialogVisible=!1}))},protol(){var e="";Object($["Compile"])(z.encode(s.getValue())).then(t=>{t&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"编译成功"}),e="编译成功"+t.mod+"\r\n",this.warningeditror=t.warnings,this.warningeditror.map(t=>{e+=t+"\r\n"}),M+=e,r.setValue(M))}).catch(t=>{this.warningeditror=t.error,this.warningeditror.map(t=>{e+=t+"\r\n"}),M+=e,r.setValue(M)})},decoderSizeChange(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata(e){this.$del_object("Dict",e).then(e=>{e&&(this.$message("成功删除"),this.chaxun())}).catch(e=>{I["dgiotlog"].log(e)})},subAce(e,t){this.$refs[e].validate(e=>N(this,null,(function*(){if(e){var i={name:this.formInline.name,version:this.formInline.version,code:z.encode(s.getValue()),desc:this.formInline.desc};const e={decoder:i};yield Object(m["putProduct"])(this.productId,e),0==this.issub&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"保存成功"}),1==t&&(M+="保存成功",r.setValue(M))),this.issub=!0}else this.$message({type:"warning",message:"输入格式有误"})})))},subAce1(e){this.$refs[e].validate(e=>{if(e){const e={where:{"data.name":this.formInline.name,"data.version":this.formInline.version}};this.$query_object("Dict",e).then(e=>{e.results&&e.results.length>=1?this.$message("此协议版本已存在"):this.$get_object("Product",this.productId).then(e=>{if(e){var t={name:this.formInline.name,version:this.formInline.version,code:z.encode(s.getValue()),desc:this.formInline.desc};const i={key:this.formInline.name+":"+this.formInline.version,type:"decoder",data:t,ACL:e.ACL};this.$create_object("Dict",i).then(e=>{e.error?this.$message({type:"error",message:e.error}):this.$message({showClose:!0,duration:2e3,type:"success",message:"保存到公共协议库成功"})}).catch(e=>{I["dgiotlog"].log(e)})}})}).catch(e=>{I["dgiotlog"].log(e)})}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"输入格式有误"})})},updatesub(e){Object($["subupadte"])(e.objectId,"update").then(e=>{e&&this.$message("重载成功")}).catch(e=>{this.$message(e.error)})},chaxun(){const e={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",e).then(e=>{e&&(this.decodertotal=e.count,this.gridData=e.results)}).catch(e=>{I["dgiotlog"].log(e)})},editordata(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,s.setValue(z.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory(){this.originwmx=!0,this.getPropData()},addMachine(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine(e,t,i){"ALL"==e.name?(this.wmxDataBk.forEach(e=>{e.dataType||(e.dataType={das:[],specs:{},type:"float",identification:"function"})}),this.wmxData=this.wmxDataBk):(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter(t=>t.devicetype==e.name&&!t.dataType.identification),this.wmxstart=1),this.upKey=moment.now(),console.log(this.wmxData," this.wmxData ")},handleChange(e,t,i){},TypeInstall(e,t){t.map((t,i)=>{if("enum"==t.DataType||"bool"==t.DataType){var s={dataType:{specs:{}}};s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{for(var t in e){var i=e["value"],a=e["name"];s.dataType.specs[i]=a}}),e.push(s)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){s={dataType:{specs:{}}};for(var a in s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))s.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],s.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],s.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],s.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(s)}else if("struct"==t.DataType){var r={dataType:{specs:[]}};r.name=t.Name,r.dataType.type=t.DataType,r.required=!t.Required,r.identifier=t.Identifier,r.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map(e=>{for(var i in e){var s=e["value"],a=e["name"];t.dataType.specs[s]=a}}),r.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var i in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];r.dataType.specs.push(t)}}),e.push(r)}});var i={};e=e.reduce((e,t)=>(!i[t.identifier]&&(i[t.identifier]=e.push(t)),e),[])},addProCategory(e){const t={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",t).then(e=>N(this,null,(function*(){const t=e.results;if(t&&t[0].data.Ability){this.TypeInstall(this.productdetail.thing.properties,t[0].data.Ability);const e={thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,e),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}else I["dgiotlog"].log("此选项没有属性功能")})))},deletewmx(e){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),this.$translateTitle("Maintenance.Delete reminder"),()=>N(this,null,(function*(){const t={productid:this.productId,item:e},i=yield Object(m["deleteThing"])(t);200==i.code?(this.$baseMessage(this.$translateTitle("user.successfully deleted"),"success","dgiot-hey-message-success"),yield this.getProDetail(),yield this.queryProductInfo(this.$route.query.id)):this.$baseMessage(this.$translateTitle("user.error deleted")+(null==i?void 0:i.msg)?i.msg:i,"error","dgiot-hey-message-error")})))},wmxSizeChange(e){console.log(this.wmxData),this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange(e){console.log(this.wmxData),this.wmxstart=e},eventsChange(e){this.eventsStart=1,this.eventsPageSize=e},eventsCurrentChange(e){this.eventsStart=e},serverSizeChange(e){this.servicesStart=1,this.servicesPageSize=e},serverCurrentChange(e){this.servicesStart=e},tagsSizeChange(e){this.tagsStart=1,this.tagsPageSize=e},tagsCurrentChange(e){this.eventsStart=e},nowtime(){var e=Date.parse(new Date),t=new Date(e),i=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",a=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+" "},subProTopic(e){return N(this,null,(function*(){this.channelid=e.objectId,this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.mqtt.subtopic="$dg/user/channel/"+e.objectId+"/#";this.mqtt.router,this.mqtt.subtopic;this.$dgiotBus.$off(this.$mqttInfo.topicKey),yield this.$subscribe(this.subtopic),Object($["subupadte"])(e.objectId,"start_logger"),this.submessage="",this.msgList=[],this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{this.mqttMsg(e.payloadString)})}))},mqttMsg(e){console.error(e),this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},handleCloseSubdialog(){Object($["subupadte"])(this.channelid,"stop_logger"),this.msgList=[],this.submessage=[],this.subdialog=!1},stopsub(e){},subTopic(e,t){this.$refs[e].validate(i=>N(this,null,(function*(){if(console.log(this.topicDefault,t),!i)return I["dgiotlog"].log("error submit!!"),!1;{let i="";-1!=t?(this.topicDefault[this.topicform.id]=this.topicform.value,i="修改topic成功"):(this.topicDefault[this.topicform.topic]=this.topicform.value,i="添加自定义topic成功"),console.log(this.topicDefault),yield Object(m["putProduct"])(this.productId,{topics:this.topicDefault}),this.$message({showClose:!0,duration:2e3,type:"success",message:i}),this.topicform={isupdated:-1,value:"",info:"basic"},this.handleClick({name:"second"}),this.topicdialogVisible=!1,this.$refs[e].resetFields()}})))},topicSizeChange(e){this.topicstart=1,this.topiclength=e},topicCurrentChange(e){this.topicstart=e},updatetopic(e,t){console.log(e),this.topicform=e,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic(e,t,i){this.$baseConfirm("你确定要删除当前项topic吗",null,()=>N(this,null,(function*(){const t={};e.splice(i,1),e.forEach(e=>{t[e.id]=e.value}),console.log(this.topicDefault),yield Object(m["putProduct"])(this.productId,{topics:t}),this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"})})))},orginRule(){Object(y["getRule"])().then(e=>{e&&(this.engineData=e)}).catch(e=>{this.$message(e.error)})},handleSizeChange(e){},handleCurrentChange(e){},addEngine(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions(e){var t=[];return e.map(e=>{t.push(e.name)}),t.join(",")},getRowindex(e,t,i){if(0==e.columnIndex)return"firstcolumn"},detailRules(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})}},d007:function(e,t,i){},de50:function(e,t,i){"use strict";i("835f")},e701:function(e,t,i){},ed75:function(e,t,i){"use strict";i.r(t);var s,a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"equipment"},[i("div",{staticClass:"equ_header"},[i("ul",[i("li",[i("p",[i("span",{staticClass:"svg-container"},[i("dgiot-icon",{attrs:{icon:"device-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.totalequipment"))+" "),i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalequipment"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1),i("span",[e._v(e._s(e.devicetotal))])]),i("li",[i("p",[i("span",{staticClass:"svg-container"},[i("dgiot-icon",{attrs:{icon:"numbers-line"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.activationdevice"))+" "),i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalactive"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1),i("span",[e._v(e._s(e.activeall))])]),i("li",[i("p",[i("span",{staticClass:"svg-container"},[i("dgiot-icon",{attrs:{icon:"contrast-drop-fill"}})],1),e._v(" "+e._s(e.$translateTitle("equipment.onlinedevices"))+" "),i("el-tooltip",{attrs:{content:e.$translateTitle("equipment.totalonline"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1),i("span",[e._v(e._s(e.onlineall))])]),i("li",[i("div",{staticClass:"block"},[e.productimg?i("el-image",{staticStyle:{position:"relative",top:"-55px",width:"250px",height:"200px","line-height":"200px","text-align":"center"},attrs:{src:e.productimg}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("i",{staticClass:"el-icon-picture-outline"})])]):e._e()],1)])])]),i("div",{staticClass:"equtabs"},[i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:e.$translateTitle("route.设备管理"),name:"first"}},[i("div",[i("div",[i("el-button",{attrs:{size:"small"}},[e._v(" "+e._s(e.$translateTitle("equipment.batchaddition"))+" ")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addDeviceForm}},[e._v(" "+e._s(e.$translateTitle("equipment.adddevice"))+" ")])],1)]),i("div",{staticClass:"equdevices",staticStyle:{"margin-top":"20px"}},[i("el-select",{staticClass:"selectdetail",attrs:{size:"small"},model:{value:e.selectdevice,callback:function(t){e.selectdevice=t},expression:"selectdevice"}},[i("el-option",{attrs:{value:e.$translateTitle("equipment.devicename")}}),i("el-option",{attrs:{value:e.$translateTitle("equipment.devicenumber")}})],1),e.selectdevice==e.$translateTitle("equipment.devicename")?i("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterproductname"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}):i("el-input",{staticClass:"selectdetail",attrs:{placeholder:e.$translateTitle("equipment.enterdevicenumber"),size:"small"},model:{value:e.deviceinput,callback:function(t){e.deviceinput=t},expression:"deviceinput"}}),i("el-button",{staticClass:"selectdetail",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getDevices(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.search"))+" ")]),i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:e.deleteDevcie}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.prohibit"))+" ")]),i("el-button",{staticClass:"selectdetail",attrs:{disabled:0==e.multipleTable.length,size:"small",type:"primary"},on:{click:function(t){return e.unactiveDevice(!0)}}},[e._v(" "+e._s(e.$translateTitle("developer.enable"))+" ")])],1),i("div",{staticClass:"tabstable"},[i("el-table",{ref:"filterTable",staticStyle:{width:"100%","margin-top":"20px","text-align":"center"},attrs:{data:e.tableData,"row-style":e.rowClass},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber")+"/"+e.$translateTitle("equipment.name"),prop:"name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.name))]),i("p",{staticStyle:{margin:"0",color:"green"}},[e._v(" "+e._s(s.devaddr)+" ")])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.state"),prop:"status","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return["ONLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.online"))+" ")]):e._e(),"ONLINE"==s.status?i("el-tooltip",{attrs:{content:"设备已经上线",placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"==s.status?i("span",{class:s.status},[e._v(" "+e._s(e.$translateTitle("product.offline"))+" ")]):e._e(),"OFFLINE"==s.status?i("el-tooltip",{attrs:{content:"设备已经离线",placement:"top"}},[i("i",{staticClass:"el-icon-question"})]):e._e(),"OFFLINE"!=s.status&&"ONLINE"!=s.status?i("span",{class:s.status},[e._v(" 未注册 ")]):e._e()]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.product"),prop:"product.name","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.product.name))])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.nodetype"),prop:"product.nodeType","show-overflow-tooltip":"",sortable:"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[i("dgiot-icon",{staticStyle:{width:"2rem",height:"2rem"},attrs:{icon:0==t.nodeType?"hotel-bed-fill":"hotel-fill"}})]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.enable")+"/"+e.$translateTitle("developer.prohibit"),prop:"enable","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,a=t.$index;return[i("el-switch",{attrs:{"active-color":"#5eb058","inactive-color":"#cccccc"},on:{change:function(t){return e.handelUpdate(t,a)}},model:{value:s.isEnable,callback:function(t){e.$set(s,"isEnable",t)},expression:"row.isEnable"}})]}}])}),i("el-table-column",{attrs:{label:"创建时间",prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("developer.operation"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row,a=t.$index;return[i("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.editorDevice(s)}}},[e._v(" 编辑 ")]),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.makeSure(s,a)}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")])]}}])})],1),i("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[i("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":e.devicelength,"page-sizes":[10,20,30,50],total:e.devicetotal},on:{"current-change":e.deviceCurrentChange,"size-change":e.deviceSizeChange}})],1)],1)]),i("el-tab-pane",{attrs:{label:e.$translateTitle("equipment.batchmanagement"),name:"second"}},[i("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData}},[i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"200"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.data.batch_name))])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(s,s.objectId)}}},[e._v(" 编辑 ")]),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(s.objectId)}}},[e._v(" 删除 ")]),i("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(s,s.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)],1),i("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:"设备"+e.equipmentEditor,visible:e.devicedialogVisible,width:"50%"},on:{"update:visible":function(t){e.devicedialogVisible=t}}},[i("div",{staticClass:"header-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"title-name"},[e._v(" "+e._s("设备"+e.equipmentEditor)+" "),i("el-tooltip",{staticStyle:{"margin-left":"5px"},attrs:{content:e.$translateTitle("equipment.text"),placement:"top"}},[i("i",{staticClass:"el-icon-question"})])],1)]),i("div",{staticClass:"devicecontent"},[i("el-form",{ref:"deviceform",attrs:{"label-width":"150px",model:e.deviceform,rules:e.rules}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicename"),prop:"name"}},[i("el-input",{model:{value:e.deviceform.name,callback:function(t){e.$set(e.deviceform,"name",t)},expression:"deviceform.name"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr"}},[i("el-input",{model:{value:e.deviceform.devaddr,callback:function(t){e.$set(e.deviceform,"devaddr",t)},expression:"deviceform.devaddr"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"batchId"}},[i("el-input",{attrs:{disabled:""},model:{value:e.deviceform.batchId,callback:function(t){e.$set(e.deviceform,"batchId",t)},expression:"deviceform.batchId"}},[i("i",{staticClass:"el-icon-plus",attrs:{slot:"suffix"},on:{click:e.addDeviceBatch},slot:"suffix"})])],1),i("el-form-item",{attrs:{label:e.$translateTitle("product.productname"),prop:"productName"}},[i("el-input",{attrs:{readonly:""},model:{value:e.deviceform.productName,callback:function(t){e.$set(e.deviceform,"productName",t)},expression:"deviceform.productName"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.assetnumber")}},[i("el-input",{model:{value:e.deviceform.assetNum,callback:function(t){e.$set(e.deviceform,"assetNum",t)},expression:"deviceform.assetNum"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmenttype")}},[i("el-input",{model:{value:e.deviceform.devModel,callback:function(t){e.$set(e.deviceform,"devModel",t)},expression:"deviceform.devModel"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.equipmentbrand")}},[i("el-input",{model:{value:e.deviceform.brand,callback:function(t){e.$set(e.deviceform,"brand",t)},expression:"deviceform.brand"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.installationlocation")}},[i("el-input",{on:{focus:e.updateLocation},model:{value:e.deviceform.address,callback:function(t){e.$set(e.deviceform,"address",t)},expression:"deviceform.address"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("developer.describe")}},[i("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},model:{value:e.deviceform.desc,callback:function(t){e.$set(e.deviceform,"desc",t)},expression:"deviceform.desc"}})],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("deviceform")}}},[e._v(" "+e._s(e.$translateTitle("developer.determine"))+" ")]),i("el-button",{on:{click:e.handleClose}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")])],1)]),i("el-dialog",{attrs:{"append-to-body":!0,"before-close":e.handleClose1,"close-on-click-modal":!1,title:"批次添加",visible:e.pcdialogVisible,width:"50%"},on:{"update:visible":function(t){e.pcdialogVisible=t}}},[i("div",{staticClass:"pccontent"},[i("el-form",{ref:"pcformInline",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.pcformInline,rules:e.pcformrule}},[i("el-form-item",{attrs:{label:e.$translateTitle("equipment.batchname"),prop:"pcname"}},[i("el-input",{attrs:{placeholder:e.$translateTitle("equipment.batchname"),width:"100%"},model:{value:e.pcformInline.pcname,callback:function(t){e.$set(e.pcformInline,"pcname",t)},expression:"pcformInline.pcname"}})],1),i("el-form-item",{attrs:{label:e.$translateTitle("equipment.createdAt"),prop:"createdtime"}},[i("el-date-picker",{attrs:{type:"datetime",width:"100%"},model:{value:e.pcformInline.createdtime,callback:function(t){e.$set(e.pcformInline,"createdtime",t)},expression:"pcformInline.createdtime"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addbatch("pcformInline")}}},[e._v(" "+e._s(e.$translateTitle("equipment.addbatch"))+" ")])],1)],1),i("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.pctableData,height:"450"}},[i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.serialnumber"),type:"index",width:"50"}}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.batchname"),prop:"data.batch_name","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(s.data.batch_name))])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),prop:"createdAt","show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",[e._v(e._s(e.utc2beijing(s.createdAt)))])]}}])}),i("el-table-column",{attrs:{align:"center",label:e.$translateTitle("developer.operation"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.updatebatch(s,s.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.edit"))+" ")]),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deletebatch(s.objectId)}}},[e._v(" "+e._s(e.$translateTitle("developer.delete"))+" ")]),i("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.selectbatch(s,s.objectId)}}},[e._v(" 选择 ")])]}}])})],1)],1)]),i("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{"append-to-body":!0,"before-close":e.handleClosebmap,"close-on-click-modal":!1,title:"设备安装地址",visible:e.bmapdialogVisible,width:"50%"},on:{"update:visible":function(t){e.bmapdialogVisible=t}}},[i("div",[i("el-form",{attrs:{inline:!0,model:e.bmapform,size:"small"}},[i("el-form-item",{attrs:{label:"地址名称"}},[i("el-input",{model:{value:e.bmapform.keyword,callback:function(t){e.$set(e.bmapform,"keyword",t)},expression:"bmapform.keyword"}})],1),i("el-form-item",{attrs:{label:"选中地址"}},[i("el-input",{attrs:{readonly:""},model:{value:e.bmapform.address,callback:function(t){e.$set(e.bmapform,"address",t)},expression:"bmapform.address"}})],1)],1),i("baidu-map",{staticStyle:{height:"300px"},attrs:{ak:e.secret.baidu.map,center:e.center,"map-click":!1,"scroll-wheel-zoom":!0,zoom:e.zoom},on:{click:e.mapClick,ready:e.handler}},[i("bm-local-search",{staticStyle:{display:"none"},attrs:{"auto-viewport":!0,keyword:e.bmapform.keyword,location:e.bmapform.location,zoom:"12.8"}}),i("bm-navigation",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),i("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT","auto-location":!0,"show-address-bar":!0}}),i("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.addressSure.apply(null,arguments)}}},[e._v(" 保 存 ")]),i("el-button",{on:{click:function(t){e.bmapdialogVisible=!1}}},[e._v("取 消")])],1)])],1)])},r=[],o=i("4be7"),n=i("dcc6"),l=i("e0e9"),d=i("5880"),c=i("cb88"),u=i("7212"),h=i("926a"),p=i("14ba"),m=Object.defineProperty,g=Object.getOwnPropertySymbols,b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,y=(e,t,i)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t)=>{for(var i in t||(t={}))b.call(t,i)&&y(e,i,t[i]);if(g)for(var i of g(t))v.call(t,i)&&y(e,i,t[i]);return e},$=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),T={components:{BmNavigation:c["BmNavigation"],BaiduMap:c["BaiduMap"],BmLocalSearch:c["BmLocalSearch"],BmGeolocation:c["BmGeolocation"],BmCityList:c["BmCityList"]},data(){const e=function(e,t,i){var s=/[0-9A-Za-z]$/;""==t?i(new Error("安装位置不能为空")):s.test(t)?i():i(new Error("安装位置必须为大小写字母数字"))};return{secret:p["secret"],productimg:"",bmapdialogVisible:!1,onlineall:"",activeall:"",userId:"",batchid:"",pcdialogVisible:!1,devicedialogVisible:!1,equvalue:"0",cities:[],activeName:"first",selectdevice:"",deviceinput:"",devicenumber:"",multipleTable:[],selectRow:[],devicelength:10,devicestart:0,devicetotal:0,visible2:!1,deviceform:{name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",productName:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:"09"},yysSelect:[],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],devaddr:[{required:!0,message:"请输入设备编号",trigger:"blur"},{validator:e}],batchId:[{required:!0,message:"请输入设备批次",trigger:"blur"}],nodeType:[{required:!0,message:"请输入设备类型",trigger:"blur"}],netType:[{required:!0,message:"请选择网络格式",trigger:"change"}],devType:[{required:!0,message:"请选择设备类型",trigger:"change"}],productName:[{required:!0,message:"请选择产品名称",trigger:"change"}]},aclObj:{},pcformrule:{pcname:[{required:!0,message:"请输入批次名称",trigger:"blur"}],createdtime:[{type:"date",required:!0,message:"请选择创建时间",trigger:"change"}]},pcformInline:{pcnumber:"",pcname:"",createdtime:""},pctableData:[],equipmentEditor:"添加",tableData:[],proTableData:[],proTableData1:[],activelength:[],onlinelength:[],center:{lng:0,lat:0},zoom:13,bmapform:{keyword:"",location:"",address:""},productName:"",deviceid:"",map:null,addresspointer:"",productenable:!0,changeproduct:!0,tagsid:"",productroleslist:[]}},computed:f({},Object(d["mapGetters"])({_role:"acl/role"})),watch:{multipleTable(e){this.selectRow=[],e.length>0&&e.forEach((e,t)=>{this.selectRow.push(this.tableData.indexOf(e))})}},mounted(){this.getDevices(0),this.addDeviceBatch(0),this.queryYysId(),this.$route.query.productid&&(this.equvalue=this.$route.query.productid,this.searchProduct(this.equvalue)),this.aclObj=this.$aclObj(this._role)},methods:{queryYysId(){return $(this,null,(function*(){const e={order:"-createdAt",limit:100,skip:0,where:{type:"b83b5d9fc0"}};Object(l["queryDict"])(e).then(e=>{this.yysSelect=[{name:"空",key:""}],e.results.map(e=>{this.yysSelect.push(e.data)})})}))},rolesSelect(e){this.productroleslist=[],this.$queryProduct({}).then(e=>{if(e)for(var t in e.results[0].ACL)t.includes("role")&&this.productroleslist.push(t.substr(5))},e=>{Object(h["returnLogin"])(e)})},goEdit(e){var t=window.location.origin+"/spa";const{NODE_ENV:i}=Object({NODE_ENV:"production",VUE_APP_TITLE:"物联网开发平台",VUE_APP_AUTHOR:"iotn2n",VUE_APP_UPDATE_TIME:"2022年06月10日17时30分07秒",VUE_APP_VERSION:"4.5.5",VUE_APP_Keywords:"一站式物联网PaaS平台|物联网应用服务",VUE_APP_Description:"提供物联网垂直领域应用使能平台及解决方案",VUE_APP_URL:"http://127.0.0.1:5080",VUE_APP_CDN_URL:"/dgiot_dashboard/public",BASE_URL:""});t="development"==i?this.$globalConfig.localTopoUrl:window.location.origin+"/spa";var s=`${t}/#?devaddr=${e.devaddr}&proudctid=${e.productid}`;window.open(s,"__blank"),localStorage.setItem("topoData",JSON.stringify(e.config))},addressSure(){var e=new BMap.LocalSearch(this.map);e.enableAutoViewport();""==this.bmapform.address&&(this.deviceform.address=this.bmapform.keyword),e.search(this.bmapform.keyword),this.bmapdialogVisible=!1},handler({BMap:e,map:t}){this.center.lng=120.2,this.center.lat=30.26667,this.zoom=this.zoom,this.map=t},mapClick(e){this.center.lng=e.point.lng,this.center.lat=e.point.lat,this.addresspointer=e.point.lng.toFixed(6)+","+e.point.lat.toFixed(6);const t=new BMap.Geocoder;t.getLocation(e.point,e=>{this.bmapform.address=e.address,this.deviceform.address=e.address})},updateLocation(){this.bmapdialogVisible=!0},handleClosebmap(){this.bmapdialogVisible=!1},getOnlineDevices(){return $(this,null,(function*(){var e={where:{status:"ONLINE"}};""!=this.deviceinput&&("设备名称"==this.selectdevice?e.where.name=this.deviceinput:e.where.devaddr=this.deviceinput),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&(e.where.product=this.equvalue);var t=yield this.$queryDevice(e);this.onlineall=t.results.length}))},getActiveDevices(){return $(this,null,(function*(){var e={where:{status:"ACTIVE"}};""!=this.deviceinput&&("设备名称"==this.selectdevice||"Device Name"==this.selectdevice?e.where.name=this.deviceinput:e.where.devaddr=this.deviceinput),""!=this.devicenumber&&(e.where.devaddr=this.devicenumber),0!=this.equvalue&&(e.where.product=this.equvalue);var t=yield this.$queryDevice(e);this.activeall=t.results.length}))},searchProduct(){return $(this,null,(function*(){Object(u["getProduct"])(this.equvalue).then(e=>{this.deviceform.productName=e.name,this.productName=e.name})}))},getDevices(e){return $(this,null,(function*(){0===e&&(this.devicestart=0),this.tableData=[];var t={order:"-updatedAt",limit:this.devicelength,skip:this.devicestart,count:"objectId",include:"product",where:{product:this.$route.query.productid}};""!=this.deviceinput&&("设备名称"==this.selectdevice?params.where.name=this.deviceinput:params.where.devaddr=this.deviceinput),""!=this.devicenumber&&(params.where.devaddr=this.devicenumber);const i=yield this.$queryDevice(t);this.devicetotal=i.count,this.tableData=i.results,this.getActiveDevices(),this.getOnlineDevices()}))},handelUpdate(e,t,i){dgiotlog.log("row",t);var s={};for(var a in t)s[a]=t[a];s.isEnable=1!=s.isEnable,this.tableData[i]=s,this.$confirm("是否修改此设备状态?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e={};for(var i in t)e[i]=t[i];e.isEnable=1==e.isEnable;var s={isEnable:e.isEnable};dgiotlog.log("row",t),this.$putDevice(t.objectId,s).then(e=>{e.error?this.initQuery("状态修改失败","error"):(this.initQuery("状态修改成功","success"),this.getDevices())})}).catch(()=>{this.$message({type:"info",message:"已取消修改",showClose:!0,duration:2e3});const e=t;e.isEnable=1!=e.isEnable,this.tableData[i]=e})},timestampToTime(e){var t=new Date(1e3*e),i=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",a=(t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ",r=(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":",o=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",n=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+r+o+n},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},filterTag(e,t){return t.tag===e},handleSelectionChange(e){this.multipleTable=e,dgiotlog.log(this.multipleTable)},deleteDevcie(e){return $(this,null,(function*(){const e=[];this.multipleTable.map(t=>{e.push(t.id)}),yield Object(n["Batchdelete"])("_Device",e,{}).then(t=>{t.error?this.initQuery(`设备${e}删除失败`,"error"):this.initQuery(`设备${e}删除成功`,"success")})}))},unactiveDevice(e){return $(this,null,(function*(){const t=[];this.multipleTable.map(e=>{t.push(e.id)});const i={isEnable:e};yield Object(n["Batchdelete"])("_Device",t,i).then(i=>{i.error?e?this.initQuery(`设备${t}启动失败`,"error"):this.initQuery(`设备${t}禁用失败`,"error"):e?this.initQuery(`设备${t}启动成功`,"success"):this.initQuery(`设备${t}禁用成功`,"success")})}))},rowClass({row:e,rowIndex:t}){if(this.selectRow.includes(t))return{"background-color":"rgba(185, 221, 249, 0.3)"}},initQuery(e,t){this.$message({type:t||"info",message:e,showClose:!0,duration:2e3})},deviceSizeChange(e){this.devicelength=e,this.getDevices()},deviceCurrentChange(e){this.devicestart=(e-1)*this.devicelength,this.getDevices()},handleClose(){this.deviceid="",this.deviceform={name:"",devaddr:"",batchId:"",desc:"",nodeType:0,devType:"",netType:"",assetNum:"",devModel:"",address:"",status:"",isEnable:"",brand:"",auth:12345678,yysId:""},this.$refs["deviceform"].resetFields(),this.deviceform.productName=this.productName,this.devicedialogVisible=!1,this.equipmentEditor="添加"},addDeviceForm(){this.deviceid="",this.devicedialogVisible=!0,this.equipmentEditor="添加"},handleClose1(){this.pcdialogVisible=!1,this.batchid="",this.pcformInline={pcname:"",createdtime:""}},makeSure(e,t){this.$deleteDevice(e.objectId).then(e=>{e.error?this.initQuery("删除失败","error"):(this.initQuery("删除成功","success"),this.tableData.splice(t,1))})},addDeviceBatch(e){return $(this,null,(function*(){this.pcdialogVisible=0!=e;const{results:t}=yield Object(l["getBatchNumer"])();this.pctableData=t.filter(e=>e.data.batch_name)}))},editorDevice(e){dgiotlog.log("row",e),this.deviceid=e.objectId,this.devicedialogVisible=!0,this.deviceform={devaddr:e.devaddr,name:e.name,assetNum:void 0==e.detail?"":e.detail.assetNum,devModel:void 0==e.detail?"":e.detail.devModel,desc:void 0==e.detail?"":e.detail.desc,productid:e.product.objectId,brand:void 0==e.detail?"":e.detail.brand,productName:e.product.name,status:e.status,isEnable:e.isEnable,address:void 0==e.detail?"":e.detail.address,auth:e.basedata&&e.basedata.auth?e.basedata.auth:"",yysId:e.basedata&&e.basedata.yysId?e.basedata.yysId:""},this.bmapform.address=e.address,this.batchid=e.detail.batchid,this.center.lat=e.latitude,this.center.lng=e.longitude,this.addresspointer=e.latitude+","+e.longitude,this.tagsid=e.tagid,this.equipmentEditor="编辑",this.rolesSelect(e.productid)},getBatch(){return new o["Promise"]((e,t)=>{s.length>0?e(s):t(!1)})},submitForm(e){var t={devaddr:this.deviceform.devaddr,name:this.deviceform.name};this.$refs[e].validate(e=>{if(e)if(""!=this.deviceid){var i={where:{devaddr:this.deviceform.devaddr}};this.$queryDevice(i).then(e=>{if(0==e.results.length){var s={ACL:this.aclObj,detail:{assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.deviceform.address,desc:this.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:this.$route.query.productid},basedata:{auth:this.deviceform.auth,yysId:this.deviceform.yysId}};i=Object.assign(t,s),this.$putDevice(this.deviceid,i).then(e=>{e.error?this.initQuery("修改失败","error"):(this.initQuery("修改成功","success"),this.devicedialogVisible=!1,this.getDevices(),this.deviceform={},this.deviceform.productName=this.productName)})}else this.initQuery("设备已经存在","error")})}else{i={where:{devaddr:this.deviceform.devaddr}};this.$queryDevice(i).then(e=>{if(0==e.results.length){var s={ACL:this.aclObj,detail:{assetNum:this.deviceform.assetNum,devModel:this.deviceform.devModel,brand:this.deviceform.brand,address:this.deviceform.address,desc:this.deviceform.desc},product:{__type:"Pointer",className:"Product",objectId:this.$route.query.productid},basedata:{auth:this.deviceform.auth,yysId:this.deviceform.yysId}};i=Object.assign(t,s),this.$postDevice(i).then(e=>{e.error?this.initQuery("创建失败","error"):(this.initQuery("创建成功","success"),this.devicedialogVisible=!1,this.getDevices(),this.deviceform={},this.deviceform.productName=this.productName)})}else this.initQuery("设备已经存在","error")})}else this.$message("必填项未填")})},addbatch(e){return $(this,null,(function*(){this.$refs[e].validate(t=>{if(!t)return dgiotlog.log("error submit!!"),!1;if(""===this.batchid){const t={data:{batch_name:this.pcformInline.pcname,createdtime:Math.ceil(this.pcformInline.createdtime/1e3)},ACL:this.aclObj,key:this.pcformInline.pcname,type:"batch_number"};this.$postDict(t).then(t=>{t.error?this.$message({message:"新增失败"+t.error,showClose:!0,duration:2e3,type:"error"}):(this.$message({message:"新增成功",showClose:!0,duration:2e3,type:"success"}),this.$refs[e].resetFields(),this.addDeviceBatch())})}else{const t={objectId:this.batchid,data:{batch_name:this.pcformInline.pcname,createdtime:Math.ceil(this.pcformInline.createdtime/1e3)},ACL:this.aclObj,type:"batch_number"};this.$putDict(t.objectId,t).then(t=>{t.error?this.initQuery("修改失败","error"):(this.initQuery("修改成功","success"),this.batchid="",this.pcformInline={pcname:"",createdtime:""},this.$refs[e].resetFields(),this.addDeviceBatch())})}})}))},updatebatch(e,t){this.pcformInline.pcname=e.data.batch_name,this.pcformInline.createdtime=1e3*e.data.createdtime,this.batchid=t},deletebatch(e){return $(this,null,(function*(){try{const t=yield Object(l["delDict"])(e);dgiotlog.log(t),this.queryDict(),this.addDeviceBatch()}catch(error){dgiotlog.log(error),this.$baseMessage(error,"error","dgiot-hey-message-error")}}))},selectbatch(e,t){this.batchid=t,this.deviceform.pc=e.data.batch_name,this.deviceform.batchId=e.data.batch_name,this.pcdialogVisible=!1,dgiotlog.log(this.batchid,"this.batchid ")},deviceToDetail(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"false"}})},handleClick(e,t){"second"==e.name&&this.queryDict()},queryDict(){return $(this,null,(function*(){const{results:e}=yield this.$getBatchNumer();this.pctableData=e.filter(e=>e.data.batch_name)}))},deviceToChildren(e){this.$router.push({path:"/roles/editdevices",query:{deviceid:e.objectId,nodeType:e.nodeType,ischildren:"true"}})}}},w=T,C=(i("074c"),i("de50"),i("2877")),I=Object(C["a"])(w,a,r,!1,null,"5cec037a",null);t["default"]=I.exports},efed:function(e,t,i){},fe51:function(e,t,i){"use strict";var s,a,r,o,n,l,d=i("4351"),c=i("40d1"),u=i("22f9"),h=i("5880"),p=i("1285"),m=i("7212"),g=i("89e8"),b=i("1267"),v=i("e0e9"),y=i("1b07"),f=i("ef68"),$=i("bb22"),T=i("5118"),w=i("aed5"),C=i("30b0"),I=i("4013"),D=i("8ba7"),j=i("0c3c"),F=i("62b6"),S=Object.defineProperty,A=Object.defineProperties,k=Object.getOwnPropertyDescriptors,x=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,P=(e,t,i)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,L=(e,t)=>{for(var i in t||(t={}))q.call(t,i)&&P(e,i,t[i]);if(x)for(var i of x(t))O.call(t,i)&&P(e,i,t[i]);return e},E=(e,t)=>A(e,k(t)),N=(e,t,i)=>new Promise((s,a)=>{var r=e=>{try{n(i.next(e))}catch(t){a(t)}},o=e=>{try{n(i.throw(e))}catch(t){a(t)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);n((i=i.apply(e,t)).next())}),G={};const z=i("f43e").Base64;var B="",M="",V={components:{mqttLog:d["default"],dgiotViews:j["default"],"dgiot-wmx":w["default"],"dgiot-profile":C["default"],"thing-form":c["default"]},data(){const e=(e,t,i)=>{const s=/[0-9a-zA-Z]/;s.test(t)?i():i(new Error("协议名称由数字和字母组合"))},t=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.sizeForm.endnumber&&(t>=this.sizeForm.endnumber?i(new Error("最小值小于最大值")):i())},i=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.sizeForm.startnumber&&(t<=this.sizeForm.startnumber?i(new Error("最大值必须大于最小值")):i())},s=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.sizeForm.endnumber-this.sizeForm.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()},a=(e,t,i)=>{""===t?i(new Error("最小值不能为空")):""!==this.structform.endnumber&&(t>=this.structform.endnumber?i(new Error("最小值小于最大值")):i())},r=(e,t,i)=>{""===t?i(new Error("最大值不能为空")):""!==this.structform.startnumber&&(t<=this.structform.startnumber?i(new Error("最大值必须大于最小值")):i())},o=(e,t,i)=>{t<0?i(new Error("步长大于0")):t>=this.structform.endnumber-this.structform.startnumber?i(new Error("步长必须小于最大值和最小值的差值")):i()};return{viewForm:{showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]},dlinkUnit:[],dlinkTopic:{basic:[],thing:[]},mergeObj:{basic:[],thing:[]},tabsChild:"properties",modules:{data:{properties:[],events:[],services:[],tags:[]},type:"events",disabled:!1,visible:!1,events:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],types:[{required:!0,message:"请选择调用方式",trigger:"change"}],output:[{type:"array",required:!0,message:"请至少选择一个输出参数",trigger:"blur"}]},visible:!1,data:{outputParams:[],name:"",identifier:"",types:"info",output:[],describe:""}},services:{rules:{name:[{required:!0,message:"请输入功能名称",trigger:"blur"},{min:1,max:40,message:"长度在 1 到 40 个字符",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],transfer:[{required:!0,message:"请选择调用方式",trigger:"change"}]},visible:!1,data:{name:"",identifier:"",enter:[],transfer:"sync",output:[],describe:""}}},moduletype:"properties",amisproductInfo:[],upKey:moment.now(),codeFlag:!1,productInfo:{decoder:{code:""},thing:{properties:[],events:[],services:[],tags:[]},config:{parser:[],profile:[],basedate:{params:[]}}},productObj:{thing:{properties:[],events:[],services:[],tags:[]}},FromMachine:[{name:"ALL"}],machineForm:{},machine:!1,devicetype:"",machinestatus:"add",machineindex:0,options:[{value:"first",label:"第一轮"},{value:"last",label:"最后一轮"},{value:"all",label:"全部"}],activeIndex:"",editableTabsValue:"1",editableTabs:[],tabIndex:1,sizeOption:[{label:"20",val:"20"},{label:"不采集(计算值)",val:"计算值"},{label:"不采集(主动上报)",val:"主动上报"}],showList:!1,collapseName:["1","2","3","4"],multipleSelection:[],protolchannel:[],protoldialog:!1,productimg:"",topicdialogVisible:!1,topicform:{profile:"",topic:"",type:"",desc:"",value:"",info:"basic",isupdated:-1},exportDialogShow:!1,exportUrl:"",exportName:"",decodertotal:0,decoderstart:0,leftItemPos:0,ed3isShow:!1,rightCollection:"",decoderlength:10,topicrule:{info:[{required:!0,message:"请选择topic所属类型",trigger:"change"}],topic:[{required:!0,message:"请输入Topic类",trigger:"blur"}],type:[{required:!0,message:"请选择Topic权限",trigger:"change"}]},topicstart:1,topiclength:10,topictotal:0,channelData:[],allchannelData:[],innerVisible:!1,allChannelstart:0,allChannellength:20,allChanneltotal:0,category:[],current:0,schemadialogVisible:!1,collectionDialogVisible:!1,PropData:[],originwmx:!1,wmxdialogVisible:!1,wmxSituation:"新增",allunit:[],sizerule:{step:[{required:!0,trigger:"blur",validator:s}],string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],startnumber:[{validator:t,required:!0,trigger:"blur"}],endnumber:[{validator:i,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structrule:{string:[{required:!0,trigger:"blur",message:"请输入数据长度"},{type:"number",message:"数据长度必须为数字"}],step:[{required:!0,trigger:"blur",validator:o}],startnumber:[{validator:a,required:!0,trigger:"blur"}],endnumber:[{validator:r,required:!0,trigger:"blur"}],resource:[{required:!0,message:"请选择功能类型",trigger:"change"}],true:[{required:!0,message:"请输入属性值",trigger:"blur"}],false:[{required:!0,message:"请输入属性值",trigger:"blur"}],name:[{required:!0,message:"请输入属性名称",trigger:"blur"}],identifier:[{required:!0,message:"请输入标识符",trigger:"blur"}],dis:[{required:!0,message:"请输入数据标识",trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],attribute:[{required:!0,message:"请输入属性",trigger:"blur"}],attributevalue:[{required:!0,message:"请输入属性值",trigger:"blur"}],isread:[{required:!0,message:"请选择读写类型",trigger:"change"}]},structdialog:!1,structform:{resource:1,identifier:"",type:"INT",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",date:"String类型的UTC时间戳 (毫秒)",string:"",specs:[],dis:"0X10",dinumber:"null",das:[]},tableData:[],activeName:"first",form:{Productname:"",ProductKey:"",ProductAll:0,data:{}},ProductSecret:"",dynamicReg:!1,productId:"",productName:"",productdetail:{thing:{properties:[],events:[],services:[],tags:[]}},topicData:[],topicDefault:{},topic:[{topic:"$dg/user/${deviceid}/post",type:"sub",desc:"设备属性上报",isdef:!0},{topic:"$dg/thing/${deviceid}/",type:"pub",desc:"消息下发",isdef:!0}],isshow:!0,isaccumulate:!1,addRules:{name:[{required:!0,message:"请输入协议名称",trigger:"blur"},{validator:e,trigger:"blur"}]},dialogTableVisible:!1,gridData:[],formInline:{name:"",version:"",desc:"",resource:!1},option:[],CategoryKey:"",productstart:0,productlength:10,producttotal:0,wmxstart:1,wmxPageSize:10,eventsStart:1,eventsPageSize:10,servicesStart:1,servicesPageSize:10,tagsStart:1,tagsPageSize:10,wmxtotal:20,wmxData:[],wmxDataBk:[],editorList:[],topicKey:"",refreshFlag:"99",msgList:[],submessage:"",mqtt:{router:"",subtopic:"",pubtopic:""},warningeditror:[],channellength:20,channelstart:0,channeltotal:0,isupdatedstruct:-1,issub:!1,subtimer:null,subdialog:!1,channelid:"",channelInfo:[],textarea:"",subdialogtimer:null,subdialogid:"",subaction:"stop",channelname:"",value4:!0,rulepagesize:10,rulestart:0,ruletotal:0,engineData:[],channeltype:0,resourcechannelData:[],resourcestart:0,resourcelength:10,resourcetotal:0,resourcedialogFormVisible:!1,resourceform:{},resourcechannelid:"",isreload:1,modifyIndex:-1,ace_editor:"",iframeShow:!1,atbas:{visible:!1,childrenDrawer:!1},editIndex:-1,eventType:"add",formType:"output",thingType:"events",eventForm:{},ruleForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},amisShow:!0,rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]}}},computed:L({treeData(){const e=JSON.parse(JSON.stringify(this.option));return e.filter(t=>{const i=e.filter(e=>t.id==e.parentid);return i.length>0&&(t.children=i),0==t.parentid})},showNewItem(){return!(!this.sizeForm||"modbus"!=this.sizeForm.protocol)}},Object(h["mapGetters"])({sizeForm:"konva/sizeForm"})),watch:{issub:{deep:!0,handler(e){this.subtimer=window.setInterval(()=>{this.subAce("formInline",!1)},5e3)}}},mounted(){this.query_notification(),this.getAllunit(),this.getDefaultTopic(),this.$nextTick(()=>{this.$refs._tabs.$children[0].$refs.tabs[3].style.display="none",this.mqtt.router=this.$dgiotBus.router(this.$route.fullPath)}),this.Industry(),this.getAllunit(),r=ace.edit("editor2"),r.session.setMode("ace/mode/text"),r.setTheme("ace/theme/monokai"),r.setReadOnly(!0),r.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.$route.query.activeName&&(this.activeName=this.$route.query.activeName),this.$route.query.id&&this.queryProductInfo(this.$route.query.id)},beforeDestroy(){window.clearInterval(this.subtimer),this.subtimer=null,window.clearInterval(this.subdialogtimer),this.subdialogtimer=null},methods:E(L({toggleSwitch(e){e.isshow=!e.isshow,this.preserve("isshow")},thingParameters(e,t,i){this.editIndex=t,console.log("thingParameters",e,this.modules,this.modules.data[this.modules[i]]),this.modules.data[i].data.output.push(e),this.atbas.childrenDrawer=!1},editParameters(e,t){console.log("thingParameters",e),this.modules[t].data.output[this.editIndex]=e,this.atbas.childrenDrawer=!1},showDrawer(){this.atbas.visible=!0},onClose(){this.atbas.visible=!1},showChildrenDrawer(){this.eventForm={name:"",unit:"/",isread:"rw",dataType:"int32",identifier:"",min:"",max:"",step:""},this.eventType="add",this.atbas.childrenDrawer=!0},onChildrenDrawerClose(){this.atbas.childrenDrawer=!1,console.log("清空子组件的规则校验和表单数据")},basicMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},thingMethod({column:e,rowIndex:t}){return this.mergeObj.basic[e.property][t]?{rowspan:this.mergeObj.basic[e.property][t],colspan:1}:{rowspan:0,colspan:0}},editEvent(e,t,i){return N(this,null,(function*(){this.editIndex=t,yield console.log("editEvent",e),this.atbas.childrenDrawer=!0,this.eventForm=e,this.eventType="edit",this.formType=i}))},getDefaultTopic(){return N(this,null,(function*(){const e=yield Object(u["getDlinkJson"])("Topic"),{UnifyUnitSpecsDTO:t=[]}=yield Object(u["getDlinkJson"])("Unit");for(var i in this.dlinkUnit=t,this.dlinkUnit.unshift({Symbol:"/",Name:"无"}),this.dlinkTopic=e,this.dlinkTopic)yield this.mergeTable(i,this.dlinkTopic[i]);dgiotlogger.error("mergeObj",this.mergeObj)}))},topicChange(e){return N(this,null,(function*(){"user"==e&&(yield this.getTopic())}))},mergeTable(e,t){return N(this,null,(function*(){let i=0;for(let s in t[0])this.mergeObj[e][s]=[],t.forEach((a,r)=>{0===r?this.mergeObj[e][s].push(1):a[s]===t[r-1][s]?(this.mergeObj[e][s][i]+=1,this.mergeObj[e][s].push(0)):(i=r,this.mergeObj[e][s].push(1))})}))},clearfix(e){this.$refs[e].clearValidate(),"services"==e?this.$refs.services.resetFields():this.$refs.events.resetFields(),this.modules.events.data.types="info",this.modules.services.data.transfer="sync"},editModus(e){this.modules[""+e.type].data=e,this.modules.type=e.type,this.modules.visible=!0,this.modules.disabled=!0,dgiotlogger.info("editModus",e,this.modules[""+e.type])},deleteModus(e,t,i){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>N(this,null,(function*(){t.splice(e,1),yield this.saveExpand(this.productObj.thing)})))},handleClose(){"events"==this.modules.type&&(this.$refs.events.clearValidate()&&this.$refs.events.resetFields()),"services"==this.modules.type&&(this.$refs.services.clearValidate()&&this.$refs.services.resetFields()),this.modules.events.data.types="info",this.modules.services.data.transfer="sync",this.modules.visible=!1,this.modules.disabled&&this.saveExpand(this.productObj.thing)},saveExpand(e){return N(this,null,(function*(){const t=yield Object(m["putProduct"])(this.productObj.objectId,{thing:e});t.updatedAt?this.$message({type:"success",message:"更新成功",showClose:!0,duration:2e3}):this.$message({type:"warning",message:"更新失败"+t.msg,showClose:!0,duration:2e3})}))},queryProductInfo(e){return N(this,null,(function*(){const t=yield Object(m["getProduct"])(e),{thing:i={properties:[],events:[],services:[],tags:[]}}=t;_.merge({properties:[],events:[],services:[],tags:[]},i);const s=_.merge({properties:[],events:[],services:[],tags:[]},i);dgiotlogger.log("thing",s),this.productObj=t,this.modules.data=s,this.productdetail.thing=s}))},submitModules(e,t){return N(this,null,(function*(){t.data.outputParams=[],console.log(t.data.output,"form.data.output"),console.log(t.data,"form.data"),t.data.output.forEach((e,i)=>{t.data.outputParams.push({identifier:e.identifier,index:i})});const i=E(L({},t.data),{devicetype:t.data.name,required:!1,isshow:!0,isaccumulate:!1,dataForm:{order:moment(new Date).format("x")},dataType:{type:e},moduleType:e,updateAt:moment(new Date).format("x")});return console.log("_item",i),window._item=i,yield this.submitForm(i),this.atbas.visible=!1,yield this.queryProductInfo(this.$route.query.id),!1}))},feateditorParser1(e,t,i){let s=this.productInfo;this.parserType=t,this.$baseEventBus.$emit("profileDialog",{config:e,type:t,flag:i,productInfo:s})}},Object(h["mapMutations"])({setSizeForm:"konva/setSizeForm"})),{tableRowClassName({row:e,rowIndex:t}){return 1===t?"warning-row":3===t?"success-row":""},selectStruct(e){},toggleList(){this.showList=!this.showList},getFormOrginalData(){return{devicetype:this.devicetype,strategy:"20",resource:1,identifier:"",dis:"0X10",dinumber:"null",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",isshow:!0,isaccumulate:!1,unit:"",string:"",date:"String类型的UTC时间戳 (毫秒)",specs:{},precision:3,round:"all",struct:[{attribute:"",attributevalue:""}],das:[],daslist:[],rate:1,offset:0,order:0,protocol:"normal",operatetype:"readCoils",originaltype:"short16_AB",slaveid:"0X10",collection:"%s",control:"%d",nobound:[],editdatatype:!1,iscount:"0",countstrategy:20,countround:"all",countcollection:"%s"}},changeValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},changeStructValue(e){this.$refs[e].validateField("startnumber",e=>{if(e)return!1})},getRowClass(e,t){if("struct"!=e.row.dataType.type)return"row-expand-cover"},getChannelEnable(e,t){return 1==e.row.isEnable?"green_active":"red_active"},handleChildClick(e){return N(this,null,(function*(){yield this.queryProductInfo(this.$route.query.id);const{properties:t=[],events:i=[],services:s=[],tags:a=[]}=this.productObj.thing;switch(console.log(this.tabsChild,e),console.log(e.name,this.productObj.thing,this.productObj.thing[e.name]),e.name){case"properties":this.modules.data.properties=t||[];break;case"events":this.modules.data.events=i||[];break;case"services":this.modules.data.services=s||[];break;case"tags":this.modules.data.tags=a||[];break;default:break}dgiotlogger.info(this.modules.data)}))},handleClick(e){switch(e.name){case"view":this.viewForm={class:"Product",type:"amis",key:this.$route.query.id||"",title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:[]};break;case"first":this.viewForm={showRow:!0,class:"Product",type:"notification",key:this.$route.query.id,title:"",disabled:!0,data:{type:"page",initApi:{url:"iotapi/classes/Device/parse_objectid",method:"get",adaptor:'return {\r\n  "status":0,\r\n  "msg":"",\r\n  "data":response.data.basedata\r\n  }',headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json"},body:[{type:"form",api:{method:"put",url:"iotapi/classes/Device/parse_objectid",headers:{store:"localStorage",dgiotReplace:"parse_objectid"},dataType:"json",requestAdaptor:"return {\r\n    ...api,\r\n    data: {\r\n        basedata:{ ...api.data}\r\n    }\r\n}"},body:[{type:"input-text",label:"设备名称",name:"name"}]}]},hiddenRow:["class","key","createdAt"]};break;case"fiveth":this.getProductChannel();break;case"second":this.getTopic();break;case"seven":this.getResourceChannel();break;case"sixeth":this.orginRule();break;case"eighth":this.isreload++;break;default:window.clearInterval(this.subtimer),this.subtimer=null;break}},getAllunit(){return N(this,null,(function*(){this.allunit=[];const{UnifyUnitSpecsDTO:e=[]}=yield Object(u["getDlinkJson"])("Unit");this.allunit=e}))},getTopic(){return N(this,null,(function*(){this.topicData=[],this.topicDefault={};const{topics:e={}}=yield Object(m["getProduct"])(this.productId);this.topicDefault=e;for(let t in e){let i={};for(let e in this.dlinkTopic.basic)this.dlinkTopic.basic[e].info="basic",this.dlinkTopic.basic[e].id===t&&(i=this.dlinkTopic.basic[e]);for(let e in this.dlinkTopic.thing)this.dlinkTopic.thing[e].info="thing",this.dlinkTopic.thing[e].id===t&&(i=this.dlinkTopic.thing[e]);i.name=t,i.value=e[t],this.topicData.push(i)}console.log(this.topicData)}))},exportProduct(e){return N(this,null,(function*(){try{const t={name:e},i=this.$baseColorfullLoading(),s=yield Object(b["downBinary"])("iotapi/product",t);I["dgiotlog"].log(s),this.$baseMessage(this.$translateTitle("alert.Data request successfully"),"success","dgiot-hey-message-success"),i.close(),this.$downBinary(s)}catch(error){I["dgiotlog"].log(error),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+error,"error","dgiot-hey-message-error")}}))},seeDecoder(e){return N(this,null,(function*(){try{this.ace_editor=z.decode(e.code)}catch(error){I["dgiotlog"].log(error)}}))},setTemplate(e){return N(this,null,(function*(){const t=this.$baseColorfullLoading(),{category:i="IotHub",config:s={konva:{Stage:{attrs:{x:14,y:29,id:"container",width:1635,height:767,container:"container",draggable:!0},children:[{attrs:{id:"Layer_5SKeJT"},children:[{attrs:{id:"Group_RoT",width:2e3,height:2e3},children:[],className:"Group"},{attrs:{id:"Group_QtGicp",draggable:!0},children:[{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-0-1630891418339",data:"M73.142857 0h877.714286v877.714286H73.142857z",fill:"#FFFFFF",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"},{attrs:{x:10,y:15,id:"#dgiot-quanyizhongxinbeifen-1-1630891418339",data:"M877.714286 137.142857A27.428571 27.428571 0 0 1 905.142857 164.571429v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428571l-3.017143 0.091429A45.714286 45.714286 0 0 0 877.714286 484.571429l2.633143 0.128A27.428571 27.428571 0 0 1 905.142857 512v201.142857a27.428571 27.428571 0 0 1-27.428571 27.428572H146.285714A27.428571 27.428571 0 0 1 118.857143 713.142857V512A27.428571 27.428571 0 0 1 146.285714 484.571429l2.998857-0.091429A45.714286 45.714286 0 0 0 146.285714 393.142857l-2.651428-0.128A27.428571 27.428571 0 0 1 118.857143 365.714286V164.571429A27.428571 27.428571 0 0 1 146.285714 137.142857z m-296.100572 138.185143l-69.266285 69.284571-69.266286-69.284571-38.784 38.802286 58.258286 58.258285H402.285714v54.857143h82.285715v39.186286H402.285714v54.857143h82.285715v66.614857h54.857142v-66.614857H621.714286v-54.857143h-82.285715v-39.186286H621.714286v-54.857143h-59.574857l58.276571-58.258285-38.802286-38.802286z",fill:"#111111",angle:-30,scaleX:.15,scaleY:.15,originX:"center",originY:"bottom",className:"Path"},className:"Path"}],className:"Group"}],className:"Layer"}],className:"Stage"}},parser:[],profile:[],basedate:{}},decoder:a={code:""},desc:r="",icon:o="",name:n="",netType:l="Modbus",nodeType:d=0,thing:c={properties:[]}}=e;try{const e={"*":{read:!0,write:!0}},u={ACL:e,category:i,config:s,decoder:a,desc:r,icon:o,name:n,netType:l,nodeType:d,thing:c},h=yield Object(f["postProductTemplet"])(u);I["dgiotlog"].log(h),h?this.$baseMessage(this.$translateTitle("user.Save the template successfully"),"success","dgiot-hey-message-success"):this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error"),t.close()}catch(error){I["dgiotlog"].log(error),t.close(),this.$baseMessage(this.$translateTitle("user.Save the template error"),"error","dgiot-hey-message-error")}}))},updatesubdialog(){return N(this,null,(function*(){this.protoldialog=!0;const e="1",t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.protolchannel=e.results,this.$refs.multipleTable.toggleAllSelection()}).catch(e=>{I["dgiotlog"].log(e),this.$baseMessage("请求出错",e.error,3e3)})}))},handleSelectionChange(e){this.multipleSelection=e},updateAllChannel(){if(0==this.multipleSelection.length)this.protoldialog=!1;else{var e=[];this.multipleSelection.map(t=>{e.push(new Promise((e,i)=>Object($["subupadte"])(t.objectId,"update").then(t=>{t&&e(t)}).catch(e=>{i(e)})))}),Promise.all(e).then(e=>{this.$message({showClose:!0,duration:2e3,message:"热加载成功",type:"success"}),e.length==this.multipleSelection.length&&(this.protoldialog=!1)}).catch(e=>{this.$message({showClose:!0,duration:2e3,message:e,type:"error"})})}},showAllChannel(e=""){I["dgiotlog"].log(this.allChannelstart,this.allChannellength),this.allChanneltotal=0,this.allchannelData=[],this.channeltype=1,this.innerVisible=!0;const t={$in:["1","3"]},i={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(""!=e?this.allChannellength:this.channellength,""!=e?this.allChannelstart:this.channelstart,i,t).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},getProductChannel(){const e={$in:["1","3"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.channeltotal=e.count,this.channelData=e.results,0==e.results.length}).catch(e=>{I["dgiotlog"].log(e)})},resourceShowAllChannel(){this.allChanneltotal=0,this.allchannelData=[],this.channeltype=0,this.innerVisible=!0;const e={$in:["2"]},t={$ne:{__type:"Pointer",className:"Product",objectId:this.productId}};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.allChanneltotal=e.count,this.allchannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},getResourceChannel(){const e={$in:["2"]},t={__type:"Pointer",className:"Product",objectId:this.productId};Object(g["getChannelCountByProduct"])(this.channellength,this.channelstart,t,e).then(e=>{this.resourcetotal=e.count,this.resourcechannelData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},addProductChannel(e){return N(this,null,(function*(){const t={product:{__op:"AddRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}},i=yield Object(g["saveChanne"])(e,t);i&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),1==this.channeltype?(this.showAllChannel(),this.getProductChannel()):(this.resourceShowAllChannel(),this.getResourceChannel()))}))},deleteRelation(e){const t={product:{__op:"RemoveRelation",objects:[{__type:"Pointer",className:"Product",objectId:this.productId}]}};Object(g["saveChanne"])(e.objectId,t).then(e=>{e&&this.$message({showClose:!0,duration:2e3,type:"success",message:"移除成功"}),this.getProductChannel(),this.getResourceChannel()})},channelSizeChange(e){this.channellength=e,this.getProductChannel()},channelCurrentChange(e){this.channelstart=(e-1)*this.channellength,this.getProductChannel()},resourcechannelSizeChange(e){this.resourcelength=e,this.getResourceChannel()},resourcechannelCurrentChange(e){this.resourcestart=(e-1)*this.resourcelength,this.getResourceChannel()},allChannelSizeChange(e){this.allChannellength=e,this.showAllChannel("Channel")},allChannelCurrentChange(e){this.allChannelstart=(e-1)*this.allChannellength,this.showAllChannel("Channel")},customize(e){this.resourcedialogFormVisible=!0,this.resourcechannelid=e.objectId,G=JSON.parse(JSON.stringify(e.config)),Object(T["setTimeout"])(()=>{o=ace.edit("editormodel"),o.session.setMode("ace/mode/json"),o.setTheme("ace/theme/twilight"),o.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),o.setReadOnly(!0),o.setValue(JSON.stringify(this.productdetail.thing,null,4)),n=ace.edit("editorcreate"),n.session.setMode("ace/mode/mysql"),n.setTheme("ace/theme/twilight"),n.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),e.config.datamodel&&""!=e.config.datamodel?n.setValue(e.config.datamodel):n.setValue('{\n            "vars":{\n              "database":"aosong",\n              "stable":"meter",\n              "value":[\n                {\n                  "timestamp":"TIMESTAMP",\n                  "bytes":8\n                },\n                {\n                  "temperature":"FLOAT",\n                  "bytes":4\n                },\n                {\n                  "humidity":"FLOAT",\n                  "bytes":4\n                }\n              ],\n              "tags":[\n                {\n                  "devaddr":"BINARY",\n                  "bytes":12\n                }\n              ],\n              "table":"devaddr",\n              "keep":3650\n            },\n            "sql":{\n              "create_database":"CREATE DATABASE IF NOT EXISTS ${database} KEEP ${keep}",\n              "drop_database":"DROP DATABASE IF EXISTS ${database}",\n              "creat_stable":"CREATE TABLE IF NOT EXISTS ${database}.${stable} (${timestamp} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n              "drop_stable":"DROP TABLE ${database}.${stable}",\n              "insert_stable":"INSERT INTO ${database}.${table} USING ${database}.${stable} TAGS (${devaddr}) VALUES (${temperature}, ${humidity})",\n              "insert_table":"INSERT INTO ${database}.${table} VALUES (${temperature}, ${humidity})",\n              "create_table":"CREATE TABLE ${databas}.${table} USING ${database}.${stable} TAGS (${devaddr});"\n            }\n          }')})},questionModel(){Object(T["setTimeout"])(()=>{l=ace.edit("editorinsert"),l.session.setMode("ace/mode/mysql"),l.setTheme("ace/theme/gob"),l.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),l.setValue('{\n          "vars":{\n            "database":"database",\n            "table":"stable",\n            "value":[\n              {\n                "timestamp":"TIMESTAMP",\n                "bytes":8\n              },\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ],\n            "tags":[\n              {\n                "int":"INT",\n                "bytes":4\n              },\n              {\n                "bigint":"BIGINT",\n                "bytes":8\n              },\n              {\n                "float":"FLOAT",\n                "bytes":4\n              },\n              {\n                "double":"DOUBLE",\n                "bytes":8\n              },\n              {\n                "binary":"BINARY",\n                "bytes":"自定义"\n              },\n              {\n                "smallint":"SMALLINT",\n                "bytes":2\n              },\n              {\n                "tinyint":"TINYINT",\n                "bytes":1\n              },\n              {\n                "bool":"BOOL",\n                "bytes":1\n              },\n              {\n                "nchar":"NCHAR",\n                "bytes":"自定义"\n              }\n            ]\n          },\n          "sql":{\n            "create_database":"CREATE DATABASE IF NOT EXISTS {{database}} KEEP {{keep}}",\n            "drop_database":"DROP DATABASE IF EXISTS {{database}}",\n            "creat_stable":"CREATE TABLE IF NOT EXISTS {{database}}.{{stable}} ({{timestamp}} TIMESTAMP, temperature FLOAT, humidity FLOAT) TAGS(devaddr BINARY[12]);",\n            "drop_stable":"DROP TABLE {{database}}.{{stable}}",\n            "insert_stable":"INSERT INTO {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}}) VALUES ({{temperature}}, {{humidity}})",\n            "insert_table":"INSERT INTO {{database}}.{{table}} VALUES ({{temperature}}, {{humidity}})",\n            "create_table":"CREATE TABLE {{database}}.{{table}} USING {{database}}.{{stable}} TAGS ({{devaddr}});"\n          }\n        }')})},addData(){return N(this,null,(function*(){G.datamodel=n.getValue();const e={config:G};yield Object(g["putChannel"])(this.rproductdetailesourcechannelid,e),this.$message("添加成功")}))},closeWuDialog(){this.resourcedialogFormVisible=!1,this.resourcechannelid=""},removeDomain(e){var t=this.sizeForm.struct.indexOf(e);-1!==t&&this.sizeForm.struct.splice(t,1)},addDomain(){this.sizeForm.struct.push({attribute:"",attributevalue:""})},addDas(){this.sizeForm.daslist.push({addr:""})},removeDas(e){var t=this.sizeForm.daslist.indexOf(e);-1!==t&&this.sizeForm.daslist.splice(t,1)},removeDomain1(e){var t=this.structform.specs.indexOf(e);-1!==t&&this.structform.specs.splice(t,1)},addDomain1(){this.structform.specs.push({value:"",name:""})},submitForm(e){I["dgiotlog"].log("obj",e);let t={item:e,productid:this.productId};"新增"==this.wmxSituation?Object(m["postThing"])(t).then(e=>{I["dgiotlog"].log("新增",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"新增成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}):"编辑"==this.wmxSituation&&Object(m["putThing"])(t).then(e=>{I["dgiotlog"].log("编辑",e),200==e.code?(this.$message({showClose:!0,duration:2e3,type:"success",message:"编辑成功"}),this.getProDetail()):this.$message({showClose:!0,duration:2e3,type:"warning",message:"new already existed"==e.msg?"该物模型已存在":e.msg})}),this.wmxdialogVisible=!1,this.queryProductInfo(this.$route.query.id)},createThing(e){switch(this.modules.disabled=!1,this.moduletype=e,this.wmxSituation="新增",this.setSizeForm(this.getFormOrginalData()),e){case"properties":this.wmxdialogVisible=!0;break;case"services":this.atbas.visible=!0,this.modules.type="services";break;case"events":this.atbas.visible=!0,this.modules.type="events";break;case"tags":this.wmxdialogVisible=!0;break}this.$nextTick(()=>{this.$refs[e]&&this.$refs[e].clearValidate(),this.$refs[e]&&this.$refs[e].resetFields()})},wmxDataFill(e,t,i){return N(this,null,(function*(){if(this.$nextTick(()=>{this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol()}),this.moduletype=i,this.modules.type=i,this.wmxSituation="编辑",this.thingType=i,this.eventType="edit",this.modules[i]&&(this.modules[i].data=e),"events"===i||"services"===i)return this.atbas.visible=!0,dgiotlogger.log(this.modules.type,this.modules[i].data),!1;this.modifyIndex=t,this.wmxdialogVisible=!0;var s={},a=[];if(e.dataType.das.forEach(e=>{a.push({addr:e})}),-1!=["float","double","int","long"].indexOf(e.dataType.type))s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,daslist:a,endnumber:this.$objGet(e,"dataType.specs.max"),startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),precision:this.$objGet(e,"dataType.specs.precision"),dis:this.$objGet(e,"dataForm.address"),round:this.$objGet(e,"dataForm.round"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),collection:"",control:"",strategy:"",required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0},e.dataForm&&(s.collection=e.dataForm.collection,s.control=e.dataForm.control,s.strategy=e.dataForm.strategy);else if("bool"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,true:e.dataType.specs[1],false:e.dataType.specs[0],daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("image"==e.dataType.type)s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,imagevalue:e.dataType.imagevalue,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!1,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0};else if("enum"==e.dataType.type){var r=[];for(const t in e.dataType.specs)r.push({attribute:t,attributevalue:e.dataType.specs[t]});s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,specs:e.dataType.specs,struct:r,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}}else"struct"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,struct:e.dataType.specs,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,identifier:void 0==e.dataForm?"":e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"text"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,string:e.dataType.size,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),order:this.$objGet(e,"dataForm.order"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,strategy:void 0==e.dataForm?"":e.dataForm.strategy,editdatatype:!0}:"date"==e.dataType.type?s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0}:"geopoint"==e.dataType.type&&(s={name:e.name,devicetype:e.devicetype,type:e.dataType.type,gpstype:e.dataType.gpstype,collection:void 0==e.dataForm?"":e.dataForm.collection,control:void 0==e.dataForm?"":e.dataForm.control,strategy:void 0==e.dataForm?"":e.dataForm.strategy,daslist:a,startnumber:this.$objGet(e,"dataType.specs.min"),step:this.$objGet(e,"dataType.specs.step"),unit:this.$objGet(e,"dataType.specs.unit"),round:this.$objGet(e,"dataForm.round"),dis:this.$objGet(e,"dataForm.address"),order:this.$objGet(e,"dataForm.order"),dinumber:this.$objGet(e,"dataForm.data"),rate:this.$objGet(e,"dataForm.rate"),offset:this.$objGet(e,"dataForm.offset"),protocol:this.$objGet(e,"dataForm.protocol"),operatetype:this.$objGet(e,"dataForm.operatetype"),originaltype:this.$objGet(e,"dataForm.originaltype"),slaveid:this.$objGet(e,"dataForm.slaveid"),afn:this.$objGet(e,"dataForm.afn"),da:this.$objGet(e,"dataForm.da"),dt:this.$objGet(e,"dataForm.dt"),bytelen:this.$objGet(e,"dataForm.bytelen"),byteType:this.$objGet(e,"dataForm.byteType"),iscount:this.$objGet(e,"dataForm.iscount"),countstrategy:this.$objGet(e,"dataForm.countstrategy"),countround:this.$objGet(e,"dataForm.countround"),countcollection:this.$objGet(e,"dataForm.countcollection"),required:!0,ico:e.ico,isread:e.accessMode,isshow:e.isshow,isaccumulate:e.isaccumulate,identifier:e.identifier,editdatatype:!0});I["dgiotlog"].log("editrowData",e),s.protocol=e.dataForm.protocol,s.profile=e.profile,this.setSizeForm(s),this.$nextTick(()=>N(this,null,(function*(){this.$refs["sizeForm"].queryResource(),this.$refs["sizeForm"].queryProtocol(),this.$refs["sizeForm"].resource.value=e.dataForm.protocol,this.$refs["sizeForm"].resource.disabled=!!e.dataForm.protocol.length,this.$refs["sizeForm"].resource.arrlist=e.dataSource;yield Object(F["getProtocol"])();this.$nextTick(()=>{this.$refs["sizeForm"].resource.data.forEach((t,i)=>{if(this.$refs["sizeForm"].resource.value===t.cType){for(var s in console.info(t,"物模型回显事件"),t.arr.forEach(t=>{t.allowCreate&&this.$refs["sizeForm"].dynamicTable(t,"回显",e.dataSource[t.showname])}),console.info(e.dataSource,"rowData.dataSource"),e.dataSource)for(var a in t.obj)s===a&&(t.obj[s]=e.dataSource[a]);console.info(t.obj,"set resource.obj"),this.$refs["sizeForm"].resource.addchannel=t.obj}this.$refs["sizeForm"].resource.changeData=e.dataSource,t.cType==e.dataForm.protocol&&console.log(t,"success")})}),console.log("refs sizeForm",this.$refs["sizeForm"])})))}))},submitStruct(e){this.$refs[e].validate(t=>{if(t){var i={};if("float"==this.structform.type||"double"==this.structform.type||"int"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{max:this.structform.endnumber,min:this.structform.startnumber,step:this.structform.step,unit:""==this.structform.unit?"":this.structform.unit}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("bool"==this.structform.type)i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),specs:{0:this.structform.false,1:this.structform.true}},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!1,accessMode:this.structform.isread,identifier:this.structform.identifier};else if("enum"==this.structform.type){var s={};this.structform.struct.map(e=>{var t=e["attribute"];s[t]=e["attributevalue"]}),i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),struct:this.structform.struct,specs:s},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}}else"text"==this.structform.type?i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase(),size:this.structform.string},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier}:"date"==this.structform.type&&(i={name:this.structform.name,dataType:{type:this.structform.type.toLowerCase()},dataForm:{address:this.structform.dis,data:this.structform.dinumber},required:!0,accessMode:this.structform.isread,identifier:this.structform.identifier});-1==this.isupdatedstruct?this.sizeForm.struct.push(i):(this.sizeForm.struct.splice(this.isupdatedstruct,1,i),this.isupdatedstruct=-1),this.$refs[e].resetFields(),this.structdialog=!1}})},addStruct(e){this.structdialog=!0,this.structform={resource:1,identifier:"",type:"int",startnumber:"",endnumber:"",step:"",true:"",truevalue:1,false:"",falsevalue:0,isread:"r",unit:"",specs:[],date:"String类型的UTC时间戳 (毫秒)",string:""}},editStruct(e,t){if(I["dgiotlog"].log(e,t),this.isupdatedstruct=t,this.structdialog=!0,this.structform.type=e.dataType.type.toUpperCase(),this.structform.name=e.name,this.structform.identifier=e.identifier,this.structform.isread=e.accessMode,"float"==e.dataType.type||"double"==e.dataType.type||"int"==e.dataType.type)this.structform.startnumber=e.dataType.specs.min,this.structform.endnumber=e.dataType.specs.max,this.structform.step=e.dataType.specs.step,this.structform.unit=e.dataType.specs.unit;else if("bool"==e.dataType.type)this.structform.true=e.dataType.specs["1"],this.structform.false=e.dataType.specs["0"];else if("enum"==e.dataType.type){this.structform.specs=[];var i={};Object.keys(e.dataType.specs).forEach((t,s)=>{i.attribute=t,i.attributevalue=e.dataType.specs[t],this.structform.specs.push(i)})}else"text"==e.dataType.type&&(this.structform.string=e.dataType.size)},deleteStruct(e){this.sizeForm.struct.splice(e,1)},preserve(e){return N(this,null,(function*(){const t="json"===e?"物模型修改成功":"物模型状态更新成功",i="json"===e?{thing:JSON.parse(a.getValue())}:{thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,i),Object(T["setTimeout"])(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:t}),"json"===e&&(this.schemadialogVisible=!1,this.handleChildClick(this.tabsChild),this.getProDetail())},1e3)}))},Industry(){return N(this,null,(function*(){this.option=[];const{results:e}=yield this.$getIndustry("category",100);e.map(e=>{var t={};t.value=e.type,t.label=e.data.CategoryName,t.id=e.data.Id,t.parentid=e.data.SuperId,this.option.push(t)}),this.getProDetail()}))},utc2beijing(e){var t=new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"");return t},getPropData(e){0==e&&(this.productstart=0),this.CategoryKey=this.$route.query.CategoryKey;const t={count:"objectId",limit:this.productlength,skip:this.productstart,where:{"data.key":"category"}};0!=this.category.length&&(t.where.type=this.category[this.category.length-1]),Object(v["getDictCount"])(t).then(e=>{this.producttotal=e.count,this.PropData=e.results}).catch(e=>{I["dgiotlog"].log(e)})},productSizeChange(e){this.productlength=e,this.getPropData()},productCurrentChange(e){this.productstart=(e-1)*this.productlength,this.getPropData()},checkAddTest(){this.collectionDialogVisible=!0,this.editableTabsValue=this.wmxData[0].identifier,this.activeIndex=this.wmxData[0].identifier,this.editableTabs=[],this.editorList=[],this.tabIndex=1,this.ed3isShow=!1,this.editableTabs.push({title:this.wmxData[0].identifier,name:this.wmxData[0].identifier,leftItemPos:0,content:void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection}),0==this.ed3isShow&&Object(T["setTimeout"])(()=>{this.editorList.push(ace.edit(this.wmxData[0].identifier)),this.editorList[0].session.setMode("ace/mode/erlang"),this.editorList[0].setTheme("ace/theme/monokai"),this.editorList[0].setHighlightActiveLine(!0),this.editorList[0].setFontSize(20),this.editorList[0].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.ed3isShow=!0,this.editorList[0].setValue(void 0==this.wmxData[0].dataForm?"":this.wmxData[0].dataForm.collection)},1)},handleRightTopTabClick(e,t){this.activeIndex=e.label},menuTabClick(e,t){this.activeIndex=e.identifier;const i=this.editableTabs;let s=!1,a=0;i.forEach((t,i)=>{t.name===e.identifier&&(s=!0,a=i)}),0==s?(this.editableTabs.push({title:e.identifier,name:e.identifier,leftItemPos:t,content:void 0==e.dataForm?"":e.dataForm.collection}),Object(T["setTimeout"])(()=>{this.editorList.push(ace.edit(e.identifier)),this.editorList[this.editorList.length-1].session.setMode("ace/mode/erlang"),this.editorList[this.editorList.length-1].setTheme("ace/theme/monokai"),this.editorList[this.editorList.length-1].setHighlightActiveLine(!0),this.editorList[this.editorList.length-1].setFontSize(20),this.editorList[this.editorList.length-1].setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.editorList[this.editorList.length-1].setValue(void 0==e.dataForm?"":e.dataForm.collection)},1),this.editableTabsValue=e.identifier,this.rightCollection=void 0==e.dataForm?"":e.dataForm.collection):(this.editableTabsValue=e.identifier,this.editorList[a].setValue(void 0==e.dataForm?"":e.dataForm.collection))},removeTab(e){const t=this.editableTabs;let i=this.editableTabsValue;i===e&&t.forEach((s,a)=>{if(s.name===e){const e=t[a+1]||t[a-1];e&&(i=e.name)}}),this.editableTabsValue=i,this.activeIndex=i,this.editableTabs=t.filter(t=>t.name!==e)},onSaveTap(e){return N(this,null,(function*(){const t=this.editableTabs[e].leftItemPos;this.productdetail.thing.properties[t].dataForm.collection=this.editorList[e].getValue();const i={thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}))},handleCloseCollecttion(e){this.$confirm("确认关闭？").then(t=>{e()}).catch(e=>{})},onReductionTap(e){const t=this.editableTabs[e].leftItemPos;this.editorList[e].setValue(this.wmxData[t].dataForm.collection)},checkschema(){this.schemadialogVisible=!0,Object(T["setTimeout"])(()=>{a=ace.edit("editor1"),a.session.setMode("ace/mode/json"),a.setTheme("ace/theme/eclipse"),a.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),a.setValue(JSON.stringify(this.productdetail.thing,null,4))},1)},query_notification(){return N(this,null,(function*(){let e={count:"objectId",where:{key:{$regex:this.$route.query.id},type:{$regex:"notification"}}};this.$route.query.id&&(e.where.key={$regex:this.$route.query.id});const{results:t,count:i=0}=yield Object(D["queryView"])(e);this.amisShow=i>0,this.amisproductInfo=t}))},getProDetail(){this.query_notification(),s=ace.edit("editor"),s.session.setMode("ace/mode/erlang"),s.setTheme("ace/theme/monokai"),s.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0}),this.productId=this.$route.query.id,this.queryDeviceCount(this.productId),this.FromMachine=[{name:"ALL"}],this.$get_object("Product",this.productId).then(e=>{if(I["dgiotlog"].log("response",e),e){for(var t in this.productInfo=_.merge(e,{decoder:{code:""},thing:{properties:[]},config:{parser:[],profile:[],basedate:{params:[]}}}),this.productName=e.name,e)this.productdetail[t]=e[t];this.option.map(e=>{this.productdetail.category==e.value&&(this.productdetail.category=e.label)}),this.productdetail.createdAt=this.utc2beijing(e.createdAt),this.productdetail.id=e.id,this.dynamicReg=e.dynamicReg,this.productdetail.isshow=0,this.productdetail.category&&this.$get_object("Category",this.productdetail.category.objectId).then(e=>{I["dgiotlog"].log("catcat",e),this.$set(this.productdetail,"categoryname",e.name)}),this.form.Productname=e.name,this.ProductSecret=e.productSecret,this.form.Productkey=this.productId,this.productimg=e.icon,e.decoder?(B=e.decoder.code,this.formInline.name=e.decoder.name,this.formInline.version=e.decoder.version,this.formInline.desc=e.decoder.desc):B="JSUlLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQolJSUgQGNvcHlyaWdodCAoQykgMjAxOCwgPHNodXdhPgolJSUgQGRvYwolJSUg5Y2P6K6u6Kej5p6QRGVtbwolJSUgQGVuZAolJSUgQ3JlYXRlZCA6IDA4LiDljYHkuIDmnIggMjAxOCAxNDo0OQolJSUtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi1tb2R1bGUoc2h1d2FfZGVtb19kZWNvZGVyKS4KLWF1dGhvcigic2h1d2EiKS4KLWRlZmluZShNU0dfVFlQRSwgPDwiREVNTyI+PikuCi1wcm90b2NvbChbPDwiREVNTyI+Pl0pLgoKLWV4cG9ydChbcGFyc2VfZnJhbWUvMiwgdG9fZnJhbWUvMV0pLgoKCnBhcnNlX2ZyYW1lKEJ1ZmYsIE9wdHMpIC0+CiAgICBwYXJzZV9mcmFtZShCdWZmLCBbXSwgT3B0cykuCgoKcGFyc2VfZnJhbWUoPDw+PiwgQWNjLCBfT3B0cykgLT4KICAgIHs8PD4+LCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBSZXN0L2JpbmFyeT4+ID0gQmluLCBBY2MsIF9PcHRzKSB3aGVuIGJ5dGVfc2l6ZShSZXN0KSA9PCA2IC0+CiAgICB7QmluLCBBY2N9OwpwYXJzZV9mcmFtZSg8PDE2IzY4LCBMZW46MTYvbGl0dGxlLWludGVnZXIsIExlbjoxNi9saXR0bGUtaW50ZWdlciwgMTYjNjgsIFJlc3QvYmluYXJ5Pj4gPSBCaW4sIEFjYywgT3B0cykgLT4KICAgIGNhc2UgYnl0ZV9zaXplKFJlc3QpIC0gMiA+PSBMZW4gb2YKICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgIGNhc2UgUmVzdCBvZgogICAgICAgICAgICAgICAgPDxVc2VyWm9uZTpMZW4vYnl0ZXMsIENyYzo4LCAxNiMxNiwgUmVzdDEvYmluYXJ5Pj4gLT4KICAgICAgICAgICAgICAgICAgICBBY2MxID0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBzaHV3YV91dGlsczpnZXRfcGFyaXR5KFVzZXJab25lKSA9Oj0gQ3JjIG9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIC0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRnJhbWUgPSAjewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8PCJtc2d0eXBlIj4+ID0+ID9NU0dfVFlQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPDwiZGF0YSI+PiA9PiBVc2VyWm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWNjICsrIFtGcmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSAtPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjYwogICAgICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfZnJhbWUoUmVzdDEsIEFjYzEsIE9wdHMpOwogICAgICAgICAgICAgICAgXyAtPgogICAgICAgICAgICAgICAgICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykKICAgICAgICAgICAgZW5kOwogICAgICAgIGZhbHNlIC0+CiAgICAgICAgICAgIHtCaW4sIEFjY30KICAgIGVuZDsKcGFyc2VfZnJhbWUoPDxfOjgsIFJlc3QvYmluYXJ5Pj4sIEFjYywgT3B0cykgLT4KICAgIHBhcnNlX2ZyYW1lKFJlc3QsIEFjYywgT3B0cykuCgoKJSUg57uE6KOF5oiQ5bCB5YyFLCDlj4LmlbDkuLpNYXDlvaLlvI8KdG9fZnJhbWUoI3s8PCJtc2d0eXBlIj4+IDo9ID9NU0dfVFlQRX0gPSBGcmFtZSkgLT4KICAgIFBheWxvYWQgPSB0ZXJtX3RvX2JpbmFyeShGcmFtZSksCiAgICA8PDE2IzAzLCBQYXlsb2FkL2JpbmFyeSwgMTYjMjM+Pi4=",void 0!=this.productdetail.thing&&"{}"!=JSON.stringify(this.productdetail.thing)||(this.productdetail.thing={properties:[]}),I["dgiotlog"].log("=====",this.wmxData),this.wmxData=[],this.wmxDataBk=[],this.wmxData=this.productdetail.thing.properties.filter((e,t)=>(e.index=t,e.name&&e.dataType)),this.wmxDataBk=this.productdetail.thing.properties,I["dgiotlog"].log("=====",this.wmxData),this.wmxDataBk.forEach(e=>{if(e.devicetype){let t={name:e.devicetype};this.FromMachine.push(t)}}),this.FromMachine=_.uniqBy(this.FromMachine,"name"),s.setValue(z.decode(B)),s.gotoLine(s.session.getLength())}}).catch(e=>{I["dgiotlog"].log("err",e),this.$baseMessage("请求出错",e.error,3e3)})},queryDeviceCount(e){return N(this,null,(function*(){this.form.ProductAll=yield Object(p["getDeviceCountByProduct"])(e)}))},handelUpdate(e,t){return N(this,null,(function*(){var t;t=1!=e,this.dynamicReg=t;const i={dynamicReg:!t};yield Object(m["putProduct"])(this.productId,i),this.$message({showClose:!0,duration:2e3,type:"success",message:"修改成功"}),this.dynamicReg=!t}))},wmxhandleClose(e){return N(this,null,(function*(){this.wmxSituation="新增",e?(this.wmxdialogVisible=!1,this.$refs["sizeForm"].$refs["sizeForm"].resetFields(),this.$refs["sizeForm"].$refs["sizeForm"].clearValidate(),this.setSizeForm(this.getFormOrginalData()),this.$refs["sizeForm"].resource.disabled=!1,yield this.handleChildClick(this.tabsChild),this.$refs["sizeForm"]&&(yield this.$refs["sizeForm"].queryResource())):this.wmxdialogVisible=!1}))},protol(){var e="";Object($["Compile"])(z.encode(s.getValue())).then(t=>{t&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"编译成功"}),e="编译成功"+t.mod+"\r\n",this.warningeditror=t.warnings,this.warningeditror.map(t=>{e+=t+"\r\n"}),M+=e,r.setValue(M))}).catch(t=>{this.warningeditror=t.error,this.warningeditror.map(t=>{e+=t+"\r\n"}),M+=e,r.setValue(M)})},decoderSizeChange(e){this.decoder.length=e,this.chaxun()},devicerCurrentChange(e){this.decoderstart=(e-1)*this.decoderlength,this.chaxun()},deletedata(e){this.$del_object("Dict",e).then(e=>{e&&(this.$message("成功删除"),this.chaxun())}).catch(e=>{I["dgiotlog"].log(e)})},subAce(e,t){this.$refs[e].validate(e=>N(this,null,(function*(){if(e){var i={name:this.formInline.name,version:this.formInline.version,code:z.encode(s.getValue()),desc:this.formInline.desc};const e={decoder:i};yield Object(m["putProduct"])(this.productId,e),0==this.issub&&(this.$message({showClose:!0,duration:2e3,type:"success",message:"保存成功"}),1==t&&(M+="保存成功",r.setValue(M))),this.issub=!0}else this.$message({type:"warning",message:"输入格式有误"})})))},subAce1(e){this.$refs[e].validate(e=>{if(e){const e={where:{"data.name":this.formInline.name,"data.version":this.formInline.version}};this.$query_object("Dict",e).then(e=>{e.results&&e.results.length>=1?this.$message("此协议版本已存在"):this.$get_object("Product",this.productId).then(e=>{if(e){var t={name:this.formInline.name,version:this.formInline.version,code:z.encode(s.getValue()),desc:this.formInline.desc};const i={key:this.formInline.name+":"+this.formInline.version,type:"decoder",data:t,ACL:e.ACL};this.$create_object("Dict",i).then(e=>{e.error?this.$message({type:"error",message:e.error}):this.$message({showClose:!0,duration:2e3,type:"success",message:"保存到公共协议库成功"})}).catch(e=>{I["dgiotlog"].log(e)})}})}).catch(e=>{I["dgiotlog"].log(e)})}else this.$message({showClose:!0,duration:2e3,type:"warning",message:"输入格式有误"})})},updatesub(e){Object($["subupadte"])(e.objectId,"update").then(e=>{e&&this.$message("重载成功")}).catch(e=>{this.$message(e.error)})},chaxun(){const e={count:"objectId",skip:this.decoderstart,limit:this.decoderlength,where:{type:"decoder"}};this.dialogTableVisible=!0,this.$query_object("Dict",e).then(e=>{e&&(this.decodertotal=e.count,this.gridData=e.results)}).catch(e=>{I["dgiotlog"].log(e)})},editordata(e){this.formInline.name=e.data.name,this.formInline.version=e.data.version,this.formInline.desc=e.data.desc,this.formInline.resource=e.data.enable,s.setValue(z.decode(e.data.code)),this.dialogTableVisible=!1},goToDevices(){this.$router.push({path:"/roles/thing",query:{productid:this.productId}})},addcategory(){this.originwmx=!0,this.getPropData()},addMachine(){this.machineForm={},this.machine=!0,this.machinestatus="add"},savemachine(e){"edit"==this.machinestatus?this.FromMachine[this.machineindex]=e:this.FromMachine.push(e),this.machine=!1},clickmachine(e,t,i){"ALL"==e.name?(this.wmxDataBk.forEach(e=>{e.dataType||(e.dataType={das:[],specs:{},type:"float",identification:"function"})}),this.wmxData=this.wmxDataBk):(this.devicetype=e.name,this.wmxData=this.wmxDataBk.filter(t=>t.devicetype==e.name&&!t.dataType.identification),this.wmxstart=1),this.upKey=moment.now(),console.log(this.wmxData," this.wmxData ")},handleChange(e,t,i){},TypeInstall(e,t){t.map((t,i)=>{if("enum"==t.DataType||"bool"==t.DataType){var s={dataType:{specs:{}}};s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{for(var t in e){var i=e["value"],a=e["name"];s.dataType.specs[i]=a}}),e.push(s)}else if("double"==t.DataType||"int"==t.DataType||"float"==t.DataType){s={dataType:{specs:{}}};for(var a in s.name=t.Name,s.dataType.type=t.DataType,s.required=t.Required,s.identifier=t.Identifier,s.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecs))s.dataType.specs.min=JSON.parse(t.DataSpecs)["min"],s.dataType.specs.max=JSON.parse(t.DataSpecs)["max"],s.dataType.specs.step=JSON.parse(t.DataSpecs)["step"],s.dataType.specs.unit=JSON.parse(t.DataSpecs)["unit"];e.push(s)}else if("struct"==t.DataType){var r={dataType:{specs:[]}};r.name=t.Name,r.dataType.type=t.DataType,r.required=!t.Required,r.identifier=t.Identifier,r.accessMode=1==t.RwFlag?"r":"rw",JSON.parse(t.DataSpecsList).map(e=>{if("enum"==e.childDataType||"bool"==e.childDataType){var t={dataType:{specs:{}}};t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childEnumSpecsDTO.map(e=>{for(var i in e){var s=e["value"],a=e["name"];t.dataType.specs[s]=a}}),r.dataType.specs.push(t)}else if("double"==e.childDataType||"int"==e.childDataType||"float"==e.childDataType){t={dataType:{specs:{}}};for(var i in t.name=e.childName,t.dataType.type=e.childDataType.toLowerCase(),t.required=e.Required,t.identifier=e.identifier,t.accessMode=1==e.RwFlag?"r":"rw",e.childSpecsDTO)t.dataType.specs.min=e.childSpecsDTO["min"],t.dataType.specs.max=e.childSpecsDTO["max"],t.dataType.specs.step=e.childSpecsDTO["precise"],t.dataType.specs.unit=e.childSpecsDTO["unit"];r.dataType.specs.push(t)}}),e.push(r)}});var i={};e=e.reduce((e,t)=>(!i[t.identifier]&&(i[t.identifier]=e.push(t)),e),[])},addProCategory(e){const t={where:{type:e.type,"data.key":"detail"}};this.$query_object("Dict",t).then(e=>N(this,null,(function*(){const t=e.results;if(t&&t[0].data.Ability){this.TypeInstall(this.productdetail.thing.properties,t[0].data.Ability);const e={thing:this.productdetail.thing};yield Object(m["putProduct"])(this.productId,e),this.$message({showClose:!0,duration:2e3,type:"success",message:"添加成功"}),this.getProDetail()}else I["dgiotlog"].log("此选项没有属性功能")})))},deletewmx(e){this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),this.$translateTitle("Maintenance.Delete reminder"),()=>N(this,null,(function*(){const t={productid:this.productId,item:e},i=yield Object(m["deleteThing"])(t);200==i.code?(this.$baseMessage(this.$translateTitle("user.successfully deleted"),"success","dgiot-hey-message-success"),yield this.getProDetail(),yield this.queryProductInfo(this.$route.query.id)):this.$baseMessage(this.$translateTitle("user.error deleted")+(null==i?void 0:i.msg)?i.msg:i,"error","dgiot-hey-message-error")})))},wmxSizeChange(e){console.log(this.wmxData),this.wmxstart=1,this.wmxPageSize=e},wmxCurrentChange(e){console.log(this.wmxData),this.wmxstart=e},eventsChange(e){this.eventsStart=1,this.eventsPageSize=e},eventsCurrentChange(e){this.eventsStart=e},serverSizeChange(e){this.servicesStart=1,this.servicesPageSize=e},serverCurrentChange(e){this.servicesStart=e},tagsSizeChange(e){this.tagsStart=1,this.tagsPageSize=e},tagsCurrentChange(e){this.eventsStart=e},nowtime(){var e=Date.parse(new Date),t=new Date(e),i=(t.getFullYear(),t.getMonth()+1<=10?t.getMonth():t.getMonth(),t.getDate()+1<=10?t.getDate():t.getDate(),(t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":"),s=(t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":",a=t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds();return i+s+a+" "},subProTopic(e){return N(this,null,(function*(){this.channelid=e.objectId,this.subdialog=!0,this.subdialogid=e.objectId,this.channelname=e.objectId,this.mqtt.subtopic="$dg/user/channel/"+e.objectId+"/#";this.mqtt.router,this.mqtt.subtopic;this.$dgiotBus.$off(this.$mqttInfo.topicKey),yield this.$subscribe(this.subtopic),Object($["subupadte"])(e.objectId,"start_logger"),this.submessage="",this.msgList=[],this.$dgiotBus.$on(this.$mqttInfo.topicKey,e=>{this.mqttMsg(e.payloadString)})}))},mqttMsg(e){console.error(e),this.msgList.push({timestamp:moment().format("x"),msg:e}),this.refreshFlag=moment().format("x"),this.submessage+=e+"\n"},handleCloseSubdialog(){Object($["subupadte"])(this.channelid,"stop_logger"),this.msgList=[],this.submessage=[],this.subdialog=!1},stopsub(e){},subTopic(e,t){this.$refs[e].validate(i=>N(this,null,(function*(){if(console.log(this.topicDefault,t),!i)return I["dgiotlog"].log("error submit!!"),!1;{let i="";-1!=t?(this.topicDefault[this.topicform.id]=this.topicform.value,i="修改topic成功"):(this.topicDefault[this.topicform.topic]=this.topicform.value,i="添加自定义topic成功"),console.log(this.topicDefault),yield Object(m["putProduct"])(this.productId,{topics:this.topicDefault}),this.$message({showClose:!0,duration:2e3,type:"success",message:i}),this.topicform={isupdated:-1,value:"",info:"basic"},this.handleClick({name:"second"}),this.topicdialogVisible=!1,this.$refs[e].resetFields()}})))},topicSizeChange(e){this.topicstart=1,this.topiclength=e},topicCurrentChange(e){this.topicstart=e},updatetopic(e,t){console.log(e),this.topicform=e,this.topicdialogVisible=!0,this.topicform.isupdated=t},deletetopic(e,t,i){this.$baseConfirm("你确定要删除当前项topic吗",null,()=>N(this,null,(function*(){const t={};e.splice(i,1),e.forEach(e=>{t[e.id]=e.value}),console.log(this.topicDefault),yield Object(m["putProduct"])(this.productId,{topics:t}),this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功"})})))},orginRule(){Object(y["getRule"])().then(e=>{e&&(this.engineData=e)}).catch(e=>{this.$message(e.error)})},handleSizeChange(e){},handleCurrentChange(e){},addEngine(){this.$router.push({path:"/rules_engine/addengine",query:{title:"新增",productid:this.productId}})},actions(e){var t=[];return e.map(e=>{t.push(e.name)}),t.join(",")},getRowindex(e,t,i){if(0==e.columnIndex)return"firstcolumn"},detailRules(e){this.$router.push({path:"/rules_engine/checkengine",query:{id:e}})}})};t["a"]=V}}]);