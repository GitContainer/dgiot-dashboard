/*!
 *  build: 杭州数蛙科技有限公司 
 *  copyright: dgiot-dashboard 
 *  author: h7ml(h7ml@qq.com) 
 *  Time: 2022年06月17日18时21分18秒
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-081f4a92"],{"130a":function(e,t,a){"use strict";a("618c")},"1b27":function(e,t,a){"use strict";a("7cd2")},2144:function(e,t,a){},"273d":function(e,t,a){},2771:function(e,t,a){},"283e":function(e,t,a){"use strict";a("2771")},"297e":function(e,t,a){},"32dc":function(e,t,a){},"34f5":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.description,callback:function(t){e.$set(e.form.info,"description",t)},expression:"form.info.description"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{staticStyle:{margin:"0 0 10px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",size:"1",type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),readonly:"",type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1)],1)],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},i=[],s={props:{detail:{type:Object,default:()=>{}}},data(){return{reverse:!0,activeName:"first",form:this.detail}}},o=s,l=(a("a99f"),a("2877")),n=Object(l["a"])(o,r,i,!1,null,"5f96f32a",null);t["default"]=n.exports},3845:function(e,t,a){},"39d0":function(e,t,a){},"3b5e":function(e,t,a){"use strict";a("297e")},"3d3e":function(e,t,a){},"40d5":function(e,t,a){"use strict";a("4de4")},4393:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"index-container"},[a("div",{staticClass:"index-content"},[a("div",{staticClass:"dialog"},[a("dgiot-dialog",{attrs:{show:e.dialog.processes.visible},on:{"update:show":function(t){return e.$set(e.dialog.processes,"visible",t)},beforeClose:e.handleClose}},[a("el-form",{ref:"processes",staticClass:"demo-ruleForm",attrs:{"label-width":"100px",model:e.dialog.processes.form,rules:e.processes}},[a("el-form-item",{attrs:{label:"工序名称",prop:"title"}},[a("el-input",{model:{value:e.dialog.processes.form.title,callback:function(t){e.$set(e.dialog.processes.form,"title",t)},expression:"dialog.processes.form.title"}})],1),a("el-form-item",{attrs:{label:"工序编码",prop:"type"}},[a("el-input",{model:{value:e.dialog.processes.form.type,callback:function(t){e.$set(e.dialog.processes.form,"type",t)},expression:"dialog.processes.form.type"}})],1),a("el-form-item",{attrs:{label:"工序描述",prop:"key"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.dialog.processes.form.key,callback:function(t){e.$set(e.dialog.processes.form,"key",t)},expression:"dialog.processes.form.key"}})],1),a("el-form-item",{staticStyle:{"text-align":"center"},attrs:{"label-width":"0"}},[1==e.dialog.isAdd?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("processes","processes","submit")}}},[e._v(" 立即创建 ")]):e._e(),!1===e.dialog.isAdd?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("processes","processes","edit")}}},[e._v(" 修改 ")]):e._e(),a("el-button",{on:{click:function(t){return e.resetForm("processes","processes")}}},[e._v(" 重置 ")])],1)],1)],1),a("dgiot-dialog",{attrs:{show:e.dialog.properties.visible},on:{"update:show":function(t){return e.$set(e.dialog.properties,"visible",t)},beforeClose:e.handleClose}},[a("el-form",{ref:"properties",staticClass:"demo-ruleForm",attrs:{"label-width":"160px",model:e.dialog.properties.form,rules:e.properties}},[a("el-form-item",{attrs:{label:"工艺路径属性名称",prop:"title"}},[a("el-input",{model:{value:e.dialog.properties.form.title,callback:function(t){e.$set(e.dialog.properties.form,"title",t)},expression:"dialog.properties.form.title"}})],1),a("el-form-item",{attrs:{label:"工艺路径属性标识",prop:"type"}},[a("el-input",{model:{value:e.dialog.properties.form.type,callback:function(t){e.$set(e.dialog.properties.form,"type",t)},expression:"dialog.properties.form.type"}})],1),a("el-form-item",{attrs:{label:"工艺路径属性值",prop:"key"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.dialog.properties.form.key,callback:function(t){e.$set(e.dialog.properties.form,"key",t)},expression:"dialog.properties.form.key"}})],1),a("el-form-item",{staticStyle:{"text-align":"center"},attrs:{"label-width":"0"}},[1==e.dialog.isAdd?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("properties","properties","submit")}}},[e._v(" 立即创建 ")]):e._e(),!1===e.dialog.isAdd?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("properties","properties","edit")}}},[e._v(" 修改 ")]):e._e(),a("el-button",{on:{click:function(t){return e.resetForm("properties","properties")}}},[e._v(" 重置 ")])],1)],1)],1)],1),a("el-descriptions",{attrs:{border:"",column:5,direction:"vertical",size:"medium",title:e.detail.data.title}},[a("el-descriptions-item",{attrs:{label:"工艺路径编号"}},[e._v(" "+e._s(e.detail.data.code)+" "),a("DgiotQrcode",{attrs:{iconstyle:{type:"qrcode","font-size":"12px"},setting:{text:e.detail.data.code,binarizeThreshold:.5}}})],1),a("el-descriptions-item",{attrs:{label:"工艺路径名称"}},[e._v(" "+e._s(e.detail.data.title)+" ")]),a("el-descriptions-item",{attrs:{label:"工艺路径描述"}},[e._v(" "+e._s(e.detail.data.description)+" ")]),a("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(" "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]),a("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(" "+e._s(e.$moment(e.detail.updatedAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]),a("template",{slot:"extra"},[a("el-button",{nativeOn:{click:function(t){return e.busInfo("view",e.$route.query)}}},[e._v(" 表单 ")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.busInfo("file",e.$route.query)}}},[e._v(" 归档 ")]),a("el-button",{attrs:{type:"danger"},nativeOn:{click:function(t){return e.busInfo("delete",e.$route.query)}}},[e._v(" 删除 ")])],1)],2),a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"工序列表",name:"first"}},[a("dgiot-query-form",[a("dgiot-query-form-left-panel",[e._v(" 工艺路径工序 ")]),a("dgiot-query-form-right-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.dialog.processes.visible=!0}}},[e._v(" 新增工序 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.amis.processes,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[a("el-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"工序名称",prop:"title",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"工序编码",prop:"type",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"工序描述",prop:"key",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,i=t.$index;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(r,i,e.amis.processes,"processes")}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(r,i,e.amis.processes,"processes")}}},[e._v(" 删除 ")])]}}])})],1)],1),a("el-tab-pane",{attrs:{label:"属性列表",name:"second"}},[a("dgiot-query-form",[a("dgiot-query-form-left-panel",[e._v(" 工艺路径属性 ")]),a("dgiot-query-form-right-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入工艺路径名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.dialog.properties.visible=!0}}},[e._v(" 新增属性 ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.amis.properties,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[a("el-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center",label:"属性名称",prop:"title",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"属性标识",prop:"key",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"属性值",prop:"key",sortable:"",width:"auto"}}),a("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,i=t.$index;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(r,i,e.amis.properties,"properties")}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(r,i,e.amis.properties,"properties")}}},[e._v(" 删除 ")])]}}])})],1)],1)],1)],1)])},i=[],s=a("e0e9"),o=a("8456"),l=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{},data(){return{amis:{processes:[],properties:[]},detail:{},activeName:"first",properties:{title:[{required:!0,message:"请输入工艺路径属性名称",trigger:"blur"}],type:[{required:!0,message:"请输入工艺路径属性标识",trigger:"blur"}],key:[{required:!0,message:"请输入工艺路径属性值",trigger:"blur"},{min:0,max:50,message:"长度在 0 到 50 个字符",trigger:"blur"}]},processes:{name:[{required:!0,message:"请输入工序名称",trigger:"blur"}],code:[{required:!0,message:"请输入工序编码",trigger:"blur"}],title:[{required:!0,message:"请输入工序名称",trigger:"blur"}],type:[{required:!0,message:"请输入工序编码",trigger:"blur"}],key:[{required:!1,message:"请输入工序描述",trigger:"blur"},{min:0,max:50,message:"长度在 5 到 50 个字符",trigger:"blur"}]},dialog:{editRow:{},isAdd:!0,properties:{visible:!1,form:{name:"",code:"",value:""}},processes:{visible:!1,form:{name:"",code:"",description:""}},production:{visible:!1,form:{name:"",code:"",description:""}}},infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(1),stripe:!1,lineHeight:"medium",checkList:["标题","作者","评级","点击量","时间"],columns:[{label:"标题",width:"auto",prop:"title",sortable:!0,disableCheck:!0},{label:"作者",width:"auto",prop:"author",sortable:!0},{label:"评级",width:"200",prop:"rate",sortable:!0},{label:"点击量",width:"auto",prop:"pageViews",sortable:!0},{label:"时间",width:"auto",prop:"datetime",sortable:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},created(){this.queryDetails(this.$route.query.objectId),this.queryAmisDeatil(this.$route.query.objectId)},mounted(){this.fetchData()},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{submitForm(e,t,a){this.$refs[e].validate(r=>l(this,null,(function*(){if(!r)return console.log("error submit!!"),!1;{const r={title:this.dialog[t].form.title,data:{},type:this.dialog[t].form.type,class:t,key:this.dialog[t].form.key,parent:{__type:"Pointer",className:"Dict",objectId:this.$route.query.objectId}};"submit"==a?yield Object(s["postDict"])(r):yield Object(s["putDict"])(this.editRow.row.objectId,r),this.dialog[t].visible=!1,this.queryAmisDeatil(this.$route.query.objectId),this.resetForm(e)}})))},resetForm(e){this.$refs[e].resetFields()},handleEdit(e,t,a,r){this.dialog[r].form=e,this.dialog[r].visible=!0,this.dialog.isAdd=!1,this.editRow={row:e,index:t,list:a,type:r}},handleClose(){this.dialog={editRow:{},isAdd:!0,properties:{visible:!1,form:{name:"",code:"",value:""}},processes:{visible:!1,form:{name:"",code:"",description:""}},production:{visible:!1,form:{name:"",code:"",description:""}}}},handleDelete(e,t,a,r){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){a.splice(t,1),yield Object(s["delDict"])(e.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success")})))},queryAmisDeatil(e){return l(this,null,(function*(){const t={where:{parent:e,class:"processes"}},a={where:{parent:e,class:"properties"}};try{const{results:e=[]}=yield Object(s["queryDict"])(t),{results:r=[]}=yield Object(s["queryDict"])(a);this.amis.processes=e,this.amis.properties=r}catch(r){console.log(r),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+r,"error","dgiot-hey-message-error")}}))},queryDetails(e){return l(this,null,(function*(){try{this.detail=yield Object(s["getDict"])(e),_.merge(this.detail,{data:{processes:[],properties:[],production:[]}})}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}}))},setSelectRows(e){this.selectRows=e},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return l(this,null,(function*(){this.listLoading=!0,this.imageList=[];const{data:{list:e,total:t}}=yield Object(o["getList"])(this.queryForm);this.list=e;const a=[];e.forEach(e=>{a.push(e.img)}),this.imageList=a,this.total=t,setTimeout(()=>{this.listLoading=!1},900)}))},busInfo(e,t){return l(this,null,(function*(){switch(console.log(e,t),e){case"view":this.$router.push({path:"/design",query:{type:"amis",_class:"Ftechnology",key:t.objectId}});break;case"file":this.$baseMessage("归档成功","success","dgiot-hey-message-success");break;case"release":this.$baseMessage("发布成功","success","dgiot-hey-message-success");break;case"delete":yield Object(s["delDict"])(t.objectId),this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message({showClose:!0,duration:2e3,type:"success",message:"删除成功!"}),this.$router.go(-1)}).catch(()=>{this.$message({showClose:!0,duration:2e3,type:"info",message:"已取消删除"})});break;case"edit":this.$baseMessage("编辑成功","success","dgiot-hey-message-success");break;default:break}}))},handleClick(e,t){return l(this,null,(function*(){console.log(e,t);try{switch(this.fetchData(),e.name){case"first":break;case"second":break;case"third":break;case"fourth":break;default:break}}catch(a){console.log(a),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+a,"error","dgiot-hey-message-error")}}))}}},c=n,u=(a("9065"),a("2877")),d=Object(u["a"])(c,r,i,!1,null,"adb80c8a",null);t["default"]=d.exports},"446c":function(e,t,a){},"4aad6":function(e,t,a){},"4de4":function(e,t,a){},"4e73":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"success"},nativeOn:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")])]}}])})],1),a("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("1267"),u=a("824b"),d=a("7212"),m=Object.defineProperty,p=Object.defineProperties,h=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,v=(e,t)=>{for(var a in t||(t={}))g.call(t,a)&&y(e,a,t[a]);if(f)for(var a of f(t))b.call(t,a)&&y(e,a,t[a]);return e},w=(e,t)=>p(e,h(t)),$=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),k={name:"DispatchTicket",components:{ChangeStep:u["default"]},data(){return{Product:{},created:0,Assigned:0,showdeviceFlag:!1,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:w(v({},Object(n["mapGetters"])({objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStepg(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.fetchData(),this.handleCreated("created")},methods:w(v({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(c["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return $(this,null,(function*(){const t={};t[""+this.objectid]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),i=yield Object(s["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",i),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return $(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(c["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>$(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,this.ishard=t,this.isfooter=a;let{status:r}=e;this.detail=e,this.set_deviceStep(r),this.step=r+1,this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData(),this.getProduct()},getProduct(){return $(this,null,(function*(){const{results:e={}}=yield Object(d["queryProduct"])({});this.Product=e}))},fetchData(){return $(this,arguments,(function*(e={}){var t;console.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{status:0}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return $(this,null,(function*(){dgiotlog.log(e),this.Device=[],this.Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},x=k,F=(a("40d5"),a("2877")),T=Object(F["a"])(x,r,i,!1,null,"2d860bd8",null);t["default"]=T.exports},"4f46":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Processing records")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step2.Remarks,callback:function(t){e.$set(e.form.info.step2,"Remarks",t)},expression:"form.info.step2.Remarks"}})],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},i=[],s=a("ce31"),o=a("8665"),l=a("5880"),n=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,h=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))m.call(t,a)&&h(e,a,t[a]);if(d)for(var a of d(t))p.call(t,a)&&h(e,a,t[a]);return e},g=(e,t)=>c(e,u(t)),b=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),y={props:{detail:{type:Object,default:()=>{}},step:{type:Number,default:2},showFooter:{type:Boolean,default:!1}},data(){return{reverse:!0,activeName:"first",form:this.detail}},computed:f({},Object(l["mapGetters"])({username:"user/username"})),mounted(){this.featUser()},methods:g(f({},Object(l["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{featUser(){return b(this,null,(function*(){const{results:e}=yield Object(o["queryUser"])({});this.user=e}))},dispatchUser(){this.$refs["form"].validate(e=>b(this,null,(function*(){if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const{objectId:e,info:t}=this.form;t.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已处理",p:this.username+"处理了这条工单"});const a={status:2,info:t},r=yield Object(s["update_object"])("Maintenance",e,a);r.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},v=y,w=(a("1b27"),a("2877")),_=Object(w["a"])(v,r,i,!1,null,"550ef1fd",null);t["default"]=_.exports},5745:function(e,t,a){"use strict";a("67ce")},"58a6":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"index-container"},[r("div",{staticClass:"index"},[r("div",{staticClass:"in_top"},[e._v("工厂建模")]),r("div",{staticClass:"in_ctr"},[e._v("工厂列表")]),r("div",{staticClass:"in_btm"},[r("el-button",{attrs:{type:"warning"},on:{click:e.openCreatePlant}},[e._v("新增工厂")]),r("el-row",{staticClass:"btm_wrap"},e._l(e.plantlist,(function(t){return r("el-col",{key:t.id,staticClass:"wrap_content",attrs:{lg:{span:7},md:{span:7},sm:{span:11},xl:{span:5},xs:{span:20}}},[r("div",{staticClass:"ct_top"},[r("img",{attrs:{src:a("35a1")}}),r("div",{staticClass:"top_right"},[r("div",{staticClass:"right_item right_title"},[e._v(e._s(t.name))]),r("div",{staticClass:"right_item"},[e._v("编码:"+e._s(t.objectId))]),r("div",{staticClass:"right_item"},[e._v(" 描述: "),t.desc?r("span",[e._v(e._s(t.desc))]):r("span",[e._v("--")])])])]),r("div",{staticClass:"ct_btm"},[r("el-button",{staticClass:"btm_left",nativeOn:{click:function(a){return e.modelToDetail(t)}}},[e._v(" 查看 ")]),r("div",{staticClass:"btm_right"},[e._v("组织类型:"+e._s(t.org_type))])],1)])})),1)],1)]),r("el-dialog",{attrs:{"append-to-body":!0,direction:e.direction,height:"60%",title:"新增工厂",visible:e.drawer,width:"30%"},on:{"update:visible":function(t){e.drawer=t}}},[r("div",{staticClass:"demo-drawer__content"},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[r("el-form-item",{attrs:{label:"工厂名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入工厂名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"岗位",prop:"tempname"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择岗位"},model:{value:e.form.tempname,callback:function(t){e.$set(e.form,"tempname",t)},expression:"form.tempname"}},e._l(e.dict,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.key,value:e.key}})})),1)],1),r("el-form-item",{attrs:{label:"工厂描述"}},[r("el-input",{attrs:{maxlength:"500",placeholder:"不超过500个字符","show-word-limit":"",type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 立即创建 ")]),r("el-button",{on:{click:e.openCreatePlant}},[e._v("取消")])],1)],1)],1)])],1)},i=[],s=a("9ab53"),o=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),l={name:"Index",components:{},props:{},data(){return{plantlist:[],drawer:!1,parent:"",direction:"rtl",dict:[],wrapclose:!1,form:{name:"",tempname:"",desc:""},rules:{name:[{required:!0,message:"请输入工厂名称",trigger:"blur"},{min:2,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],tempname:[{required:!0,message:"请选择岗位",trigger:"blur"}]}}},computed:{},watch:{},created(){},mounted(){this.fetchData(),this.getDict()},destroyed(){},methods:{getDict(){return o(this,null,(function*(){const e={where:{type:"roletemp"}},{results:t}=yield Object(s["queryDictTemp"])(e);console.log("模板",t),this.dict=t}))},fetchData(){return o(this,null,(function*(){const{results:e}=yield Object(s["queryRoleTree"])();this.plantlist=e[0].children,this.parent=e[0].objectId}))},modelToDetail(e){console.log(e),this.$router.push({path:"/oc/Modeling/modeldetail",query:{objectid:e.objectId,name:e.name}})},openCreatePlant(){this.form={name:"",tempname:"",desc:""},this.drawer=!this.drawer},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;{const e={depname:this.form.name,desc:this.form.desc,name:this.form.name,parent:this.parent,tempname:this.form.tempname};console.log("部门",e),Object(s["postRole"])(e).then(e=>{console.log("result",e),this.fetchData(),this.drawer=!this.drawer})}})}}},n=l,c=(a("fb36"),a("2877")),u=Object(c["a"])(n,r,i,!1,null,"61a0691c",null);t["default"]=u.exports},"5b4c":function(e,t,a){"use strict";a("9276")},"5d3e":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"index-container"},[a("empty")],1)},i=[],s=a("43b8"),o={name:"Index",components:{empty:s["default"]},props:{},data(){return{}},computed:{},watch:{},created(){},mounted(){},destroyed(){},methods:{}},l=o,n=(a("96ea"),a("2877")),c=Object(n["a"])(l,r,i,!1,null,"08e17772",null);t["default"]=c.exports},"618c":function(e,t,a){},"67ce":function(e,t,a){},"697b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e._deviceFlag,width:"100vh"},on:{"update:visible":function(t){e._deviceFlag=t}}},[a("change-info",{ref:"changeinfo",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceFlag(!1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e.Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.status")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket status")},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.status,(function(t){return a("el-option",{key:t.key,attrs:{label:e.$translateTitle(t.text),value:t.key}})})),1),a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.handleFold}},[e.fold?a("span",[e._v(" "+e._s(e.$translateTitle("Maintenance.Unfold"))+" ")]):a("span",[e._v(e._s(e.$translateTitle("Maintenance.merge")))]),a("dgiot-icon",{staticClass:"dgiot-dropdown",class:{"dgiot-dropdown-active":e.fold},attrs:{icon:"arrow-up-s-line"}})],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.fold,expression:"!fold"}]},[a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(e.selectedList,1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.batch deletion"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==r.status,expression:"row.status == 1"}],attrs:{size:"mini",type:"success"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==r.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=r.status,expression:"row.status != 3"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("7212"),u=a("e915"),d=a("1267"),m=Object.defineProperty,p=Object.defineProperties,h=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,v=(e,t)=>{for(var a in t||(t={}))g.call(t,a)&&y(e,a,t[a]);if(f)for(var a of f(t))b.call(t,a)&&y(e,a,t[a]);return e},w=(e,t)=>p(e,h(t)),$=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),k={name:"MyWork",components:{ChangeInfo:u["default"]},data(){return{Product:{},created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:w(v({},Object(n["mapGetters"])({objectid:"user/objectId",role:"acl/role",currentDepartment:"user/currentDepartment",username:"user/username"})),{_deviceFlag:{get(){return console.log("this.$store.state.global._deviceFlag",this.$store.state.global._deviceFlag),this.$store.state.global._deviceFlag},set(e){console.log("this.$store.state.global._deviceFlag",this.$store.state.global._deviceFlag,e),this.set_deviceFlag(e)}},aclObj(){let e={};return this.role.map(t=>{console.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceFlag:function(e){console.log(e),0==e&&this.fetchData()},"queryForm.status":function(e){console.log(e),this.queryForm.statusFlag=""!=e}},created(){console.log("role",this.role),console.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:w(v({myUpload(e){const t=e.file;let a=t.name.substring(t.name.lastIndexOf(".")+1);const r={file:t,path:"ticket",filename:`ticket${moment().format("x")}.${a}`};console.log("extension",r),Object(d["UploadImg"])(r).then(e=>{e.data.url?(this.form.photo.push(e.data.url),console.log("上传成功的回调",e.data.url,this.form.photo)):console.log("no up url ",e)}).catch(e=>{console.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return $(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[""+("role:"+this.currentDepartment.name)]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),i=yield Object(s["create_object"])("Maintenance",a);r.close(),console.log("res",i),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),console.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceFlag:"global/set_deviceFlag"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return $(this,null,(function*(){console.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(d["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),console.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>$(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceFlag(!0)},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData(),this.getProduct()},getProduct(){return $(this,null,(function*(){const{results:e={}}=yield Object(c["queryProduct"])({});this.Product=e}))},fetchData(){return $(this,arguments,(function*(e={}){var t;console.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),console.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();console.log(this.queryForm.status,""==this.queryForm.status);let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{console.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),console.log(this.list,"this.list")}))},prodChange(e){return $(this,null,(function*(){console.log(e),this.Device=[],this.Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);console.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),console.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.changeinfo.$refs.step1.dispatchUser()},backChange(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};console.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceFlag(!1)}))},Reassign(e){return $(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};console.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceFlag(!1)}))},dealwith(){this.$refs.changeinfo.$refs.step2.dispatchUser()},check(){this.$refs.changeinfo.$refs.step3.dispatchUser()}})},x=k,F=(a("5b4c"),a("2877")),T=Object(F["a"])(x,r,i,!1,null,"f6a0a5c2",null);t["default"]=T.exports},"6d66":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"index-container"},[r("div",{ref:"custom-table",staticClass:"custom-table-container",class:{"dgiot-fullscreen":e.isFullscreen}},[r("dgiot-query-form",[r("dgiot-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"资产名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")])],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:t.label,sortable:"",width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return["评级"===t.label?r("span",[r("el-rate",{attrs:{disabled:""},model:{value:i.rate,callback:function(t){e.$set(i,"rate",t)},expression:"row.rate"}})],1):r("span",[e._v(e._s(i[t.prop]))])]}}],null,!0)})})),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],2),r("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),r("div",{staticClass:"draw"},[r("el-drawer",{attrs:{"append-to-body":"",title:"我是标题",visible:e.drawer,"with-header":!1},on:{"update:visible":function(t){e.drawer=t}}},[r("el-form",{ref:"form",attrs:{"label-position":"top","label-width":"80px",model:e.sizeForm,rules:e.rules,size:"mini","status-icon":""}},[r("el-form-item",{attrs:{label:"资产名称"}},[r("el-input",{model:{value:e.sizeForm.name,callback:function(t){e.$set(e.sizeForm,"name",t)},expression:"sizeForm.name"}})],1),r("el-form-item",{attrs:{label:"活动区域"}},[r("el-select",{attrs:{placeholder:"请选择活动区域"},model:{value:e.sizeForm.region,callback:function(t){e.$set(e.sizeForm,"region",t)},expression:"sizeForm.region"}},[r("el-option",{attrs:{label:"区域一",value:"shanghai"}}),r("el-option",{attrs:{label:"区域二",value:"beijing"}})],1)],1),r("el-form-item",{attrs:{label:"活动时间"}},[r("el-col",{attrs:{span:11}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择日期",type:"date"},model:{value:e.sizeForm.date1,callback:function(t){e.$set(e.sizeForm,"date1",t)},expression:"sizeForm.date1"}})],1),r("el-col",{staticClass:"line",attrs:{span:2}},[e._v("-")]),r("el-col",{attrs:{span:11}},[r("el-time-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"选择时间"},model:{value:e.sizeForm.date2,callback:function(t){e.$set(e.sizeForm,"date2",t)},expression:"sizeForm.date2"}})],1)],1),r("el-form-item",{attrs:{label:"活动性质"}},[r("el-checkbox-group",{model:{value:e.sizeForm.type,callback:function(t){e.$set(e.sizeForm,"type",t)},expression:"sizeForm.type"}},[r("el-checkbox-button",{attrs:{label:"美食/餐厅线上活动",name:"type"}}),r("el-checkbox-button",{attrs:{label:"地推活动",name:"type"}}),r("el-checkbox-button",{attrs:{label:"线下主题活动",name:"type"}})],1)],1),r("el-form-item",{attrs:{label:"特殊资源"}},[r("el-radio-group",{attrs:{size:"medium"},model:{value:e.sizeForm.resource,callback:function(t){e.$set(e.sizeForm,"resource",t)},expression:"sizeForm.resource"}},[r("el-radio",{attrs:{border:"",label:"线上品牌商赞助"}}),r("el-radio",{attrs:{border:"",label:"线下场地免费"}})],1)],1),r("el-form-item",{attrs:{size:"large"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即创建")]),r("el-button",[e._v("取消")])],1)],1)],1)],1)],1)])},i=[],s=a("8456"),o=a("3248"),l=a("7212"),n=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),c={name:"Index",components:{TableEdit:o["default"]},props:{},data(){return{rules:{name:[{required:!0,message:"请输入资产名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],date1:[{type:"date",required:!0,message:"请选择日期",trigger:"change"}],date2:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}],type:[{type:"array",required:!0,message:"请至少选择一个活动性质",trigger:"change"}],resource:[{required:!0,message:"请选择活动资源",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]},sizeForm:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},product:[],infoData:"Empty",isFullscreen:!1,border:!0,drawer:!1,height:this.$baseTableHeight(0),stripe:!0,lineHeight:"medium",checkList:["资产编号","资产名称","资产类型","颁发/认证机构","资产状态"],columns:[{label:"资产编号",width:"auto",prop:"author",sortable:!0,disableCheck:!0},{label:"资产名称",width:"auto",prop:"title",sortable:!0},{label:"资产类型",width:"rate",prop:"rate",sortable:!0},{label:"颁发/认证机构",width:"auto",prop:"description",sortable:!0},{label:"资产状态",width:"auto",prop:"status",sortable:!0}],list:[],imageList:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData(),this.fetchProduct()},mounted(){},destroyed(){},methods:{onSubmit(){console.log("submit!")},fetchProduct(){return n(this,null,(function*(){try{const{results:e=[]}=yield Object(l["queryProduct"])({excludeKeys:"channel,children,category,config,thing,producttemplet,topics,decoder"});this.product=e}catch(e){this.$baseMessage(e,"error","dgiot-hey-message-error")}}))},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleAdd(){this.drawer=!0},handleEdit(e){this.drawer=!1},handleDelete(e){if(e.id)this.$baseConfirm("你确定要删除当前项吗",null,()=>n(this,null,(function*(){const{msg:t}=yield Object(s["doDelete"])({ids:e.id});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})));else if(this.selectRows.length>0){const e=this.selectRows.map(e=>e.id).join();this.$baseConfirm("你确定要删除选中项吗",null,()=>n(this,null,(function*(){const{msg:t}=yield Object(s["doDelete"])({ids:e});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})))}else this.$baseMessage("未选中任何行","error","dgiot-hey-message-error")},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return n(this,null,(function*(){this.list=[],this.listLoading=!0;try{const{data:{list:e,total:t}}=yield Object(s["getList"])(this.queryForm);console.error(e,t,this.queryForm),setTimeout(()=>{this.list=e,this.total=t,this.listLoading=!1},300)}catch(e){console.error(e)}}))}}},u=c,d=(a("283e"),a("2877")),m=Object(d["a"])(u,r,i,!1,null,"3a7357b1",null);t["default"]=m.exports},"6da9":function(e,t,a){"use strict";a("7c1b")},"6f07":function(e,t,a){"use strict";a("39d0")},"758f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"index-container"},[a("dgiot-input",{ref:"uploadFinish",attrs:{params:e.inputParams},on:{fileInfo:e.fileInfo,files:e.files}}),a("div",{staticClass:"ftechnology"},[a("div",{staticClass:"dlalog"},[a("dgiot-dialog",{key:e.ftechnology.type,attrs:{show:e.ftechnology.dialogVisible,title:"add"==e.ftechnology.type?"新增工艺路径":"修改工艺路径"},on:{"update:show":function(t){return e.$set(e.ftechnology,"dialogVisible",t)},beforeClose:e.handleClose}},[a("el-form",{ref:"ftechnology",staticClass:"demo-ruleForm",attrs:{"label-width":"110px",model:e.ftechnology,rules:e.rules,"status-icon":""}},[a("el-form-item",{attrs:{label:"工艺路径名称",prop:"form.title"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入工艺路径名称"},model:{value:e.ftechnology.form.title,callback:function(t){e.$set(e.ftechnology.form,"title",t)},expression:"ftechnology.form.title"}})],1),a("el-form-item",{attrs:{label:"工艺路径编码",prop:"form.code"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"请输入工艺路径编码"},model:{value:e.ftechnology.form.code,callback:function(t){e.$set(e.ftechnology.form,"code",t)},expression:"ftechnology.form.code"}})],1),a("el-form-item",{attrs:{label:"工艺路径描述",prop:"form.description"}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"不超过500个字符",rows:2,type:"textarea"},model:{value:e.ftechnology.form.description,callback:function(t){e.$set(e.ftechnology.form,"description",t)},expression:"ftechnology.form.description"}})],1),a("el-form-item",{key:e.ftechnology.form.img,attrs:{label:"工艺路径logo"}},[a("el-avatar",{key:e.imgKey,attrs:{size:100,src:e.$FileServe+e.ftechnology.form.img},nativeOn:{click:function(t){return e.uploadCkick("userinfo.avatar")}}},[e.ftechnology.form.img?e._e():a("div",{key:e.ftechnology.form.img,staticClass:"el-icon-plus avatar-uploader-icon",attrs:{slot:"error"},on:{click:function(t){return e.uploadCkick("userinfo.avatar")}},slot:"error"})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){return e.handleClose.apply(null,arguments)}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("ftechnology",e.ftechnology.type)}}},[e._v(" 确 定 ")])],1)],1)],1),a("dgiot-query-form",[a("dgiot-query-form-left-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入工艺路径名称"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},nativeOn:{click:function(t){return e.handleQuery.apply(null,arguments)}}},[e._v(" 查询 ")]),a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){e.ftechnology.dialogVisible=!0}}},[e._v(" 添加工艺路径 ")])],1)],1)],1)],1),a("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.total,expression:"total === 0"}],attrs:{"image-size":e.$baseTableHeight(0)-160}}),a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingConfig,expression:"loadingConfig"}],staticClass:"box-card",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Waitingtoreturn"),gutter:20}},e._l(e.list,(function(t,r){return a("el-col",{key:r,attrs:{lg:6,md:8,sm:12,xl:6,xs:24}},[a("el-card",{staticClass:"card",attrs:{shadow:"hover"}},[a("div",{staticClass:"box"},[a("div",{staticClass:"left"},[a("el-avatar",{key:e.imgKey,staticStyle:{width:"100px",height:"100px"},attrs:{src:e.$FileServe+t.data.img}},[a("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[a("i",{staticClass:"el-icon-picture-outline"})])])],1),a("div",{staticClass:"right"},[a("el-descriptions",{attrs:{column:1,size:"medium",title:t.data.title}},[a("el-descriptions-item",{attrs:{label:"编码",title:t.data.code}},[e._v(" "+e._s(t.data.code)+" ")]),a("el-descriptions-item",{attrs:{label:"描述",title:t.data.description}},[e._v(" "+e._s(t.data.description)+" ")]),a("el-descriptions-item",{attrs:{label:"更新时间",title:t.updatedAt}},[e._v(" "+e._s(e.$moment(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])],1)],1)]),a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-size":"14px","font-weight":"700","line-height":"22px",color:"#333"}},[e._v(" "+e._s(t.data.title)+" ")]),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(a){return e.$router.push({path:"/oc/Ftechnology/detail",query:{objectId:t.objectId}})}}},[e._v(" 查看 ")]),a("el-button",{attrs:{size:"mini",type:"warning"},nativeOn:{click:function(a){return e.editItem(t)}}},[e._v(" 编辑 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},nativeOn:{click:function(a){return e.deleteItem(t.objectId,r,e.list)}}},[e._v(" 删除 ")])],1)])])],1)})),1),a("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)},i=[],s=a("e0e9"),o=a("5880"),l=Object.defineProperty,n=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,d=(e,t,a)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,m=(e,t)=>{for(var a in t||(t={}))c.call(t,a)&&d(e,a,t[a]);if(n)for(var a of n(t))u.call(t,a)&&d(e,a,t[a]);return e},p=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),h={name:"Index",components:{},props:{},data(){return{imgKey:moment().format("x"),inputParams:{},layout:"total, sizes, prev, pager, next, jumper",total:0,rules:{"form.title":[{required:!0,message:"请输入工艺路径名称",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],"form.code":[{required:!0,message:"请输入工艺路径编码",trigger:"blur"},{min:1,max:15,message:"长度在 1 到 15 个字符",trigger:"blur"}],"form.description":[{required:!1,message:"请输入工艺路径描述",trigger:"blur"},{min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"blur"}]},ftechnology:{type:"add",objectId:"",dialogVisible:!1,form:{title:"",description:"",code:""}},list:[],loadingConfig:!1,upNodeType:"",queryForm:{title:"",skip:0,limit:8,name:"",search:""},currentDate:(new Date).toLocaleString()}},computed:m({},Object(o["mapGetters"])({ObjectId:"user/objectId"})),watch:{},created(){this.fetechData()},mounted(){},destroyed(){},methods:{uploadCkick(e){this.$refs["uploadFinish"].$refs.uploader.dispatchEvent(new MouseEvent("click")),this.inputParams={file:"",scene:"app",path:"user/Ftechnology/",filename:`${this.ObjectId}_Ftechnology_${this.upNodeType.replace(".","_")}.${e}`}},fileInfo(e){console.log(e),this.$baseMessage("上传成功",e.name+" 上传成功，请点击确定按钮，查看图片","success",!1,"dgiot-hey-message-success"),this.imgKey=moment().format("x"),this.ftechnology.form.img=e.path+"?"+(new Date).getTime()},files(e,t){this.inputParams.filename=`${this.ObjectId}_${this.upNodeType.replace(".","_")}.${t}`,this.inputParams.file=e},editItem(e){this.ftechnology.objectId=e.objectId,this.ftechnology.dialogVisible=!0,this.ftechnology.form=e.data,this.ftechnology.type="edit"},deleteItem(e,t,a){return p(this,null,(function*(){this.$baseConfirm("你确定要删除选中项吗",null,()=>p(this,null,(function*(){yield Object(s["delDict"])(e),a.splice(t,1),this.$baseMessage("删除成功","success","dgiot-hey-message-success")})))}))},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetechData()},handleSizeChange(e){this.queryForm.limit=e,this.fetechData()},handleClose(){this.ftechnology.type="add",this.ftechnology.objectId="",this.ftechnology.dialogVisible=!1},submitForm(e,t){return p(this,null,(function*(){if(this.loadingConfig=!0,"add"===t)try{const{error:e}=yield Object(s["postDict"])({type:"technology",data:this.ftechnology.form,class:"technology",key:this.ftechnology.form.code});if(e)return this.$baseMessage(e,"error","dgiot-hey-message-error"),void(this.loadingConfig=!1);this.fetechData()}catch(e){console.log(e),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+e,"error","dgiot-hey-message-error")}else yield Object(s["putDict"])(this.ftechnology.objectId,{data:this.ftechnology.form}),this.$baseMessage("数据更新成功","success","dgiot-hey-message-success");this.ftechnology.dialogVisible=!1,setTimeout(()=>{this.loadingConfig=!1},1200)}))},resetForm(e){this.$refs[e].resetFields()},fetechData(e){return p(this,null,(function*(){this.loadingConfig=!0;const e={where:{type:"technology"},skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt"};try{const{results:t=[],count:a}=yield Object(s["queryDict"])(e);this.list=t,this.total=a}catch(t){console.log(t),this.$baseMessage(this.$translateTitle("alert.Data request error")+""+t,"error","dgiot-hey-message-error")}setTimeout(()=>{this.loadingConfig=!1},100)}))},handleQuery(){return p(this,null,(function*(){this.loadingConfig=!0,this.queryForm.limit=8,yield this.fetechData()}))}}},f=h,g=(a("969d3"),a("2877")),b=Object(g["a"])(f,r,i,!1,null,"78a718d8",null);t["default"]=b.exports},"773d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[r("div",{staticClass:"dialog"},[r("el-dialog",{attrs:{"append-to-body":"",title:e.properties.types||"新增主数据: "+e.properties.title,visible:e.formDialog},on:{"update:visible":function(t){e.formDialog=t},close:e.closeDilog}},[r("div",{staticClass:"form"},[r("el-form",{key:e.properties.objectId,ref:"form",attrs:{"label-width":"auto","status-icon":""}},e._l(e.properties.data.properties,(function(t,a){return r("el-form-item",{key:a,attrs:{label:t.prop.label,rules:t.prop.rules}},[r("el-input",{model:{value:t.propertyValue,callback:function(a){e.$set(t,"propertyValue",a)},expression:"item.propertyValue"}})],1)})),1)],1),r("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.properties.types?"修改":"新增")+" ")])],1)])],1),r("el-row",[r("el-col",{attrs:{span:4}},[e._v(" 主数据列表: "),r("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.load,expression:"load"}],staticClass:"infinite-list",staticStyle:{height:"75vh",overflow:"scroll"},attrs:{"infinite-scroll-distance":50}},[r("el-row",{attrs:{gutter:24}},e._l(e.list,(function(t){return r("li",{key:t.objectId,staticClass:"infinite-list-item",staticStyle:{width:"90%"},on:{click:function(a){return e.queryItem(t)}}},[r("el-col",{attrs:{span:18}},[r("el-link",{attrs:{type:e.properties.objectId==t.objectId?"primary":"warning"}},[e._v(" "+e._s(t.title)+" ")])],1),r("el-col",{attrs:{span:4}},[r("el-button",{staticClass:"el-icon-edit",staticStyle:{float:"right"},attrs:{type:"text"},nativeOn:{click:function(a){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:t.objectId,type:"edit"}})}}})],1)],1)})),0)],1)]),r("el-col",{attrs:{span:20}},[r("dgiot-query-form",[r("dgiot-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"元数据名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),r("el-button",{attrs:{disabled:!e.properties.objectId,icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.showDiloog(e.properties)}}},[e._v(" 新增主数据 ")])],1)],1)],1),r("dgiot-query-form-right-panel",[r("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"},on:{click:e.clickFullScreen}},[r("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}}),e._v(" 表格全屏 ")],1),r("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[r("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[r("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[r("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tableSort",attrs:{border:e.border,data:e.MasterData,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":"拼命加载中",height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),r("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:t.label,prop:t.label,sortable:"",width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return[r("span",[e._v(e._s(i.data[t.prop]))])]}}],null,!0)})})),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,i=t.$index;return[r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.editItem(i,a,e.MasterData)}}},[e._v(" 编辑 ")]),r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.handleDelete(i,a,e.MasterData)}}},[e._v(" 删除 ")])]}}])})],2),r("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.MasterData.length,expression:"MasterData.length"}],attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),r("el-empty",{directives:[{name:"show",rawName:"v-show",value:!e.properties.data.properties,expression:"!properties.data.properties"}],attrs:{"image-size":e.height-200}})],1)],1),r("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},i=[],s=a("3248"),o=a("e0e9"),l=a("d292"),n=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),c={name:"Index",components:{TableEdit:s["default"]},props:{},data(){return{clickRow:{},MasterData:[],formDialog:!1,loading:!1,count:0,properties:[],drawerAdd:!1,infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",columns:[],checkList:[],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:20,name:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{closeDilog(){delete this.properties.types},submitForm(e){return n(this,null,(function*(){var e={data:{}};if(this.properties.data.properties.forEach(t=>{e.data[t.propertyCode]=t.propertyValue}),console.log(e),this.clickRow.objectId)yield Object(o["putDict"])(this.clickRow.objectId,{data:e.data});else{yield Object(o["postDict"])({data:e.data,type:this.properties.objectId+"metaData",class:"metaData",title:this.properties.title,key:"metaData:"+moment().format("x"),dict:{__type:"Pointer",className:"Dict",objectId:this.properties.objectId},parent:{__type:"Pointer",className:"Dict",objectId:this.properties.objectId}});this.total=this.total+1}this.queryItem(this.clickItem,!1),this.formDialog=!1}))},load(){this.count+=2},showDiloog(e){return n(this,null,(function*(){e.data.properties?(yield this.properties.data.properties.forEach(e=>{console.log(e),e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyValue=""}),console.log(this.properties.data.properties),this.formDialog=!0):yield this.$baseMessage("元数据暂无配置信息","info","dgiot-hey-message-error")}))},queryItem(e,t=!0){return n(this,null,(function*(){this.clickItem=e,this.loading=t,this.checkList=[],this.columns=[];const a=yield Object(o["getDict"])(e.objectId),{results:r=[],count:i=0}=yield Object(o["queryDict"])({skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",where:{parent:e.objectId}});console.log(r),this.total=i,this.MasterData=r,_.isEmpty(a.data.properties)||a.data.properties.forEach(e=>{e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyDesc&&(this.checkList.push(e.propertyDesc),this.columns.push({label:e.propertyDesc,width:"auto",prop:e.propertyCode,sortable:!0,disableCheck:!0})),e.propertyValue=""}),this.properties=a,setTimeout(()=>{this.loading=!1},300)}))},onSubmit(){console.log("submit!")},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleEdit(e){this.$refs["edit"].showEdit(e)},editItem(e,t){this.clickRow=t,this.properties.data.properties.forEach(e=>{e.prop={label:e.propertyDesc,prop:e.propertyCode,rules:{required:!0,message:e.propertyDesc+"不能为空",trigger:"blur"},data:{}},e[e.propertyCode]="",e.propertyValue=t.data[e.propertyCode]}),this.properties.types="修改主数据",this.formDialog=!0},handleDelete(e,t,a){this.$baseConfirm("你确定要删除当前项吗",null,()=>n(this,null,(function*(){yield Object(o["delDict"])(t.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),a.splice(e,1),this.total=this.total-1})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=0,this.queryForm.limit=20,this.fetchData()},masterTree(){return n(this,null,(function*(){const e={class:"Dict",filter:'{"keys":["parent","title"],"where":{"class":["metaData"]}}',parent:"parent"},t=yield Object(l["post_tree"])(e);console.log(t)}))},fetchData(){return n(this,null,(function*(){this.masterTree();const e={count:"objectId",order:"-createdAt",excludeKeys:"",where:{type:"metaData"}};this.queryForm.name&&(e.where.title={$regex:this.queryForm.name}),console.info(e);const{results:t}=yield Object(o["queryDict"])(e);this.list=t,t.length>0&&this.queryItem(t[0],!1)}))}}},u=c,d=(a("130a"),a("2877")),m=Object(d["a"])(u,r,i,!1,null,"b4a41646",null);t["default"]=m.exports},"7c1b":function(e,t,a){},"7cd2":function(e,t,a){},"7d07":function(e,t,a){},"806c":function(e,t,a){"use strict";a("32dc")},"824b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("dgiot-empty")],1)},i=[],s=a("f47e"),o=a("4f46"),l=a("bacb"),n=a("34f5"),c={name:"ChangeStep",components:{Step1:s["default"],Step2:o["default"],Step3:l["default"],Step4:n["default"]},props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data(){return{isStep:0}},mounted(){4==this.step&&(this.isStep=4),dgiotlog.log(this.step)},methods:{next(){this.isStep++>5&&(this.isStep=0)},handleSetStep(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("d0d8"),a("2877")),m=Object(d["a"])(u,r,i,!1,null,"3a21f9ea",null);t["default"]=m.exports},9065:function(e,t,a){"use strict";a("c8b7")},9276:function(e,t,a){},9402:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Restore"})},i=[],s={name:"Restore",data(){return{}},methods:{}},o=s,l=a("2877"),n=Object(l["a"])(o,r,i,!1,null,null,null);t["default"]=n.exports},"969d3":function(e,t,a){"use strict";a("f550")},"96ea":function(e,t,a){"use strict";a("ae2a")},"9876b":function(e,t,a){},"9c68":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[r("dgiot-query-form",[r("dgiot-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"元数据名称"},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.$router.push("/oc/MetaData/module")}}},[e._v(" 添加 ")])],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),r("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"元数据名称",prop:"title",sortable:"",width:"auto"}}),r("el-table-column",{attrs:{align:"center",label:"多版本管理",prop:"data.multiVersion",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("span",[e._v(" "+e._s("0"==a.data.multiVersion?"是":"否")+" ")])]}}])}),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:a.objectId,type:"edit"}})}}},[e._v(" 编辑 ")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],1),r("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),r("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},i=[],s=a("3248"),o=a("e0e9"),l=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{TableEdit:s["default"]},props:{},data(){return{drawerAdd:!1,infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["元数据名称","多版本管理","描述"],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{skip:0,limit:20,name:""}}},computed:{dragOptions(){return{animation:600,group:"description"}}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{onSubmit(){console.log("submit!")},clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){yield Object(o["delDict"])(e.objectId),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit),this.fetchData()},handleQuery(){this.queryForm.limit=0,this.queryForm.limit=20,this.fetchData()},fetchData(){return l(this,null,(function*(){const e={skip:this.queryForm.skip,limit:this.queryForm.limit,count:"objectId",order:"-createdAt",excludeKeys:"",where:{parent:"0",type:"metaData"}};this.queryForm.name&&(e.where.title={$regex:this.queryForm.name}),console.info(e),this.listLoading=!0;const{results:t,count:a}=yield Object(o["queryDict"])(e);this.list=t,this.total=a,this.listLoading=!1}))}}},c=n,u=(a("c16b5"),a("2877")),d=Object(u["a"])(c,r,i,!1,null,"15db98ce",null);t["default"]=d.exports},a0fe:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Generate"})},i=[],s={name:"Generate",data(){return{}},methods:{}},o=s,l=a("2877"),n=Object(l["a"])(o,r,i,!1,null,null,null);t["default"]=n.exports},a109:function(e,t,a){"use strict";a("a75c")},a75c:function(e,t,a){},a99f:function(e,t,a){"use strict";a("4aad6")},ae2a:function(e,t,a){},aea9:function(e,t,a){},b175:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=e.detail.status,expression:"detail.status != 3"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==r.status,expression:"row.status == 2"}],attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Evaluation"))+" ")])]}}])})],1),a("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),$={name:"EvaluationTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.showdeviceFlag=!1,this.fetchData())},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(u["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[this.currentDepartment.name]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),i=yield Object(s["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",i),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.showdeviceFlag=!0,this.set_deviceStep(r)},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(this.$translateTitle("node.export error")+""+e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("da5a"),a("2877")),F=Object(x["a"])(k,r,i,!1,null,"d958308c",null);t["default"]=F.exports},ba41:function(e,t,a){"use strict";a("e872")},bacb:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[e.form.info.step3.Remarks?a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Evaluation description")+": "}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step3.Remarks,callback:function(t){e.$set(e.form.info.step3,"Remarks",t)},expression:"form.info.step3.Remarks"}})],1):e._e()],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},i=[],s=a("ce31"),o=a("8665"),l=a("5880"),n=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,h=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))m.call(t,a)&&h(e,a,t[a]);if(d)for(var a of d(t))p.call(t,a)&&h(e,a,t[a]);return e},g=(e,t)=>c(e,u(t)),b=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),y={props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1}},data(){return{reverse:!0,activeName:"first",form:this.detail}},computed:f({},Object(l["mapGetters"])({username:"user/username"})),mounted(){this.featUser()},methods:g(f({},Object(l["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{featUser(){return b(this,null,(function*(){const{results:e}=yield Object(o["queryUser"])({});this.user=e}))},dispatchUser(){this.$refs["form"].validate(e=>b(this,null,(function*(){if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const{objectId:e,info:t,number:a=""}=this.form;t.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已结单",p:this.username+" 已结束这条工单"}),this.$dgiotBus.$emit("MqttPublish","/workOrderCompletion/up",JSON.stringify({id:a}),0,!1);const r={status:3,info:t},i=yield Object(s["update_object"])("Maintenance",e,r);i.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},v=y,w=(a("f9fc"),a("2877")),_=Object(w["a"])(v,r,i,!1,null,"277f66ab",null);t["default"]=_.exports},bd5f:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("change-step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(0)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,height:e.height,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.showInfo(r,!0,!0)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])]}}])})],1),a("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),$={name:"ProcessTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&(this.fetchData(),this.showdeviceFlag=!1)},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){dgiotlog.log("e",e.file);let t={headers:{proxy:!0,produrl:"/",devurl:"iotapi/"}};Object(u["UploadImg"])(e.file,t).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),i=yield Object(s["create_object"])("Maintenance",a);r.close(),dgiotlog.log("res",i),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e){return this.$translateTitle("Maintenance.Assigned")},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&(this.set_deviceStep(-1),this.showdeviceFlag=!1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&(this.set_deviceStep(-1),this.showdeviceFlag=!1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("3b5e"),a("2877")),F=Object(x["a"])(k,r,i,!1,null,"d176df0c",null);t["default"]=F.exports},c06c:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"index-container"},[a("empty")],1)},i=[],s=a("43b8"),o={name:"Index",components:{empty:s["default"]},props:{},data(){return{}},computed:{},watch:{},created(){},mounted(){},destroyed(){},methods:{}},l=o,n=(a("ba41"),a("2877")),c=Object(n["a"])(l,r,i,!1,null,"7dc3f72f",null);t["default"]=c.exports},c16b5:function(e,t,a){"use strict";a("3845")},c505:function(e,t,a){},c559:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"CloudOT-container"},[a("div",{staticClass:"CloudOT-content"},[e._v(" "+e._s(e.infoData)+" ")])])},i=[],s={name:"CloudOT",components:{},data(){return{infoData:"CloudOT"}},computed:{},mounted(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},beforeDestroy(){},destroyed(){},activated(){},methods:{}},o=s,l=(a("a109"),a("2877")),n=Object(l["a"])(o,r,i,!1,null,"1f287615",null);t["default"]=n.exports},c6b1:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("div",{staticClass:"home_dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.showdeviceFlag,width:"100vh"},on:{"update:visible":function(t){e.showdeviceFlag=t}}},[a("Change-Step",{ref:"ChangeStep",attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status,expression:"detail.status == 0"}],on:{click:function(t){return e.set_deviceStep(-1)}}},[e._v(" "+e._s(e.$translateTitle("developer.cancel"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0==e.detail.status&&e.isfooter,expression:"detail.status == 0 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dispatch()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Dispatch"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status,expression:"detail.status == 1"}],on:{click:function(t){return e.backChange(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.back"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.Reassign(e.detail)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reassign"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.detail.status&&e.isfooter,expression:"detail.status == 2 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.check()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.check"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.detail.status&&e.isfooter,expression:"detail.status == 1 && isfooter"}],attrs:{type:"primary"},on:{click:function(t){return e.dealwith()}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.deal with"))+" ")])],1)],1),a("el-dialog",{attrs:{"append-to-body":!0,title:e.$translateTitle("Maintenance.create Ticket"),visible:e.dialogFormVisible,width:"90vh"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project"),prop:"product"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$translateTitle("Maintenance.Please choose the product")},on:{change:e.prodChange},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name"),prop:"name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.Device.length,placeholder:0==e.Device.length?e.$translateTitle("Maintenance.Please choose the product"):e.$translateTitle("Maintenance.Please select a device")},on:{change:e.deviceChange},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},e._l(e.Device,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.objectId,expression:"item.objectId"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type"),prop:"type"}},[a("el-input",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")}},[a("el-upload",{attrs:{action:"#","auto-upload":!0,"http-request":e.myUpload,"list-type":"picture-card"}},[a("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._l(e.form.photo,(function(e,t){return a("div",{key:t},[a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{alt:"",src:e.url}})])}))],2),a("el-dialog",{attrs:{"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("img",{attrs:{alt:"",src:e.dialogImageUrl,width:"100%"}})])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.submitForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Create now"))+" ")]),a("el-button",{on:{click:function(t){return e.resetForm("form")}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reset"))+" ")])],1)],1)],1)]),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.projects")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.type")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",size:"mini",type:"primary"},on:{click:e.fetchData}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"mini",type:"primary"},on:{click:function(t){e.dialogFormVisible=!e.dialogFormVisible}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.create Ticket"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-s-promotion",size:"mini",type:"primary"},on:{click:function(t){return e.batchExport(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:"",data:e.list,stripe:""},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status,a))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:e.$translateTitle("Maintenance.operating"),width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showInfo(r,!0,!1)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3!=r.status,expression:"row.status != 3"}],attrs:{disabled:0!=r.status,size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r,2)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("dgiot-Pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("dcc6"),l=a("1285"),n=a("5880"),c=a("824b"),u=a("1267"),d=Object.defineProperty,m=Object.defineProperties,p=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,b=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))f.call(t,a)&&b(e,a,t[a]);if(h)for(var a of h(t))g.call(t,a)&&b(e,a,t[a]);return e},v=(e,t)=>m(e,p(t)),w=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),$={name:"CreateTicket",components:{ChangeStep:c["default"]},data(){return{showdeviceFlag:!1,created:0,Assigned:0,form:{receiveuseid:"",productname:"",devicename:"",createdname:"",receiveusername:"",receiveuserphone:"",name:"",product:"",type:"",description:"",photo:[],objectId:""},dialogFormVisible:!1,fold:!1,step:1,ishard:!1,height:this.$baseTableHeight(0)-30,isfooter:!0,detail:{},AllDevice:[],selectedList:[],types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择所属项目",trigger:"change"}],name:[{required:!0,message:"请选择设备",trigger:"change"}],type:[{required:!0,message:"请输入工单类型",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,status:[{key:0,text:"Maintenance.To be assigned"},{key:1,text:"Maintenance.Assigned"},{key:2,text:"Maintenance.Processed"},{key:3,text:"Maintenance.Statement"}],queryForm:{devicename:"",statusFlag:!1,status:"",number:"",product:"",type:"",pageNo:1,pageSize:20,searchDate:[],limt:10,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:v(y({},Object(n["mapGetters"])({_Product:"user/_Product",objectid:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{_deviceStep:{get(){return dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep),this.$store.state.global._deviceStep},set(e){dgiotlog.log("this.$store.state.global._deviceStep",this.$store.state.global._deviceStep,e),this.set_deviceStep(e)}},aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),watch:{_deviceStep:function(e){dgiotlog.log(e),-1==e&&this.fetchData()},"queryForm.status":function(e){dgiotlog.log(e),this.queryForm.statusFlag=""!=e}},created(){console.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.aclObj",this.aclObj)},mounted(){this.handleCreated("created")},methods:v(y({myUpload(e){const t=e.file;let a=t.name.substring(t.name.lastIndexOf(".")+1);const r={file:t,path:"ticket",filename:`ticket${moment().format("x")}.${a}`};dgiotlog.log("extension",r),Object(u["UploadImg"])(r).then(e=>{e.data.url?(this.form.photo.push(e.data.url),dgiotlog.log("上传成功的回调",e.data.url,this.form.photo)):dgiotlog.log("no up url ",e)}).catch(e=>{dgiotlog.log("出错了",e)})},submitForm(e){this.$refs[e].validate(e=>{if(!e)return dgiotlog.log("error submit!!"),!1;this.createdTicket(this.form)})},createdTicket(e){return w(this,null,(function*(){const t={};t[this.objectid]={read:!0,write:!0},t[""+("role:"+this.currentDepartment.name)]={read:!0,write:!0};const a={number:moment(new Date).unix()+"",type:e.type,status:0,ACL:_.merge(t,this.aclObj),info:{photo:e.photo,timeline:[{timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"生成工单",p:this.username+"新建工单"}],description:e.description,step1:{},step2:{},step3:{},step4:{},productid:e.product,productname:e.productname,devicename:e.devicename,deviceid:e.name,createdname:this.username,receiveusername:e.receiveusername,receiveuseid:e.receiveuseid,receiveuserphone:e.receiveuserphone},device:{objectId:e.name,__type:"Pointer",className:"Device"}},r=this.$baseColorfullLoading(),i=yield Object(s["create_object"])("Maintenance",a);this.set_deviceStep(-1),r.close(),dgiotlog.log("res",i),this.fetchData(),this.dialogFormVisible=!1}))},resetForm(e){this.$refs[e].resetFields()},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)}},Object(n["mapMutations"])({set_deviceStep:"global/set_deviceStep"})),{handleFold(){this.fold=!this.fold,this.handleHeight()},batchExport(e){return w(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(u["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},handleDelete(e,t){let a=[];2==t?a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}}):e.forEach(e=>{a.push({method:"DELETE",path:"/classes/Maintenance/"+e.objectId,body:{}})}),dgiotlog.log(a,"batchParams"),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>w(this,null,(function*(){yield Object(o["batch"])(a);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleHeight(){this.fold?this.height=this.$baseTableHeight(0)-20:this.height=this.$baseTableHeight(0)-30},getStatus(e=0){switch(e){case 0:return this.$translateTitle("Maintenance.To be assigned");case 1:return this.$translateTitle("Maintenance.Assigned");case 2:return this.$translateTitle("Maintenance.Processed");case 3:return this.$translateTitle("Maintenance.Statement");default:return e}},showInfo(e,t=!1,a=!0){this.showdeviceFlag=!1,dgiotlog.log("row",e.status),this.ishard=t,this.isfooter=a;let{status:r=0}=e;this.detail=e,this.step=r+1,this.set_deviceStep(r),this.showdeviceFlag=!0},handleCreated(e){"created"==e?this.created++:this.Assigned++,this.fetchData()},fetchData(){return w(this,arguments,(function*(e={}){var t;dgiotlog.log(this.created%2,this.created,"this.created"),e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.Assigned%2==0&&(r.where["info.receiveuseid"]=this.objectid),this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(0)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return w(this,null,(function*(){dgiotlog.log(e),this.Device=[],this._Product.map(t=>{t.objectId==e&&(this.form.productname=t.name)}),this.form.name="";const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},deviceChange(e){this.Device.map(t=>{t.objectId==e&&(this.form.devicename=t.name)}),dgiotlog.log(this.form.productname,this.form.devicename)},dispatch(){this.$refs.ChangeStep.$refs.step1.dispatchUser()},backChange(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已回退",p:this.username+" 回退了流程"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},Reassign(e){return w(this,null,(function*(){const{objectId:t,info:a}=e;a.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已改派",p:this.username+" 改派了工单"});const r={status:0,info:a};dgiotlog.log(t,r);const i=yield Object(s["update_object"])("Maintenance",t,r);i.updatedAt&&this.set_deviceStep(-1)}))},dealwith(){this.$refs.ChangeStep.$refs.step2.dispatchUser()},check(){this.$refs.ChangeStep.$refs.step3.dispatchUser()}})},k=$,x=(a("db7d"),a("2877")),F=Object(x["a"])(k,r,i,!1,null,"1bcf87bd",null);t["default"]=F.exports},c81c:function(e,t,a){"use strict";a("3d3e")},c8b7:function(e,t,a){},d0d8:function(e,t,a){"use strict";a("aea9")},da5a:function(e,t,a){"use strict";a("9876b")},dae2:function(e,t,a){"use strict";a("2144")},db7d:function(e,t,a){"use strict";a("c505")},e207:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"custom-table",staticClass:"index-container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",class:{"dgiot-fullscreen":e.isFullscreen},attrs:{"label-position":"top","label-width":"160px",model:e.ruleForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"元数据名称",prop:"name"}},[a("el-input",{attrs:{readonly:"edit"==e.$route.query.type},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"多版本管理",prop:"multiVersion"}},[a("el-radio-group",{model:{value:e.ruleForm.multiVersion,callback:function(t){e.$set(e.ruleForm,"multiVersion",t)},expression:"ruleForm.multiVersion"}},[a("el-radio",{attrs:{label:1}},[e._v("需要")]),a("el-radio",{attrs:{label:0}},[e._v("不需要")])],1)],1),a("el-form-item",{attrs:{label:"元数据描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),a("el-form-item",{attrs:{label:"唯一标识定义层级关系",prop:"prefixNested"}},[a("el-radio",{attrs:{label:!0},model:{value:e.ruleForm.prefixNested,callback:function(t){e.$set(e.ruleForm,"prefixNested",t)},expression:"ruleForm.prefixNested"}},[e._v("需要")]),a("el-radio",{attrs:{label:!1},model:{value:e.ruleForm.prefixNested,callback:function(t){e.$set(e.ruleForm,"prefixNested",t)},expression:"ruleForm.prefixNested"}},[e._v(" 不需要 ")])],1),a("el-form-item",{attrs:{label:"数据字典",prop:"properties",type:"primary"}},[a("el-card",[a("dgiot-query-form",[a("dgiot-query-form-left-panel",[a("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.ruleForm.properties.push({propertyDesc:"",propertyCode:"",propertyType:"",isNull:!1,display:!0,isUnique:!1,array:!1,defaultValue:"",propertyLimit:{},propertyIndex:0,queryCondition:!1})}}},[e._v(" 添加数据 ")])],1)],1)],1),a("dgiot-query-form-right-panel",[a("el-button",{staticClass:"el-icon-edit",attrs:{type:"edit"!==e.$route.query.type?"primary":"info"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" "+e._s("edit"!==e.$route.query.type?"立即创建":"修改")+" ")]),a("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[a("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[a("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[a("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),a("el-table",{ref:"tableSort",attrs:{border:e.border,data:e.ruleForm.properties,stripe:e.stripe}},[a("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,r){return a("el-table-column",{key:r,attrs:{align:"center",label:t.label,sortable:"",width:t.width},scopedSlots:e._u([{key:"default",fn:function(r){var i=r.row;return[e.$lodash.isBoolean(i[t.prop])?a("el-switch",{model:{value:i[t.prop],callback:function(a){e.$set(i,t.prop,a)},expression:"row[item.prop]"}}):"propertyType"===t.prop?a("el-select",{attrs:{"allow-create":"",filterable:"",placeholder:"请选择"},model:{value:i[t.prop],callback:function(a){e.$set(i,t.prop,a)},expression:"row[item.prop]"}},e._l(e.dataTypes,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1):a("el-input",{model:{value:i[t.prop],callback:function(a){e.$set(i,t.prop,a)},expression:"row[item.prop]"}})]}}],null,!0)})})),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,i=t.$index;return[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(r)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return t.preventDefault(),e.handleDelete(i,e.ruleForm.properties)}}},[e._v(" 删除 ")])]}}])})],2)],1)],1)],1),a("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},i=[],s=a("5880"),o=a("e0e9"),l=a("f0d6"),n=a("22f9"),c=Object.defineProperty,u=Object.defineProperties,d=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t)=>u(e,d(t)),y=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),v={name:"Index",components:{TableEdit:l["default"]},props:{dataTypes:{type:Array,required:!1,default(){return["int32","float","double","enum","bool","text","date","struct","array"]}}},data(){return{ruleForm:{name:"",description:"",multiVersion:1,properties:[{propertyDesc:"",propertyCode:"",propertyType:"",isNull:!1,display:!0,isUnique:!1,array:!1,defaultValue:"",propertyLimit:{},propertyIndex:0,queryCondition:!1}],prefixNested:!1},rules:{name:[{required:!0,message:"请输入元数据名称",trigger:"blur"},{min:1,max:32,message:"长度在 1 到 32 个字符",trigger:"blur"}],multiVersion:[{required:!0,message:"请选择多版本管理",trigger:"change"}],description:[{required:!1,message:"请输入元数据描述",trigger:"blur"}],prefixNested:[{required:!0,message:"请选择是否需要唯一标识定义层级关系",trigger:"change"}]},infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["属性名称","属性类型","属性标识","唯一标识","是否必填","显示属性","查询属性","多值"],columns:[{label:"属性名称",width:"auto",prop:"propertyDesc",sortable:!0,disableCheck:!0},{label:"属性类型",width:"auto",prop:"propertyType",sortable:!0},{label:"属性标识",width:"200",prop:"propertyCode",sortable:!0},{label:"唯一标识",width:"auto",prop:"isUnique",sortable:!0},{label:"显示属性",width:"auto",prop:"display",sortable:!0},{label:"是否必填",width:"auto",prop:"isNull",sortable:!0},{label:"多值",width:"auto",prop:"array",sortable:!0}],list:[],imageList:[],listLoading:!!this.$route.query.objectId,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.featUnit(),this.$route.query.objectId&&this.fetchData()},mounted(){},destroyed(){},methods:b(g({},Object(s["mapActions"])({delVisitedRoute:"tabs/delVisitedRoute"})),{featUnit(){return y(this,null,(function*(){const{UnifyUnitSpecsDTO:e=[]}=yield Object(n["getDlinkJson"])("Unit");console.info(e)}))},handleEdit(e){this.$refs["edit"].showEdit(e)},submitForm(e){this.$refs[e].validate(t=>y(this,null,(function*(){if(!t)return console.log("error submit!!"),!1;{const t=this[e],a={data:t,type:"metaData",class:"metaData",title:this.ruleForm.name,key:this.ruleForm.name,parent:{__type:"Pointer",className:"Dict",objectId:"0"}};delete a.data.objectId,this.$route.query.objectId?yield Object(o["putDict"])(this.$route.query.objectId,a):yield Object(o["postDict"])(a),this.$router.go(-1)}})))},fetchData(){return y(this,null,(function*(){const e=this.$route.query.objectId;document.title=document.title.replace("新建","修改");const t=this.$baseColorfullLoading(2),a=yield Object(o["getDict"])(e);t.close(),delete a.createdAt,delete a.updatedAt,this.ruleForm=a.data}))},handleDelete(e,t){return y(this,null,(function*(){this.$baseConfirm("你确定要删除当前项吗",null,()=>y(this,null,(function*(){t.splice(e,1),this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success")})))}))}})},w=v,_=(a("fb07"),a("2877")),$=Object(_["a"])(w,r,i,!1,null,"156d05a8",null);t["default"]=$.exports},e49b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{attrs:{"append-to-body":!0,title:e.detail.name,visible:e.deviceFlag,width:"100vh"},on:{"update:visible":function(t){e.deviceFlag=t}}},[a("change-info",{attrs:{detail:e.detail,"show-footer":e.isfooter,"show-hard":e.ishard,step:e.step}})],1)],1),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket number")}},[a("el-input",{attrs:{clearable:"",placeholder:e.$translateTitle("Maintenance.Ticket number")},model:{value:e.queryForm.number,callback:function(t){e.$set(e.queryForm,"number","string"===typeof t?t.trim():t)},expression:"queryForm.number"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")}},[a("el-select",{attrs:{placeholder:e.$translateTitle("Maintenance.project")},model:{value:e.queryForm.product,callback:function(t){e.$set(e.queryForm,"product",t)},expression:"queryForm.product"}},e._l(e._Product,(function(e,t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:0!=e.objectId,expression:"item.objectId != 0"}],key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket type")}},[a("el-input",{attrs:{placeholder:e.$translateTitle("Maintenance.Ticket type")},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.the starting time")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")]),a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-folder-checked",type:"primary"},on:{click:function(t){return e.Export(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Export"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,height:e.height},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket number"),prop:"number","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket type"),prop:"type","show-overflow-tooltip":"",sortable:"",width:"140"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Ticket status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.getStatus(a.status))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.project"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.productname?a.info.productname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Equipment name"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.devicename?a.info.devicename:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.Initiator"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(a.info&&a.info.createdname?a.info.createdname:"")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.the starting time"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.showInfo(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")])]}}])})],1),a("DgiotPagination",{directives:[{name:"show",rawName:"v-show",value:e.total,expression:"total"}],attrs:{limit:e.queryForm.pageSize,page:e.queryForm.pageNo,total:e.total},on:{"update:limit":function(t){return e.$set(e.queryForm,"pageSize",t)},"update:page":function(t){return e.$set(e.queryForm,"pageNo",t)},pagination:e.fetchData}})],1)},i=[],s=a("ce31"),o=a("1267"),l=a("1285"),n=a("e915"),c=a("5880"),u=Object.defineProperty,d=Object.defineProperties,m=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,g=(e,t,a)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,b=(e,t)=>{for(var a in t||(t={}))h.call(t,a)&&g(e,a,t[a]);if(p)for(var a of p(t))f.call(t,a)&&g(e,a,t[a]);return e},y=(e,t)=>d(e,m(t)),v=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),w={name:"Index",components:{ChangeInfo:n["default"]},data(){return{selectedList:[],ishard:!0,isfooter:!1,step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{number:"",product:"",type:"",searchDate:[],limit:20,skip:0,order:"-createdAt",keys:"count(*)"}}},computed:y(b({},Object(c["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),{aclObj(){let e={};return this.role.map(t=>{dgiotlog.log(t.name,""),e[""+("role:"+t.name)]={read:!0,write:!0}}),e}}),created(){dgiotlog.log(this._Product,"_Product"),dgiotlog.log("role",this.role),dgiotlog.log("this.height",this.height)},mounted(){this.fetchData()},methods:{changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},Export(e){return v(this,null,(function*(){dgiotlog.log(e);try{const t={results:[]};t["results"]=e;const a=yield Object(o["exlout"])(t);this.$convertRes2Blob(a),this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("node.export success"),type:"success"})}catch(t){dgiotlog.log(t),this.$baseMessage(this.$translateTitle("node.export error")+""+t,"error","dgiot-hey-message-error")}}))},showInfo(e){this.ishard=!0,this.isfooter=!1;let{status:t=0}=e;dgiotlog.log("row",e),this.detail=e,this.step=t+1,this.deviceFlag=!0},getStatus(e=0){switch(e){case 0:return"待分配";case 1:return"已分配";case 2:return"已处理";case 3:return"已结单";default:return e}},fetchData(){return v(this,arguments,(function*(e={}){var t;e.limit||(e=this.queryForm),dgiotlog.log(this.queryForm,"queryForm",e),this.listLoading=!1;const a=this.$baseColorfullLoading();let r={limit:e.limit,order:e.order,skip:e.skip,keys:e.keys,where:{}};this.queryForm.number&&(r.where.number={$regex:this.queryForm.number}),this.queryForm.product&&(r.where["info.productid"]={$regex:this.queryForm.product}),this.queryForm.type&&(r.where.type={$regex:this.queryForm.type}),(null==(t=this.queryForm.searchDate)?void 0:t.length)&&(r.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]}},r.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]}}),yield Object(s["query_object"])("Maintenance",r).then(e=>{dgiotlog.log(e,"res");const{results:t=[],count:r=0}=e;this.list=t,this.list.forEach(e=>{if(e._user="暂无",e.ACL)for(var t in e.ACL)e._user=t.substr(5)}),this.total=r,a.close()}).catch(e=>{this.$baseMessage(this.$translateTitle("node.export error")+""+e,"error","dgiot-hey-message-error"),a.close()}),dgiotlog.log(this.list,"this.list")}))},prodChange(e){return v(this,null,(function*(){this.Device=[];const t={where:{product:e}},{results:a}=yield Object(l["queryDevice"])(t);dgiotlog.log(a,"设备"),this.Device=a}))},handleRemove(e){this.form.photo.forEach((t,a)=>{t.split("/")[""+(t.split("/").length-1)]==e.name&&this.form.photo.splice(a,1)}),dgiotlog.log(this.form.photo)},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},_=w,$=(a("6da9"),a("2877")),k=Object($["a"])(_,r,i,!1,null,"563c88c3",null);t["default"]=k.exports},e80c:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"detail-container"},[r("div",{staticClass:"detail"},[r("div",{staticClass:"in_top"},[r("div",{staticClass:"top_name"},[e._v(e._s(e.name))]),r("div",{staticClass:"top_btn"},[r("el-button",[e._v("归档")]),r("el-button",{attrs:{type:"warning"}},[e._v("发布")]),r("el-button",[e._v("删除")]),r("el-button",[e._v("编辑")])],1)]),r("div",{staticClass:"in_ctr"},[e._v("工厂编码: "+e._s(e.objectid))]),r("div",{staticClass:"in_btm"},[r("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"车间属性",name:"first"}},[r("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"warning"},on:{click:e.openCreatePlant}},[e._v(" 新增车间 ")]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",label:"车间名称",prop:"name","show-overflow-tooltip":"",width:"200"}}),r("el-table-column",{attrs:{align:"center",label:"车间编码",prop:"code","show-overflow-tooltip":"",width:"200"}}),r("el-table-column",{attrs:{align:"center",label:"状态",prop:"status","show-overflow-tooltip":"",width:"200"}}),r("el-table-column",{attrs:{align:"center",label:"车间描述",prop:"desc","show-overflow-tooltip":"",width:"300"}}),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},nativeOn:{click:function(t){return e.$router.push({path:"/oc/MetaData/module",query:{objectId:a.objectId,type:"edit"}})}}},[e._v(" 编辑 ")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v(" 删除 ")])]}}])})],1),r("el-pagination",{attrs:{background:"","current-page":e.queryForm.size,layout:e.layout,"page-size":e.queryForm.limit,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),r("el-tab-pane",{attrs:{label:"属性列表",name:"second"}},[e._v("配置管理")])],1)],1)]),r("el-dialog",{attrs:{"append-to-body":!0,direction:e.direction,height:"60%",title:"新增工厂",visible:e.drawer,width:"30%"},on:{"update:visible":function(t){e.drawer=t}}},[r("div",{staticClass:"demo-drawer__content"},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[r("el-form-item",{attrs:{label:"工厂名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入工厂名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"岗位",prop:"tempname"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择岗位"},model:{value:e.form.tempname,callback:function(t){e.$set(e.form,"tempname",t)},expression:"form.tempname"}},e._l(e.dict,(function(e){return r("el-option",{key:e.objectId,attrs:{label:e.key,value:e.key}})})),1)],1),r("el-form-item",{attrs:{label:"工厂描述"}},[r("el-input",{attrs:{maxlength:"500",placeholder:"不超过500个字符","show-word-limit":"",type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 立即创建 ")]),r("el-button",{on:{click:e.openCreatePlant}},[e._v("取消")])],1)],1)],1)])],1)},i=[],s=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),o={name:"Detail",components:{},props:{},data(){return{name:"",objectid:"",border:!0,height:this.$baseTableHeight(0)-100,stripe:!0,lineHeight:"mini",plantlist:[],activeName:"first",drawer:!1,parent:"",direction:"rtl",dict:[],wrapclose:!1,form:{name:"",tempname:"",desc:""},rules:{name:[{required:!0,message:"请输入工厂名称",trigger:"blur"},{min:2,max:50,message:"长度在 3 到 50 个字符",trigger:"blur"}],tempname:[{required:!0,message:"请选择岗位",trigger:"blur"}]},queryForm:{skip:0,limit:20,name:""}}},computed:{},watch:{},created(){const{name:e,objectid:t}=this.$route.query;this.name=e,this.objectid=t,console.log("name",e,t)},mounted(){},destroyed(){},methods:{handleSizeChange(e){this.queryForm.limit=e},handleCurrentChange(e){this.queryForm.skip=Number(e-1)*Number(this.queryForm.limit)},handleClick(e,t){console.log(e,t)},getDict(){return s(this,null,(function*(){const e={where:{type:"roletemp"}},{results:t}=yield queryDictTemp(e);console.log("模板",t),this.dict=t}))},fetchData(){return s(this,null,(function*(){const{results:e}=yield queryRoleTree();this.plantlist=e[0].children,this.parent=e[0].objectId}))},modelToDetail(e){console.log(e),this.$router.push({path:"/oc/Modeling/modeldetail",query:{objectid:e.objectId,name:e.name}})},openCreatePlant(){this.form={name:"",tempname:"",desc:""},this.drawer=!this.drawer},submitForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;{const e={depname:this.form.name,desc:this.form.desc,name:this.form.name,parent:this.parent,tempname:this.form.tempname};console.log("部门",e),postRole(e).then(e=>{console.log("result",e),this.fetchData(),this.drawer=!this.drawer})}})}}},l=o,n=(a("5745"),a("2877")),c=Object(n["a"])(l,r,i,!1,null,"eeee42fa",null);t["default"]=c.exports},e872:function(e,t,a){},e915:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.detail?a("div",{staticClass:"changeInfo"},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"row-bg",attrs:{justify:"space-around",type:"flex"}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket number"))+" : "+e._s(e.detail.number)+" ")])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"grid-content bg-purple-light"},[e._v(" "+e._s(e.$translateTitle("Maintenance.Ticket type"))+" : "+e._s(e.detail.type)+" ")])]),a("el-col",{attrs:{span:7}},[a("div",{staticClass:"grid-content bg-purple"},[e._v(" "+e._s(e.$translateTitle("Maintenance.the starting time"))+" : "+e._s(e.$moment(e.detail.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")])])],1),a("el-steps",{directives:[{name:"show",rawName:"v-show",value:1==e.showHard,expression:"showHard == true"}],staticClass:"steps",attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:e.$translateTitle("Maintenance.To be assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Assigned")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Processed")}}),a("el-step",{attrs:{title:e.$translateTitle("Maintenance.Statement")}})],1),1===e.step?a("step1",{ref:"step1",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":e.showHard,step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),2===e.step?a("step2",{ref:"step2",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),3===e.step?a("step3",{ref:"step3",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e(),4===e.step?a("Step4",{ref:"step4",attrs:{detail:e.detail,"show-footer":e.showFooter,"show-hard":"showHard",step:e.step},on:{"change-step":e.handleSetStep}}):e._e()],1):a("div",{staticClass:"empty"},[a("dgiot-empty")],1)},i=[],s=a("f47e"),o=a("4f46"),l=a("bacb"),n=a("34f5"),c={name:"ChangeInfo",components:{Step1:s["default"],Step2:o["default"],Step3:l["default"],Step4:n["default"]},props:{detail:{type:Object,default:()=>{}},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1},step:{type:Number,default:1}},data(){return{isStep:0}},mounted(){4==this.step&&(this.isStep=4),dgiotlog.log(this.step)},methods:{next(){this.isStep++>5&&(this.isStep=0)},handleSetStep(e,t){t&&(this.form=Object.assign(this.form,t))}}},u=c,d=(a("6f07"),a("2877")),m=Object(d["a"])(u,r,i,!1,null,"0c7079ac",null);t["default"]=m.exports},f0d6:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"append-to-body":!0,title:e.title,visible:e.dialogFormVisible,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{on:{click:e.close}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.save.apply(null,arguments)}}},[e._v("确 定")])]},proxy:!0}])},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"标题",prop:"title"}},[a("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title","string"===typeof t?t.trim():t)},expression:"form.title"}})],1),a("el-form-item",{attrs:{label:"作者",prop:"author"}},[a("el-input",{model:{value:e.form.author,callback:function(t){e.$set(e.form,"author","string"===typeof t?t.trim():t)},expression:"form.author"}})],1)],1)],1)},i=[],s=a("8456"),o=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),l={name:"TableEdit",data(){return{form:{title:"",author:""},rules:{title:[{required:!0,trigger:"blur",message:"请输入标题"}],author:[{required:!0,trigger:"blur",message:"请输入作者"}]},title:"",dialogFormVisible:!1}},created(){},methods:{showEdit(e){e?(this.title="编辑",this.form=Object.assign({},e)):this.title="添加",this.dialogFormVisible=!0},close(){this.$refs["form"].resetFields(),this.form=this.$options.data().form,this.dialogFormVisible=!1},save(){this.$refs["form"].validate(e=>o(this,null,(function*(){if(e){const{msg:e}=yield Object(s["doEdit"])(this.form);this.$baseMessage(e,"success","dgiot-hey-message-success"),this.$emit("fetch-data"),this.close()}})))}}},n=l,c=a("2877"),u=Object(c["a"])(n,r,i,!1,null,null,null);t["default"]=u.exports},f2b6:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mycontainer"},[a("div",{staticClass:"ticker-dialog"},[a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.parserView},on:{"update:visible":function(t){e.parserView=t}}},[a("ele-form",e._b({attrs:{config:e.formConfig,pure:"","request-fn":e.handleSubmit},on:{"request-success":function(t){return e.handleSuccess(e.alertConfig)}},model:{value:e.alertConfig.config,callback:function(t){e.$set(e.alertConfig,"config",t)},expression:"alertConfig.config"}},"ele-form",e.alertConfig.config,!1))],1),a("el-dialog",{directives:[{name:"drag",rawName:"v-drag"}],attrs:{"append-to-body":!0,visible:e.dynamicformView,width:"50vh"},on:{"update:visible":function(t){e.dynamicformView=t}}},[a("el-form",[a("el-form-item",{attrs:{label:"产品名称","label-width":"200"}},[a("span",[e._v(e._s(e.editRow.productname))])]),a("el-form-item",{attrs:{label:"设备编号","label-width":"200"}},[a("span",[e._v(e._s(e.devicename))])])],1),a("dgiot-amis",{attrs:{schema:e.amisData,"show-help":!1}})],1)],1),a("dgiot-query-form",{staticClass:"query-form"},[a("dgiot-query-form-top-panel",[a("el-form",{attrs:{inline:!0,"label-width":"auto",model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$translateTitle("alert.productname")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("equipment.entername")},model:{value:e.queryForm.productName,callback:function(t){e.$set(e.queryForm,"productName",t)},expression:"queryForm.productName"}},e._l(e._Product,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.objectId}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("alert.isprocess")}},[a("el-select",{attrs:{clearable:"",placeholder:e.$translateTitle("alert.isprocess")},model:{value:e.queryForm.isprocess,callback:function(t){e.$set(e.queryForm,"isprocess",t)},expression:"queryForm.isprocess"}},e._l(e.processAll,(function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.times")}},[a("el-date-picker",{attrs:{"end-placeholder":e.$translateTitle("Maintenance.end time"),format:"yyyy-MM-dd","start-placeholder":e.$translateTitle("Maintenance.start time"),type:"daterange","value-format":"yyyy-MM-dd"},model:{value:e.queryForm.searchDate,callback:function(t){e.$set(e.queryForm,"searchDate",t)},expression:"queryForm.searchDate"}})],1),a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-search",type:"primary"},nativeOn:{click:function(t){return e.fetchData.apply(null,arguments)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.search"))+" ")])],1),a("el-form-item",[a("el-button",{attrs:{disabled:!e.selectedList.length,icon:"el-icon-delete",type:"danger"},on:{click:function(t){return e.fetchDelete(e.selectedList)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list},on:{"selection-change":e.changeBox},scopedSlots:e._u([{key:"empty",fn:function(){return[a("dgiot-empty")]},proxy:!0}])},[a("el-table-column",{attrs:{align:"center","class-name":"isCheck","show-overflow-tooltip":"",type:"selection",width:"55"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.alert number"),prop:"objectId","show-overflow-tooltip":"",sortablesortable:"",width:"120"}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.productname"),prop:"productname","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.devicenumber"),prop:"devaddr","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("equipment.createdAt"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e.$moment(a.createdAt).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm status"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-tag",{attrs:{effect:"dark",type:r.content.alertstatus?"danger":"success"}},[e._v(" "+e._s(r.content.alertstatus?e.$translateTitle("alert.start"):e.$translateTitle("alert.stop"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.Alarm handling"),"show-overflow-tooltip":"",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-link",{attrs:{effect:"dark",type:1==r.status?"success":"info"}},[e._v(" "+e._s(1==r.status?e.$translateTitle("Maintenance.Processed"):0==r.status?e.$translateTitle("Maintenance.Untreated"):e.$translateTitle("Maintenance.Distort"))+" ")])]}}])}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("alert.process"),prop:"process","show-overflow-tooltip":"",sortable:""}}),a("el-table-column",{attrs:{align:"center",label:e.$translateTitle("Maintenance.operating"),prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showdynamicform(r)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.View"))+" ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(r.objectId)}}},[e._v(" "+e._s(e.$translateTitle("Maintenance.delete"))+" ")])]}}])})],1),a("dgiot-parser-pagination",{key:e.list.length+"forensics",ref:"forensics",attrs:{pagination:e.paginations,"query-payload":e.queryPayload},on:{pagination:e.fetchData,paginationQuery:e.paginationQuery}})],1)},i=[],s=a("4569"),o=a("dcc6"),l=a("7212"),n=a("5880"),c=a("4be7"),u=a("8ba7"),d=Object.defineProperty,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),y={name:"Index",components:{},data(){return{editRow:{},amisData:{},paginations:{layout:"total, sizes, prev, pager, next, jumper"},queryPayload:{excludeKeys:"dynamicform",include:"",order:"-createdAt",limit:10,skip:0,count:"objectId"},selectedList:[],isDisable:!1,parserView:!1,dynamicformView:!1,formConfig:{},alertConfig:{},dynamicformInfo:{},alertId:"",step:1,detail:{},deviceFlag:!1,AllDevice:[],height:this.$baseTableHeight(0),dialogFormVisible:!1,types:["故障维修"],Device:[],dialogImageUrl:"",dialogVisible:!1,disabled:!1,formLabelWidth:"140px",process:"",status:"",devicename:"",rules:{product:[{required:!0,message:"请选择活动区域",trigger:"change"}],name:[{required:!0,message:"请选择活动区域",trigger:"change"}],type:[{required:!0,message:"请选择活动资源",trigger:"change"}]},processAll:[{key:"未处理",value:0},{key:"已处理",value:1},{key:"误报",value:2}],list:[],listLoading:!1,layout:"total, sizes, prev, pager, next, jumper",total:0,queryForm:{productName:"",isprocess:"",number:"",product:"",type:"",searchDate:[],limit:10,skip:0,order:"-createdAt",keys:"objectId"}}},computed:g({},Object(n["mapGetters"])({_Product:"user/_Product",objectId:"user/objectId",role:"acl/role",username:"user/username",currentDepartment:"user/currentDepartment"})),created(){},mounted(){dgiotlogger.log(this._Product),console.log(JSON.stringify(this._Product)),this.fetchData()},methods:{paginationQuery(e){return b(this,null,(function*(){this.queryPayload=e}))},fetchDelete(e){let t=[];e.forEach(e=>{t.push({method:"DELETE",path:"/classes/Notification/"+e.objectId,body:{}})}),this.$baseConfirm(this.$translateTitle("Maintenance.Are you sure you want to delete the current item"),null,()=>b(this,null,(function*(){yield Object(o["batch"])(t);this.$baseMessage(this.$translateTitle("Maintenance.successfully deleted"),"success","dgiot-hey-message-success"),setTimeout(()=>{this.fetchData()},1500)})))},handleSubmit(e){return dgiotlog.log("data",e),c["Promise"].resolve()},handleSuccess(e){return b(this,null,(function*(){const{table:t}=e,a={public:!0};if(!t)return;const r=this.$baseColorfullLoading(3);try{const e=yield this.$update_object(t,this.alertId,a);dgiotlog.log(e),r.close()}catch(i){dgiotlog.log(i),r.close(),this.$baseMessage(i,"error","dgiot-hey-message-error")}this.$nextTick(()=>{this.parserView=!1,this.fetchData()})}))},changeBox(e){this.selectedList=[],e.forEach(e=>{this.selectedList.push(e)}),dgiotlog.log(this.selectedList)},submitAlert(e){return b(this,null,(function*(){const t=this.$baseColorfullLoading(4);t.close();let a={process:this.process,status:Number(this.status)};try{const t=yield Object(s["putNotification"])(e,a);dgiotlog.log(t),this.$message({showClose:!0,duration:2e3,message:"处理成功",type:"success"})}catch(r){dgiotlog.log(r),this.$baseMessage("处理失败","error","dgiot-hey-message-error")}this.fetchData(),this.dynamicformView=!1}))},showdynamicform(e){return b(this,null,(function*(){localStorage.setItem("parse_objectid",e.deviceid),localStorage.setItem("parse_notificationid",e.objectId),this.amisData={},this.devicename=e.devaddr,this.editRow=e,this.dynamicformView=!0;const{data:t}=yield Object(u["getView"])(e.content._viewid);this.amisData=t}))},showInfo(e,t,a){return b(this,null,(function*(){const r=this.$baseColorfullLoading(4);dgiotlog.log(e,t);var[i,s]=e.split("_");dgiotlog.log(i,s),this.alertId=a;try{const{config:e}=yield Object(l["getProduct"])(i);r.close();const{parser:t=[],profile:a=[]}=e,o=[].concat(a,t);dgiotlog.log(o,"_mergeProfile");let n=o.map(e=>{if(e.uid==s)return e});dgiotlog.log(n,"_profileConfig"),this.formConfig=n[0].config,this.alertConfig=n[0],dgiotlog.log(this.formConfig,"formConfig")}catch(o){dgiotlog.log(o),r.close(),this.$baseMessage(o,"error","dgiot-hey-message-error")}this.formConfig=_.merge(t,this.formConfig),dgiotlog.log("_profileConfig",this.formConfig),this.$nextTick(()=>{this.parserView=!0})}))},handleDelete(e){return b(this,null,(function*(){const t=yield Object(s["delNotification"])(e);t=={}&&this.$message({showClose:!0,duration:2e3,message:this.$translateTitle("Maintenance.delete")+this.$translateTitle("message.success"),type:"success"}),this.fetchData()}))},fetchData(){return b(this,arguments,(function*(e={}){e.limit||(e=this.queryForm),this.listLoading=!1;const t=this.$baseColorfullLoading(3);this.queryForm.productName?this.queryPayload={limit:e.limit,order:e.order,skip:e.skip,count:e.keys,isprocess:this.queryForm.isprocess,include:"",where:{"content._productid":{$regex:this.queryForm.productName}}}:this.queryPayload={limit:e.limit,order:e.order,skip:e.skip,count:e.keys,include:"",where:{}},this.queryForm.isprocess&&(this.queryPayload.where["process"]={$regex:this.queryForm.isprocess}),this.queryForm.searchDate.length&&(this.queryPayload.where["createdAt"]={$gt:{__type:"Date",iso:this.queryForm.searchDate[0]+"T08:00:00.000Z"}},this.queryPayload.where["updatedAt"]={$lt:{__type:"Date",iso:this.queryForm.searchDate[1]+"T08:00:00.000Z"}});const{results:a=[],count:r=0}=yield Object(s["queryNotification"])(this.queryPayload);this.list=a,this.total=r,this.$refs["forensics"].ination.total=r,t.close(),console.log(this.list,"this.list")}))},prodChange(e){return b(this,null,(function*(){this.Device=[];const t={where:{product:e}},{results:a}=yield queryDevice(t);dgiotlog.log(a,"设备"),this.Device=a}))},handleRemove(e){this.form.photo.forEach((t,a)=>{t.split("/")[""+(t.split("/").length-1)]==e.name&&this.form.photo.splice(a,1)}),dgiotlog.log(this.form.photo)},handleSizeChange(e){this.queryForm.limit=e,this.fetchData()},handleCurrentChange(e){this.queryForm.skip=(e-1)*this.queryForm.limit,this.fetchData()}}},v=y,w=(a("806c"),a("2877")),$=Object(w["a"])(v,r,i,!1,null,"169da504",null);t["default"]=$.exports},f47e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.$translateTitle("Maintenance.Work order information"),name:"first"}},[a("el-form",{ref:"form",staticClass:"create-ticker",attrs:{"label-width":"auto",model:e.form,rules:e.rules,size:"medium "}},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.project")+": "}},[a("span",[e._v(e._s(e.form.info.productname))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Equipment name")+": "}},[a("span",[e._v(e._s(e.form.info.devicename))])])],1),a("el-col",{attrs:{lg:12,md:12,sm:24,xl:12,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Initiator")+": "}},[a("span",[e._v(e._s(e.form.info.createdname))])])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Ticket description")+": "}},[e._v(" "+e._s(e.form.info.description)+" ")])],1),a("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.photo")+": "}},[a("el-carousel",{attrs:{height:"200px",interval:2e3,type:"card"}},e._l(e.form.info.photo,(function(e,t){return a("el-carousel-item",{key:t},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{alt:e,src:e,title:e}})])})),1)],1)],1),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Remarks")}},[a("el-input",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:e.$translateTitle("Maintenance.Please record the processing content in detail!"),type:"textarea"},model:{value:e.form.info.step1.Remarks,callback:function(t){e.$set(e.form.info.step1,"Remarks",t)},expression:"form.info.step1.Remarks"}})],1)],1):e._e(),e.showFooter?a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$translateTitle("Maintenance.Maintenance staff"),prop:"info.receiveusername",required:""}},[a("el-tree",{ref:"workGroup",staticStyle:{float:"left",width:"50%"},attrs:{data:e.deptTreeData,"default-expand-all":"","expand-on-click-node":!1,"node-key":"index",props:e.roleProps},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,i=t.data;return a("div",{staticClass:"custom-tree-node"},[a("span",{class:{selected:i.objectId==e.curDepartmentId},on:{click:function(t){return e.handleNodeClick(i,r)}}},[e._v(" "+e._s(r.label)+" ")])])}}],null,!1,2722443036)}),a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"50%"},attrs:{disabled:!e.user.length,"element-loading-background":"rgba(0, 0, 0, 0.8)","element-loading-spinner":"el-icon-loading","element-loading-text":e.$translateTitle("developer.Data is loading"),placeholder:e.$translateTitle("product.selectdepartment")},model:{value:e.form.info.receiveusername,callback:function(t){e.$set(e.form.info,"receiveusername",t)},expression:"form.info.receiveusername"}},e._l(e.user,(function(t){return a("el-option",{key:t.objectId,attrs:{label:t.nick,value:t.objectId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.nick))]),a("span",{staticStyle:{float:"right","font-size":"14px",color:"#8492a6"}},[e._v(" "+e._s(t.objectId)+" ")])])})),1)],1)],1):e._e()],1)],1)],1),a("el-tab-pane",{staticStyle:{height:"90%","overflow-x":"hidden","overflow-y":"auto"},attrs:{label:e.$translateTitle("Maintenance.work process"),name:"second"}},[a("el-card",{attrs:{shadow:"hover"},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-radio-group",{staticClass:"card-header-radio",model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[a("el-radio",{attrs:{label:!0}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Positive order"))+" ")]),a("el-radio",{attrs:{label:!1}},[e._v(" "+e._s(e.$translateTitle("Maintenance.Reverse order"))+" ")])],1)]},proxy:!0}])},[a("el-timeline",{attrs:{reverse:e.reverse}},e._l(e.form.info.timeline,(function(t){return a("el-timeline-item",{key:t.timestamp,attrs:{placement:"top",timestamp:t.timestamp}},[a("el-card",[a("h4",[e._v(e._s(t.h4))]),a("p",[e._v(e._s(t.p))])])],1)})),1)],1)],1)],1)],1)},i=[],s=a("ce31"),o=a("5da9"),l=a("bc35"),n=a("5880"),c=Object.defineProperty,u=Object.defineProperties,d=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,f=(e,t,a)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&f(e,a,t[a]);if(m)for(var a of m(t))h.call(t,a)&&f(e,a,t[a]);return e},b=(e,t)=>u(e,d(t)),y=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),v={props:{detail:{type:Object,default:()=>{}},step:{type:Number,default:1},showFooter:{type:Boolean,default:!1},showHard:{type:Boolean,default:!1}},data(){return{roleName:"",loading:!1,user:[],deptTreeData:[],reverse:!0,roleProps:{children:"children",label:"name"},rules:{reverse:!0,"info.receiveusername":[{required:!0,message:"请选择分配人员",trigger:"change"}]},curDepartmentId:"",activeName:"first",form:this.detail}},computed:g({},Object(n["mapGetters"])({username:"user/username",token:"user/token",objectId:"user/objectId"})),mounted(){this.getRoletree()},methods:b(g({},Object(n["mapMutations"])({set_deviceFlag:"global/set_deviceFlag",set_deviceStep:"global/set_deviceStep"})),{getRoletree(){return y(this,null,(function*(){yield Object(l["Roletree"])().then(e=>{this.deptTreeData=e.results,this.handleNodeClick(e.results[0],0)}).catch(e=>{dgiotlog.log(e)})}))},handleNodeClick(e,t){return y(this,null,(function*(){this.loading=!0,this.curDepartmentId=e.objectId,this.user=[],this.roleName=e.name;const{users:t}=yield Object(o["queryRoledepartment"])({name:e.name});dgiotlog.log("res",t),this.user=t,this.loading=!1}))},dispatchUser(){this.$refs["form"].validate(e=>y(this,null,(function*(){let t=this.user.filter(e=>e.objectId==this.form.info.receiveusername);if(!e||!this.form.info.receiveusername)return this.$baseMessage("请选择分配人员","error","dgiot-hey-message-error"),dgiotlog.log("error submit!!"),!1;{const e={},{objectId:a,info:r,ACL:i,user:o}=this.form;r.timeline.push({timestamp:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),h4:"已分配",p:`${this.username} 分配给 ${t[0].nick}`}),dgiotlog.log("_user",t),r.receiveusername=t[0].nick,r.receiveuseid=t[0].objectId,r.receiveuserphone=t[0].phone,e[""+t[0].objectId]={read:!0,write:!0},e["role:"+this.roleName]={read:!0,write:!0};const l={status:1,info:r,ACL:_.merge(e,i),user:{objectId:t[0].objectId,__type:"Pointer",className:"_User"}};dgiotlog.log(a,l,e);const n=yield Object(s["update_object"])("Maintenance",a,l);n.updatedAt&&(this.set_deviceFlag(!1),this.set_deviceStep(-1))}})))}})},w=v,$=(a("c81c"),a("2877")),k=Object($["a"])(w,r,i,!1,null,"c8751d64",null);t["default"]=k.exports},f550:function(e,t,a){},f684:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"custom-table",staticClass:"index-container",class:{"dgiot-fullscreen":e.isFullscreen}},[r("dgiot-query-form",[r("dgiot-query-form-left-panel",[r("el-form",{ref:"form",attrs:{inline:!0,"label-width":"0",model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"标题"},model:{value:e.queryForm.title,callback:function(t){e.$set(e.queryForm,"title",t)},expression:"queryForm.title"}})],1),r("el-form-item",[r("el-button",{attrs:{icon:"el-icon-search","native-type":"submit",type:"primary"},on:{click:e.handleQuery}},[e._v(" 查询 ")]),r("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},nativeOn:{click:function(t){return e.handleAdd.apply(null,arguments)}}},[e._v(" 添加 ")])],1)],1)],1),r("dgiot-query-form-right-panel",[r("el-button",{staticStyle:{margin:"0 10px 10px 0 !important"},attrs:{type:"primary"},on:{click:e.clickFullScreen}},[r("dgiot-icon",{attrs:{icon:e.isFullscreen?"fullscreen-exit-fill":"fullscreen-fill"}}),e._v(" 表格全屏 ")],1),r("el-popover",{attrs:{"popper-class":"custom-table-checkbox",trigger:"hover"},scopedSlots:e._u([{key:"reference",fn:function(){return[r("el-button",{staticStyle:{margin:"0 0 10px 0 !important"},attrs:{icon:"el-icon-setting",type:"primary"}},[e._v(" 可拖拽列设置 ")])]},proxy:!0}])},[r("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[r("dgiot-draggable",{attrs:{list:e.columns}})],1)],1)],1)],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"tableSort",attrs:{border:e.border,data:e.list,height:e.height,size:e.lineHeight,stripe:e.stripe},on:{"selection-change":e.setSelectRows},scopedSlots:e._u([{key:"empty",fn:function(){return[r("el-image",{staticClass:"dgiot-data-empty",attrs:{src:a("c2ad")}})]},proxy:!0}])},[r("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),r("el-table-column",{attrs:{align:"center",label:"序号","show-overflow-tooltip":"",sortable:"",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),e._l(e.finallyColumns,(function(t,a){return r("el-table-column",{key:a,attrs:{align:"center",label:t.label,sortable:"",width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){var i=a.row;return["评级"===t.label?r("span",[r("el-rate",{attrs:{disabled:""},model:{value:i.rate,callback:function(t){e.$set(i,"rate",t)},expression:"row.rate"}})],1):r("span",[e._v(e._s(i[t.prop]))])]}}],null,!0)})})),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",sortable:"",width:"85"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])]}}])})],2),r("el-pagination",{attrs:{background:"","current-page":e.queryForm.pageNo,layout:e.layout,"page-size":e.queryForm.pageSize,total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}}),r("table-edit",{ref:"edit",on:{"fetch-data":e.fetchData}})],1)},i=[],s=a("8456"),o=a("3248"),l=(e,t,a)=>new Promise((r,i)=>{var s=e=>{try{l(a.next(e))}catch(t){i(t)}},o=e=>{try{l(a.throw(e))}catch(t){i(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(s,o);l((a=a.apply(e,t)).next())}),n={name:"Index",components:{TableEdit:o["default"]},props:{},data(){return{infoData:"Empty",isFullscreen:!1,border:!0,height:this.$baseTableHeight(0)+20,stripe:!0,lineHeight:"mini",checkList:["标题","作者","评级","点击量","时间"],columns:[{label:"标题",width:"auto",prop:"title",sortable:!0,disableCheck:!0},{label:"作者",width:"auto",prop:"author",sortable:!0},{label:"评级",width:"200",prop:"rate",sortable:!0},{label:"点击量",width:"auto",prop:"pageViews",sortable:!0},{label:"时间",width:"auto",prop:"datetime",sortable:!0}],list:[],imageList:[],listLoading:!0,layout:"total, sizes, prev, pager, next, jumper",total:0,selectRows:"",queryForm:{pageNo:1,pageSize:20,title:""}}},computed:{dragOptions(){return{animation:600,group:"description"}},finallyColumns(){return this.columns.filter(e=>this.checkList.includes(e.label))}},watch:{},created(){this.fetchData()},mounted(){},destroyed(){},methods:{clickFullScreen(){this.isFullscreen=!this.isFullscreen,this.handleHeight()},handleHeight(){this.isFullscreen?this.height=this.$baseTableHeight(1)+210:this.height=this.$baseTableHeight(1)},setSelectRows(e){this.selectRows=e},handleAdd(){this.$refs["edit"].showEdit()},handleEdit(e){this.$refs["edit"].showEdit(e)},handleDelete(e){this.$baseConfirm("你确定要删除当前项吗",null,()=>l(this,null,(function*(){const{msg:t}=yield Object(s["doDelete"])({ids:e.id});this.$baseMessage(t,"success","dgiot-hey-message-success"),yield this.fetchData()})))},handleSizeChange(e){this.queryForm.pageSize=e,this.fetchData()},handleCurrentChange(e){this.queryForm.pageNo=e,this.fetchData()},handleQuery(){this.queryForm.pageNo=1,this.fetchData()},fetchData(){return l(this,null,(function*(){this.listLoading=!0;const{data:{list:e,total:t}}=yield Object(s["getList"])(this.queryForm);this.list=e;const a=[];e.forEach(e=>{a.push(e.img)}),this.imageList=a,this.total=t,this.listLoading=!1}))}}},c=n,u=(a("dae2"),a("2877")),d=Object(u["a"])(c,r,i,!1,null,"1822dde8",null);t["default"]=d.exports},f9fc:function(e,t,a){"use strict";a("7d07")},fb07:function(e,t,a){"use strict";a("446c")},fb36:function(e,t,a){"use strict";a("273d")}}]);